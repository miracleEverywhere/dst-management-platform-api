import{_ as fe}from"./ConfirmBox-EquM784R.js";import{d as pe,e as ce,b as be,h as b,f as ve,c as L,o as u,a as l,w as a,l as e,ab as ge,s as A,a7 as Ve,p as S,q as i,t as n,P as J,Q as O,G as N,y as f,F as E,x as v,z as X,V as Y,R as Z,E as ee,m as ye,v as xe,B as F,aw as ae,S as _e}from"./index-CUqMz98Q.js";import{u as R}from"./user-DjC6NfJb.js";import{r as ke}from"./room-DUVbzOTw.js";import{V as Ce,a as we,b as Pe,c as Se,d as Ue}from"./VBadge-CdNT1_Da.js";import{a as le,V as re,c as We,b as Be}from"./VCard-CCXXQnDc.js";import{V as g}from"./VRow-DjJRgvp1.js";import{V as c}from"./VCol-CNyyfCgI.js";import{V as I}from"./VTextField-BC-Dauxh.js";import{V as De}from"./VDataTableServer-Cjh8RhMR.js";import{V as Te}from"./VMenu-ClswS2ZL.js";import{V as ze}from"./VList-B5PfedMW.js";import{V as d}from"./VChip-D52a5STx.js";import{V as Le,a as Fe}from"./VToolbar-BHXvKMSI.js";import{V as Re}from"./VForm-CMZ2txzh.js";import{T as V}from"./index-Df1qgLoa.js";import{V as M,a as w}from"./VRadioGroup-Dk3I0OTD.js";import{V as Ie}from"./VSelect-kc192oZf.js";import{V as oe}from"./VSlider-BbXN1L7u.js";import{V as $e}from"./VSpacer-CWRfoVLU.js";import{V as qe}from"./VDialog-BvP4GPN7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VAlert-CnUevvd0.js";import"./axios-BviZ8UZz.js";/* empty css              */import"./index-DMUK-Sdt.js";import"./VInput-DLKXZnps.js";import"./VDataTable-BSVgJcrp.js";import"./VPagination-B16lOeCs.js";import"./VCheckboxBtn-D568hA48.js";import"./VSelectionControl-DBFUmGqW.js";import"./VTable-B_CghHR2.js";import"./filter-EJ8IWv9v.js";import"./dialog-transition-DKWwBUaX.js";import"./ssrBoot-BWJBvRlE.js";import"./VTooltip-V4dyfnab.js";const Ae={key:0},Ca={__name:"user",setup(Ne){const h=pe(),{mobile:P}=ce(),{t:r}=be(),j=b([{roomName:"",roomID:0}]),te=()=>{ke.basic.get().then(m=>{j.value=m.data||[]})},U=b(""),p=b({rows:[],page:1,pageSize:10,total:0}),W=b(!1),x=({page:m,itemsPerPage:t,sortBy:C})=>{const o={q:U.value,page:m,pageSize:t};W.value=!0,R.list.get(o).then(z=>{p.value=z.data}).finally(()=>{W.value=!1})},se=[{title:r("platform.user.form.username.title"),value:"username"},{title:r("platform.user.form.nickname.title"),value:"nickname"},{title:r("platform.user.form.role.title"),value:"role"},{title:r("platform.user.form.avatar.title"),value:"avatar"},{title:r("platform.user.form.disabled.title"),value:"disabled"},{title:r("platform.user.form.rooms.title"),value:"rooms"},{title:r("platform.user.form.roomCreation.title"),value:"roomCreation"},{title:r("platform.user.form.maxWorlds.title"),value:"maxWorlds"},{title:r("platform.user.form.maxPlayers.title"),value:"maxPlayers"},{title:r("platform.user.table.actions"),value:"actions"}],_=b(),s=b({username:"",nickname:"",role:"non-admin",avatar:"1",password:"",disabled:!1,rooms:[],roomCreation:!0,maxWorlds:2,maxPlayers:6}),$={username:[m=>m?!0:r("platform.user.form.username.required")],nickname:[m=>m?!0:r("platform.user.form.nickname.required")],password:[m=>m?!0:r("platform.user.form.password.required")]},y=b(!1),B=b(!1),me=()=>{y.value=!0,B.value=!1,s.value={username:"",nickname:"",role:"non-admin",avatar:"1",password:"",disabled:!1,rooms:[],roomCreation:!1,maxWorlds:2,maxPlayers:6},ae(()=>{_.value&&_.value.resetValidation()})},ne={1:Ue,2:Se,3:Pe,4:we},G=m=>ne[m],D=b(!1),T=b(!1),ie=async()=>{const{valid:m}=await _.value.validate();if(m)if(T.value=!0,B.value){const t={username:s.value.username,nickname:s.value.nickname,role:s.value.role,avatar:s.value.avatar,password:"",disabled:s.value.disabled,rooms:s.value.rooms.join(","),roomCreation:s.value.roomCreation,maxWorlds:s.value.maxWorlds,maxPlayers:s.value.maxPlayers};R.base.put(t).then(C=>{y.value=!1,F(C.message),x({page:p.value.page,itemsPerPage:p.value.pageSize,sortBy:void 0})}).finally(()=>{T.value=!1})}else{const t={username:s.value.username,nickname:s.value.nickname,role:s.value.role,avatar:s.value.avatar,password:_e(s.value.password),disabled:s.value.disabled,rooms:s.value.rooms.join(","),roomCreation:s.value.roomCreation,maxWorlds:s.value.maxWorlds,maxPlayers:s.value.maxPlayers};R.base.post(t).then(C=>{y.value=!1,F(C.message),x({page:p.value.page,itemsPerPage:p.value.pageSize,sortBy:void 0})}).finally(()=>{T.value=!1})}},K=m=>m?m.split(",").map(Number).filter(t=>!isNaN(t)):[],H=(m,t)=>{switch(m){case"update":ue(t);break;case"delete":Q.value=t.username,k.value=!0;break;default:F("牛哇","error")}},ue=m=>{y.value=!0,B.value=!0,s.value={username:m.username,nickname:m.nickname,role:m.role,avatar:m.avatar,disabled:m.disabled,rooms:K(m.rooms),roomCreation:m.roomCreation,maxWorlds:m.maxWorlds,maxPlayers:m.maxPlayers},ae(()=>{_.value&&_.value.resetValidation()})},k=b(!1),q=b(!1),Q=b(""),de=()=>{q.value=!0;const m={username:Q.value};R.base.delete(m).then(t=>{k.value=!1,F(t.message),x({page:p.value.page,itemsPerPage:p.value.pageSize,sortBy:void 0})}).finally(()=>{q.value=!1})};return ve(()=>{te()}),(m,t)=>{const C=fe;return u(),L(E,null,[l(re,null,{default:a(()=>[l(le,null,{default:a(()=>[l(g,null,{default:a(()=>[l(c,{cols:"12"},{default:a(()=>[l(I,{modelValue:e(U),"onUpdate:modelValue":t[0]||(t[0]=o=>A(U)?U.value=o:null),label:e(r)("platform.user.search.label"),placeholder:e(r)("platform.user.search.placeholder"),clearable:"",onKeyup:t[1]||(t[1]=ge(o=>x({page:e(p).page,itemsPerPage:e(p).pageSize,sortBy:void 0}),["enter"])),"onClick:clear":t[2]||(t[2]=o=>x({page:e(p).page,itemsPerPage:e(p).pageSize,sortBy:void 0}))},null,8,["modelValue","label","placeholder"])]),_:1}),l(c,{cols:"12"},{default:a(()=>[l(Ve,{rounded:"",border:""},{default:a(()=>[l(De,{"items-per-page":e(p).pageSize,"onUpdate:itemsPerPage":t[4]||(t[4]=o=>e(p).pageSize=o),items:e(p).rows,"items-length":e(p).total,page:e(p).page,loading:e(W),headers:se,"onUpdate:options":x},{top:a(()=>[l(Le,{flat:""},{default:a(()=>[l(Fe,null,{default:a(()=>[l(N,{icon:"ri-id-card-line",start:""}),e(P)?ee("",!0):(u(),L("span",Ae,n(e(r)("platform.user.table.title")),1))]),_:1}),l(S,{"prepend-icon":"ri-add-line",color:"success",onClick:me},{default:a(()=>[i(n(e(r)("platform.user.table.create")),1)]),_:1}),l(S,{"prepend-icon":"ri-refresh-line",loading:e(W),color:"default",onClick:t[3]||(t[3]=o=>x({page:e(p).page,itemsPerPage:e(p).pageSize,sortBy:void 0}))},{default:a(()=>[i(n(e(r)("platform.user.table.refresh")),1)]),_:1},8,["loading"])]),_:1})]),"item.username":a(({value:o})=>[l(d,{label:""},{default:a(()=>[i(n(o),1)]),_:2},1024)]),"item.nickname":a(({value:o})=>[l(d,{label:""},{default:a(()=>[i(n(o),1)]),_:2},1024)]),"item.role":a(({value:o})=>[o==="admin"?(u(),f(d,{key:0,color:"primary",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.admin")),1)]),_:1})):(u(),f(d,{key:1,label:""},{default:a(()=>[i(n(e(r)("platform.user.table.nonAdmin")),1)]),_:1}))]),"item.avatar":a(({value:o})=>[v((u(),f(X,{color:"primary",variant:"tonal"},{default:a(()=>[l(Y,{src:G(o)},null,8,["src"])]),_:2},1024)),[[Z]])]),"item.disabled":a(({value:o})=>[o?(u(),f(d,{key:0,color:"error",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.yes")),1)]),_:1})):(u(),f(d,{key:1,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.no")),1)]),_:1}))]),"item.rooms":a(({item:o})=>[o.role==="admin"?(u(),f(d,{key:0,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.noLimit")),1)]),_:1})):(u(),f(d,{key:1,color:"info",label:""},{default:a(()=>[i(n(K(o.rooms).length)+n(e(r)("platform.user.table.unit")),1)]),_:2},1024))]),"item.roomCreation":a(({item:o})=>[o.role==="admin"?(u(),f(d,{key:0,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.yes")),1)]),_:1})):(u(),L(E,{key:1},[o.roomCreation?(u(),f(d,{key:0,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.yes")),1)]),_:1})):(u(),f(d,{key:1,color:"error",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.no")),1)]),_:1}))],64))]),"item.maxWorlds":a(({item:o})=>[o.role==="admin"?(u(),f(d,{key:0,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.noLimit")),1)]),_:1})):(u(),f(d,{key:1,label:""},{default:a(()=>[i(n(o.maxWorlds),1)]),_:2},1024))]),"item.maxPlayers":a(({item:o})=>[o.role==="admin"?(u(),f(d,{key:0,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.noLimit")),1)]),_:1})):(u(),f(d,{key:1,label:""},{default:a(()=>[i(n(o.maxPlayers),1)]),_:2},1024))]),"item.actions":a(({item:o})=>[l(S,{color:"info","append-icon":"ri-arrow-drop-down-line",variant:"text"},{default:a(()=>[i(n(e(r)("platform.user.table.actions"))+" ",1),l(Te,{activator:"parent"},{default:a(()=>[l(ze,null,{default:a(()=>[l(J,{class:"text-warning",onClick:z=>H("update",o)},{prepend:a(()=>[l(N,{icon:"ri-user-settings-line",size:"22"})]),default:a(()=>[l(O,null,{default:a(()=>[i(n(e(r)("platform.user.table.update")),1)]),_:1})]),_:1},8,["onClick"]),l(J,{disabled:o.role==="admin",class:"text-error",onClick:z=>H("delete",o)},{prepend:a(()=>[l(N,{icon:"ri-user-unfollow-line",size:"22"})]),default:a(()=>[l(O,null,{default:a(()=>[i(n(e(r)("platform.user.table.delete")),1)]),_:1})]),_:1},8,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["items-per-page","items","items-length","page","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(qe,{modelValue:e(y),"onUpdate:modelValue":t[16]||(t[16]=o=>A(y)?y.value=o:null),width:e(P)?"85%":"60%"},{default:a(()=>[l(re,null,{default:a(()=>[l(We,null,{default:a(()=>[i(n(e(r)("platform.user.dialogTitle")),1)]),_:1}),l(Re,{ref_key:"userFormRef",ref:_,class:"mx-6",onSubmit:ye(ie,["prevent"])},{default:a(()=>[l(le,{class:"my-2"},{default:a(()=>[l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[v(l(I,{modelValue:e(s).username,"onUpdate:modelValue":t[5]||(t[5]=o=>e(s).username=o),rules:$.username,label:e(r)("platform.user.form.username.title")},null,8,["modelValue","rules","label"]),[[V,e(r)("platform.user.form.username.tip")]])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[v(l(I,{modelValue:e(s).nickname,"onUpdate:modelValue":t[6]||(t[6]=o=>e(s).nickname=o),rules:$.nickname,label:e(r)("platform.user.form.nickname.title")},null,8,["modelValue","rules","label"]),[[V,e(r)("platform.user.form.nickname.tip")]])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,{cols:"12",md:"6"},{default:a(()=>[l(M,{modelValue:e(s).role,"onUpdate:modelValue":t[7]||(t[7]=o=>e(s).role=o),disabled:e(s).username===e(h).userInfo.username,inline:""},{prepend:a(()=>[v((u(),f(d,null,{default:a(()=>[i(n(e(r)("platform.user.form.role.title")),1)]),_:1})),[[V,e(r)("platform.user.form.role.tip")]])]),default:a(()=>[l(w,{label:e(r)("platform.user.form.role.admin"),value:"admin",class:"mr-4"},null,8,["label"]),l(w,{label:e(r)("platform.user.form.role.nonAdmin"),value:"non-admin",class:"mr-4"},null,8,["label"])]),_:1},8,["modelValue","disabled"])]),_:1}),l(c,{cols:"12",md:"6"},{default:a(()=>[l(M,{modelValue:e(s).disabled,"onUpdate:modelValue":t[8]||(t[8]=o=>e(s).disabled=o),disabled:e(s).username===e(h).userInfo.username,inline:""},{prepend:a(()=>[v((u(),f(d,null,{default:a(()=>[i(n(e(r)("platform.user.form.disabled.title")),1)]),_:1})),[[V,e(r)("platform.user.form.disabled.tip")]])]),default:a(()=>[l(w,{label:e(r)("platform.user.form.disabled.yes"),value:!0,class:"mr-4"},null,8,["label"]),l(w,{label:e(r)("platform.user.form.disabled.no"),value:!1,class:"mr-4"},null,8,["label"])]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,{cols:e(P)?4:2,class:"d-flex align-center"},{default:a(()=>[l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[v((u(),f(d,null,{default:a(()=>[i(n(e(r)("platform.user.form.avatar.title")),1)]),_:1})),[[V,e(r)("platform.user.form.avatar.tip")]])]),_:1})]),_:1})]),_:1},8,["cols"]),l(c,{cols:e(P)?8:10},{default:a(()=>[l(g,null,{default:a(()=>[(u(),L(E,null,xe(4,o=>l(c,{key:o,cols:e(P)?6:3},{default:a(()=>[l(Ce,{dot:"",location:"bottom right","offset-x":"3","offset-y":"3",color:"success","model-value":e(s).avatar===o.toString()},{default:a(()=>[v((u(),f(X,{color:"primary",variant:"tonal",onClick:z=>e(s).avatar=o.toString()},{default:a(()=>[l(Y,{src:G(o)},null,8,["src"])]),_:2},1032,["onClick"])),[[Z]])]),_:2},1032,["model-value"])]),_:2},1032,["cols"])),64))]),_:1})]),_:1},8,["cols"])]),_:1}),e(B)?ee("",!0):(u(),f(g,{key:0},{default:a(()=>[l(c,null,{default:a(()=>[v(l(I,{modelValue:e(s).password,"onUpdate:modelValue":t[9]||(t[9]=o=>e(s).password=o),"append-inner-icon":e(D)?"ri-eye-off-line":"ri-eye-line",type:e(D)?"text":"password",autocomplete:"password",label:e(r)("platform.user.form.password.title"),rules:$.password,clearable:"","onClick:appendInner":t[10]||(t[10]=o=>D.value=!e(D))},null,8,["modelValue","append-inner-icon","type","label","rules"]),[[V,e(r)("platform.user.form.password.tip")]])]),_:1})]),_:1})),l(g,null,{default:a(()=>[l(c,{cols:"12"},{default:a(()=>[l(M,{modelValue:e(s).roomCreation,"onUpdate:modelValue":t[11]||(t[11]=o=>e(s).roomCreation=o),disabled:e(s).role==="admin",inline:""},{prepend:a(()=>[v((u(),f(d,null,{default:a(()=>[i(n(e(r)("platform.user.form.roomCreation.title")),1)]),_:1})),[[V,e(r)("platform.user.form.roomCreation.tip")]])]),default:a(()=>[l(w,{label:e(r)("platform.user.form.roomCreation.yes"),value:!0,class:"mr-4"},null,8,["label"]),l(w,{label:e(r)("platform.user.form.roomCreation.no"),value:!1,class:"mr-4"},null,8,["label"])]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,{cols:"12"},{default:a(()=>[v(l(Ie,{modelValue:e(s).rooms,"onUpdate:modelValue":t[12]||(t[12]=o=>e(s).rooms=o),disabled:e(s).role==="admin",items:e(j),"item-title":"roomName","item-value":"roomID",label:e(r)("platform.user.form.rooms.title"),multiple:"",chips:""},null,8,["modelValue","disabled","items","label"]),[[V,e(r)("platform.user.form.rooms.tip")]])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[l(oe,{modelValue:e(s).maxPlayers,"onUpdate:modelValue":t[13]||(t[13]=o=>e(s).maxPlayers=o),disabled:e(s).role==="admin",max:64,min:1,class:"align-center","hide-details":"",step:"1",style:{"margin-left":"-1px"}},{label:a(()=>[v((u(),f(d,{style:{"margin-right":"1rem"}},{default:a(()=>[i(n(e(r)("platform.user.form.maxPlayers.title")),1)]),_:1})),[[V,e(r)("platform.user.form.maxPlayers.tip")]])]),append:a(()=>[l(d,{label:"",color:"primary"},{default:a(()=>[i(n(e(s).maxPlayers),1)]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[l(oe,{modelValue:e(s).maxWorlds,"onUpdate:modelValue":t[14]||(t[14]=o=>e(s).maxWorlds=o),disabled:e(s).role==="admin",max:64,min:1,class:"align-center","hide-details":"",step:"1",style:{"margin-left":"-1px"}},{label:a(()=>[v((u(),f(d,{style:{"margin-right":"1rem"}},{default:a(()=>[i(n(e(r)("platform.user.form.maxWorlds.title")),1)]),_:1})),[[V,e(r)("platform.user.form.maxWorlds.tip")]])]),append:a(()=>[l(d,{label:"",color:"primary"},{default:a(()=>[i(n(e(s).maxWorlds),1)]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),l(Be,{class:"my-6"},{default:a(()=>[l($e),l(S,{color:"default",variant:"elevated",text:e(r)("login.cancel"),class:"mr-4",onClick:t[15]||(t[15]=o=>y.value=!1)},null,8,["text"]),l(S,{text:e(r)("login.submit"),loading:e(T),variant:"elevated",type:"submit"},null,8,["text","loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue","width"]),l(C,{modelValue:e(k),"onUpdate:modelValue":t[17]||(t[17]=o=>A(k)?k.value=o:null),type:"warning",title:e(r)("global.confirm.title"),content:e(r)("global.confirm.content"),"confirm-text":e(r)("global.confirm.confirm"),"cancel-text":e(r)("global.confirm.cancel"),"confirm-loading":e(q),onConfirm:de,onCancel:t[18]||(t[18]=o=>k.value=!1)},null,8,["modelValue","title","content","confirm-text","cancel-text","confirm-loading"])],64)}}};export{Ca as default};
