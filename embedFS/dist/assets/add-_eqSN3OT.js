import{m as f}from"./mod-Dh2bBxzH.js";import{g as P,b as G,h as n,f as R,A as k,o as y,w as e,a,ab as H,k as x,v as i,t as s,l as o,s as z,P as b,p as J,x as $,I as F,ae as K,m as O,af as Q,V as W,E as u}from"./index-CMKCSYdO.js";import{V as U}from"./VMenu-iADqZB_W.js";import{V as q,a as v,b as w}from"./VList-BeTdI8h_.js";import{V as X}from"./VTextField-DSK81GDs.js";import{V as Y}from"./VSheet-Ba81t4RC.js";import{V as Z}from"./VDataTable-DNf-Cke-.js";import{V as p}from"./VChip-Bk2gsPMH.js";import{V as ee}from"./VSkeletonLoader-DURWOOLO.js";import"./axios-dEuv8C7T.js";import"./dialog-transition-1BFQW-Tr.js";import"./index-DGBzjDo7.js";import"./ssrBoot-CJNhhsY7.js";import"./VDivider-Cxv4jZxD.js";import"./VInput-BVFTscmb.js";import"./VPagination-Cc6OLUvh.js";import"./VSelect-DXelBhLk.js";import"./VSelectionControl-DRxzzoA5.js";import"./VTable-CnF6faJ0.js";import"./VSlideGroup-Br9BzrjI.js";const ae={class:"card-header"},le={class:"d-flex align-center justify-center fill-height"},Ce={__name:"add",setup(oe){const c=P(),{t:d}=G(),L=n([]),g=n(!1),D=()=>{const r={roomID:c.room.id};g.value=!0,f.downloaded.get(r).then(t=>{L.value=t.data}).finally(()=>{g.value=!1})},V=n(""),B=[{key:"preview_url",title:d("game.mod.add.preview")},{key:"name",title:d("game.mod.add.name")},{key:"serverSize",title:d("game.mod.add.size")},{key:"id",title:"ID"},{key:"update",title:d("game.mod.add.update")},{key:"actions",title:d("game.mod.add.actions")}],m=n([]),C=(r,t)=>{switch(r){case"enable":N(t);break;case"update":T(t);break;default:u("牛哇","error")}},I=n(!1),N=r=>{I.value=!0;const t={roomID:c.room.id,worldID:0,id:r.id,file_url:r.file_url};f.add.enable.post(t).then(l=>{u(l.message)}).finally(()=>{I.value=!1})},S=n(!1),T=r=>{S.value=!0;const t={roomID:c.room.id,id:r.id,file_url:r.file_url,update:!0};f.download.post(t).then(l=>{u(l.message),D()}).finally(()=>{S.value=!1})},h=n(!1),E=async()=>{let r=!0;h.value=!0,console.log(m.value);for(let t of m.value){const l={roomID:c.room.id,worldID:0,id:t.id,file_url:t.file_url};try{await f.add.enable.post(l)}catch{r=!1,u(`${t.name} ${d("game.mod.add.enableMultiFail")}`,"error")}}r&&(m.value=[],u(d("game.mod.add.enableMultiSuccess"))),h.value=!1},M=n(!1),A=()=>{M.value=!0;const r={roomID:c.room.id,worldID:24};f.setting.enabledMods.get(r).then(async t=>{let l=!0;for(let _ of t.data){const j={roomID:c.room.id,id:_.id,file_url:_.file_url};try{const de=await f.download.post(j)}catch{l=!1,u(`${_.name} ${d("game.mod.add.preDownloadFail")}`,"error")}l&&u(d("game.mod.add.preDownloadSuccess"))}}).finally(()=>{M.value=!1})};return R(()=>{D()}),(r,t)=>(y(),k(W,null,{default:e(()=>[a(H,null,{default:e(()=>[x("div",ae,[i(s(o(d)("game.mod.add.tabName"))+" ",1),x("div",null,[a(z,{"append-icon":"ri-arrow-drop-down-line",color:"primary"},{default:e(()=>[i(s(o(d)("game.mod.add.headerMenuButton"))+" ",1),a(U,{activator:"parent"},{default:e(()=>[a(q,null,{default:e(()=>[a(v,{disabled:o(M),class:"text-info",onClick:A},{prepend:e(()=>[a(b,{icon:"ri-download-2-line",size:"22"})]),default:e(()=>[a(w,null,{default:e(()=>[i(s(o(d)("game.mod.add.preDownload")),1)]),_:1})]),_:1},8,["disabled"]),a(v,{disabled:o(m).length===0||o(h),class:"text-success",onClick:E},{prepend:e(()=>[a(b,{icon:"ri-list-check-3",size:"22"})]),default:e(()=>[a(w,null,{default:e(()=>[i(s(o(d)("game.mod.add.enableMulti")),1)]),_:1})]),_:1},8,["disabled"]),a(v,{disabled:o(h),class:"text-warning",onClick:t[0]||(t[0]=l=>C("enable",{id:0,file_url:""}))},{prepend:e(()=>[a(b,{icon:"ri-add-line",size:"22"})]),default:e(()=>[a(w,null,{default:e(()=>[i(s(o(d)("game.mod.add.addClientModsDisabled")),1)]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})])])]),_:1}),a(J,{class:"mt-4"},{default:e(()=>[a(X,{modelValue:o(V),"onUpdate:modelValue":t[1]||(t[1]=l=>$(V)?V.value=l:null),loading:o(g),label:o(d)("game.mod.add.search"),variant:"outlined","hide-details":"","single-line":""},{append:e(()=>[a(z,{loading:o(g),"prepend-icon":"ri-refresh-line",color:"default",variant:"elevated",size:"large",onClick:D},{default:e(()=>[i(s(o(d)("game.mod.add.refresh")),1)]),_:1},8,["loading"])]),_:1},8,["modelValue","loading","label"]),a(Y,{border:"",rounded:"",class:"mt-4"},{default:e(()=>[a(Z,{modelValue:o(m),"onUpdate:modelValue":t[2]||(t[2]=l=>$(m)?m.value=l:null),"show-select":"","return-object":"",headers:B,items:o(L),search:o(V),loading:o(g)},{loading:e(()=>[a(ee,{type:"table-row@10"})]),"item.preview_url":e(({value:l})=>[a(O,{src:l,width:100,cover:"",rounded:"","aspect-ratio":"1",class:"ma-2"},{placeholder:e(()=>[x("div",le,[a(Q,{color:"grey-lighten-4",indeterminate:""})])]),_:1},8,["src"])]),"item.name":e(({value:l})=>[a(p,{label:"",color:"info"},{default:e(()=>[i(s(l),1)]),_:2},1024)]),"item.serverSize":e(({value:l})=>[a(p,{label:"",color:"primary"},{default:e(()=>[i(s(o(K)(parseInt(l))),1)]),_:2},1024)]),"item.id":e(({value:l})=>[a(p,{label:""},{default:e(()=>[i(s(l),1)]),_:2},1024)]),"item.update":e(({item:l})=>[l.file_url!==""?(y(),k(p,{key:0,label:""},{default:e(()=>[i(s(o(d)("game.mod.add.notUGC")),1)]),_:1})):F("",!0),l.file_url===""&&l.serverSize===l.localSize?(y(),k(p,{key:1,label:"",color:"success"},{default:e(()=>[i(s(o(d)("game.mod.add.needNoUpdate")),1)]),_:1})):F("",!0),l.file_url===""&&l.serverSize!==l.localSize?(y(),k(p,{key:2,label:"",color:"error"},{default:e(()=>[i(s(o(d)("game.mod.add.needUpdate")),1)]),_:1})):F("",!0)]),"item.actions":e(({item:l})=>[a(z,{color:"info","append-icon":"ri-arrow-drop-down-line",variant:"text"},{default:e(()=>[i(s(o(d)("game.mod.add.actions"))+" ",1),a(U,{activator:"parent"},{default:e(()=>[a(q,null,{default:e(()=>[a(v,{disabled:o(I),class:"text-success",onClick:_=>C("enable",l)},{prepend:e(()=>[a(b,{icon:"ri-file-check-line",size:"22"})]),default:e(()=>[a(w,null,{default:e(()=>[i(s(o(d)("game.mod.add.enable")),1)]),_:1})]),_:1},8,["disabled","onClick"]),a(v,{disabled:o(S),class:"text-info",onClick:_=>C("update",l)},{prepend:e(()=>[a(b,{icon:"ri-arrow-up-circle-line",size:"22"})]),default:e(()=>[a(w,null,{default:e(()=>[i(s(o(d)("game.mod.add.updateMod")),1)]),_:1})]),_:1},8,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","items","search","loading"])]),_:1})]),_:1})]),_:1}))}};export{Ce as default};
