import{_ as Q}from"./Result-BPtA_udn.js";import{g as K,d as X,b as Y,e as Z,f as c,j as ee,a4 as te,a5 as oe,c as y,o as d,a as o,l as e,F as T,y as p,w as t,a8 as ne,p as v,q as m,t as s,P as z,Q as M,G as D,W as le,A as ae,m as se,k as $,x as F,s as ie,ax as re,C as q,cv as ue}from"./index-C0CFXjb_.js";import{t as R}from"./tools-DTGCIvvi.js";import{V as de}from"./VDataTable-Bu1RGyNZ.js";import{V as me}from"./VMenu-DbrxldX1.js";import{V as ce}from"./VList-Dl_NLLI9.js";import{V as k}from"./VChip-B0ovR4hU.js";import{V as fe,a as pe}from"./VToolbar-DN4OMC_b.js";import{V as ve}from"./VSkeletonLoader-BSNsqUvs.js";import{V as B,c as Ve,a as ge,b as be}from"./VCard-DkAFob-J.js";import{V as _e}from"./VForm-DDAz70zq.js";import{V as I}from"./VRow-BijlqyZw.js";import{V as he,a as E}from"./VRadioGroup-BF8s9zFg.js";import{T as N}from"./index-Bpg76b7b.js";import{V as ye}from"./VNumberInput-Dc8QaUzh.js";import{V as ke}from"./VTextField-DIibuz5r.js";import{V as we}from"./VSpacer-BZsWuYhf.js";import{V as Se}from"./VDialog-CgCYqF13.js";import"./VContainer-oHMZ07jB.js";/* empty css              */import"./axios-B-ryAAwj.js";import"./VPagination-CKFPiyhX.js";import"./VSelect-b7Tt6q4h.js";import"./VInput-DzG9nMlp.js";import"./index-D0PINIYt.js";import"./VCheckboxBtn-Clvsf_Wo.js";import"./VSelectionControl-B6dwry-j.js";import"./dialog-transition-D6ilKyej.js";import"./VTable-C9iI5FpE.js";import"./filter-B_Unl2Xa.js";import"./ssrBoot-CyPAIHjd.js";import"./VTooltip-C53oNYZS.js";const xe={key:0},Ce={style:{width:"50px"}},st={__name:"announce",setup(Te){const V=K(),H=X(),{t:n}=Y(),{mobile:A}=Z(),L=c(window.innerHeight),f=c([]),b=c(!1),_=()=>{if(V.room.id===0)return;b.value=!0;const r={roomID:V.room.id};R.announce.get(r).then(a=>{a.data!==""&&(f.value=JSON.parse(a.data))}).finally(()=>{b.value=!1})},J=[{key:"status",title:n("tools.announce.form.status.title")},{key:"interval",title:n("tools.announce.form.interval.title"),minWidth:120},{key:"content",title:n("tools.announce.form.content.title")},{key:"actions",title:n("tools.announce.actions")}],g=c(!1),w=c(!1),G=(r,a=!1)=>{a?(w.value=!0,i.value={...r}):(w.value=!1,i.value={id:"",status:!0,interval:600,content:""}),re(()=>{h.value&&h.value.resetValidation()}),g.value=!0},h=c(),i=c({id:"",status:!0,interval:600,content:""}),O=c({content:[r=>r?r.includes('"')||r.includes("'")?n("tools.announce.form.content.rule"):!0:n("tools.announce.form.content.required")]}),S=c(!1),W=async()=>{const{valid:r}=await h.value.validate();if(r){if(i.value.content=i.value.content.replace(/['"]/g,""),w.value){for(let u=0;u<f.value.length;u++)if(f.value[u].id===i.value.id){f.value[u]=i.value;break}}else S.value=!0,i.value.id=ue(),f.value.push(i.value);const a={roomID:V.room.id,setting:JSON.stringify(f.value)};R.announce.put(a).then(u=>{q(u.message),g.value=!1,_()}).finally(()=>{S.value=!1})}},x=c(!1),j=r=>{x.value=!0;const a=f.value.filter(l=>l.id!==r),u={roomID:V.room.id,setting:JSON.stringify(a)};R.announce.put(u).then(l=>{q(n("tools.announce.deleteMessage")),_()}).finally(()=>{x.value=!1})},U=te(()=>{L.value=window.innerHeight},200),C=()=>Math.max(2,Math.floor(L.value-150));return ee(()=>{window.addEventListener("resize",U),_()}),oe(()=>{window.removeEventListener("resize",U)}),(r,a)=>{const u=Q;return d(),y(T,null,[e(V).gameVersion.local!==0?(d(),y(T,{key:0},[e(V).room.id!==0?(d(),p(B,{key:0},{default:t(()=>[o(ne,{border:"",rounded:""},{default:t(()=>[o(de,{headers:J,items:e(f),loading:e(b)},{loading:t(()=>[o(ve,{type:"table-row@10"})]),top:t(()=>[o(fe,{flat:""},{default:t(()=>[o(pe,null,{default:t(()=>[o(D,{icon:"ri-chat-smile-ai-3-line",start:""}),e(A)?ae("",!0):(d(),y("span",xe,s(e(n)("tools.announce.title")),1))]),_:1}),o(v,{"prepend-icon":"ri-add-line",color:"success",onClick:G},{default:t(()=>[m(s(e(n)("tools.announce.add")),1)]),_:1}),o(v,{"prepend-icon":"ri-refresh-line",loading:e(b),color:"default",onClick:_},{default:t(()=>[m(s(e(n)("tools.announce.refresh")),1)]),_:1},8,["loading"])]),_:1})]),"item.status":t(({value:l})=>[l?(d(),p(k,{key:0,label:"",color:"success"},{default:t(()=>[m(s(e(n)("tools.announce.form.status.y")),1)]),_:1})):(d(),p(k,{key:1,label:"",color:"error"},{default:t(()=>[m(s(e(n)("tools.announce.form.status.n")),1)]),_:1}))]),"item.interval":t(({value:l})=>[o(k,{label:""},{default:t(()=>[m(s(l),1)]),_:2},1024)]),"item.content":t(({value:l})=>[m(s(e(le)(l,40)),1)]),"item.actions":t(({item:l})=>[o(v,{color:"info","append-icon":"ri-arrow-drop-down-line",variant:"text",loading:e(x)},{default:t(()=>[m(s(e(n)("tools.announce.actions"))+" ",1),o(me,{activator:"parent"},{default:t(()=>[o(ce,null,{default:t(()=>[o(z,{class:"text-info",onClick:P=>G(l,!0)},{prepend:t(()=>[o(D,{icon:"ri-edit-line",size:"22"})]),default:t(()=>[o(M,null,{default:t(()=>[m(s(e(n)("tools.announce.update")),1)]),_:1})]),_:1},8,["onClick"]),o(z,{class:"text-error",onClick:P=>j(l.id)},{prepend:t(()=>[o(D,{icon:"ri-delete-bin-line",size:"22"})]),default:t(()=>[o(M,null,{default:t(()=>[m(s(e(n)("tools.announce.delete")),1)]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["loading"])]),_:1},8,["items","loading"])]),_:1})]),_:1})):(d(),p(u,{key:1,title:e(n)("global.noRoomSelected.title"),"sub-title":e(n)("global.noRoomSelected.subTitle"),type:"error",height:C()},{default:t(()=>[o(v,{to:"/rooms",class:"mt-4"},{default:t(()=>[m(s(e(n)("global.noRoomSelected.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"]))],64)):(d(),y(T,{key:1},[e(H).userInfo.role==="admin"?(d(),p(u,{key:0,title:e(n)("global.noGame.title"),"sub-title":e(n)("global.noGame.subTitle"),height:C(),type:"error"},{default:t(()=>[o(v,{to:"/install",class:"mt-4"},{default:t(()=>[m(s(e(n)("global.noGame.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"])):(d(),p(u,{key:1,title:e(n)("global.noGameNoAdmin.title"),"sub-title":e(n)("global.noGameNoAdmin.subTitle"),height:C(),type:"error"},null,8,["title","sub-title","height"]))],64)),o(Se,{modelValue:e(g),"onUpdate:modelValue":a[4]||(a[4]=l=>ie(g)?g.value=l:null),width:e(A)?"90%":"60%"},{default:t(()=>[o(B,null,{default:t(()=>[o(_e,{ref_key:"announceFormRef",ref:h,class:"ma-4",onSubmit:se(W,["prevent"])},{default:t(()=>[o(Ve,null,{default:t(()=>[$("span",null,s(e(n)("tools.announce.title")),1)]),_:1}),o(ge,{class:"my-8"},{default:t(()=>[o(I,{class:"mb-8"},{default:t(()=>[o(he,{modelValue:e(i).status,"onUpdate:modelValue":a[0]||(a[0]=l=>e(i).status=l),inline:""},{prepend:t(()=>[F((d(),p(k,null,{default:t(()=>[m(s(e(n)("tools.announce.form.status.title")),1)]),_:1})),[[N,e(n)("tools.announce.form.status.tip")]])]),default:t(()=>[o(E,{label:e(n)("tools.announce.form.status.y"),value:!0,class:"mr-4"},null,8,["label"]),o(E,{label:e(n)("tools.announce.form.status.n"),value:!1,class:"mr-4"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),o(I,{class:"mb-8"},{default:t(()=>[F((d(),p(ye,{modelValue:e(i).interval,"onUpdate:modelValue":a[1]||(a[1]=l=>e(i).interval=l),label:e(n)("tools.announce.form.interval.title"),min:1,style:{"margin-bottom":"-1.25rem"}},{"append-inner":t(()=>[$("div",Ce,s(e(n)("tools.announce.form.interval.unit")),1)]),_:1},8,["modelValue","label"])),[[N,e(n)("tools.announce.form.interval.tip")]])]),_:1}),o(I,null,{default:t(()=>[F(o(ke,{modelValue:e(i).content,"onUpdate:modelValue":a[2]||(a[2]=l=>e(i).content=l),label:e(n)("tools.announce.form.content.title"),rules:e(O).content},null,8,["modelValue","label","rules"]),[[N,e(n)("tools.announce.form.content.tip")]])]),_:1})]),_:1}),o(be,null,{default:t(()=>[o(we),o(v,{color:"default",variant:"elevated",text:e(n)("login.cancel"),class:"mr-4",onClick:a[3]||(a[3]=l=>g.value=!1)},null,8,["text"]),o(v,{text:e(n)("login.submit"),loading:e(S),variant:"elevated",type:"submit"},null,8,["text","loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue","width"])],64)}}};export{st as default};
