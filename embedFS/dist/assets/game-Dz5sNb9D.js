import{_ as ee}from"./Result-xqSnAKSL.js";import $ from"./log-CaN54nWu.js";import{l as R}from"./logs-DE_RC-hc.js";import{r as te}from"./room-DQiKG7g9.js";import{g as le,d as oe,e as ae,b as se,f as n,j as ie,a4 as ne,N as re,c as C,l as e,o as s,y as m,F as I,a as o,w as a,q as b,t as g,s as p,k as w,A as N,p as U}from"./index-CkNbSyGh.js";import{c as E,d as ue,e as P,f as de}from"./VTabs-BbC7Q4fN.js";import{V as W,c as j,a as z}from"./VCard-Chgb7NQr.js";import{V as q}from"./VSelect-CCrSk_bo.js";import{V as me}from"./VSwitch-CRGgI9r1.js";import{V as ce}from"./VChip-BYgMm5U1.js";import{V as ge}from"./VRow-o-C5n2ML.js";import{V as fe}from"./VSpacer-Dtma9HxP.js";import{V as he}from"./VCol-C-U-3BfA.js";import{V as pe}from"./VNumberInput-TcAp__mn.js";import"./VContainer-DphP_HXU.js";/* empty css              */import"./preview-HPe2Ucko.js";import"./axios-D9wugClK.js";import"./ssrBoot-vMFB3qzm.js";import"./VInput-DAl67pJ-.js";import"./index-C_E8fDh9.js";import"./VTextField-CIbt9Jw8.js";import"./VList-B4ZoK83V.js";import"./VMenu-D2l1j7S0.js";import"./dialog-transition-CkYDvwCe.js";import"./VCheckboxBtn-DTkK2TZk.js";import"./VSelectionControl-CV465D96.js";const ve={class:"card-header"},ye={class:"fcc"},Ve={class:"card-header"},be={class:"fcc"},Oe={__name:"game",setup(we){const f=le(),J=oe(),{mobile:K}=ae(),{t:l}=se(),v=n("current"),y=n(""),d=n(0),T=n(!0),V=n(0),O=u=>{u==="current"&&(D.value=!0),u==="history"&&(D.value=!1)},S=n(!1),D=n(!0),B=()=>{if(d.value===0||!D.value)return;const u={roomID:f.room.id,worldID:d.value,logType:"game",lines:V.value};R.content.get(u).then(t=>{t.data===null?y.value="":y.value=t.data.join(`
`),S.value=!0})},F=n([]),Q=async()=>{const u={roomID:f.room.id},t=await te.worlds.get(u);F.value=t.data,d.value=F.value[0]?.id||0},H=n([]),X=()=>{const u={roomID:f.room.id,worldID:d.value,logType:"game"};R.history.list.get(u).then(t=>{H.value=t.data})},_=n(""),k=n(""),h=n(!1),Y=()=>{h.value=!0;const u={roomID:f.room.id,worldID:d.value,logType:"game",logFile:_.value};R.history.content.get(u).then(t=>{k.value="",k.value=t.data}).finally(()=>{h.value=!1})};let x=null;const Z=()=>{x=setInterval(()=>{T.value&&B()},2e3)},M=()=>{x&&(clearInterval(x),x=null)},A=()=>Math.round(Math.max(2,Math.floor(L.value-427))/22.5),r=()=>Math.max(2,Math.floor(L.value-160-37)),L=n(window.innerHeight),G=ne(()=>{L.value=window.innerHeight,V.value=A()},200);return ie(async()=>{f.room.id!==0&&(window.addEventListener("resize",G),await Q(),X(),V.value=A(),Z())}),re(()=>{M(),window.removeEventListener("beforeunload",M),window.removeEventListener("resize",G)}),(u,t)=>{const c=ee;return e(f).gameVersion.local!==0?(s(),C(I,{key:0},[e(f).room.id!==0?(s(),C(I,{key:0},[o(ue,{modelValue:e(v),"onUpdate:modelValue":[t[0]||(t[0]=i=>p(v)?v.value=i:null),O],"align-tabs":"start",color:"primary","show-arrows":""},{default:a(()=>[o(E,{value:"current"},{default:a(()=>[b(g(e(l)("logs.current")),1)]),_:1}),o(E,{value:"history"},{default:a(()=>[b(g(e(l)("logs.history")),1)]),_:1})]),_:1},8,["modelValue"]),o(de,{modelValue:e(v),"onUpdate:modelValue":t[8]||(t[8]=i=>p(v)?v.value=i:null),class:"mt-4"},{default:a(()=>[o(P,{value:"current"},{default:a(()=>[o(W,{height:r()},{default:a(()=>[o(j,{class:"my-2"},{default:a(()=>[w("div",ve,[w("span",null,g(e(l)("logs.current")),1),w("div",ye,[o(q,{modelValue:e(d),"onUpdate:modelValue":[t[1]||(t[1]=i=>p(d)?d.value=i:null),t[2]||(t[2]=i=>{y.value="",S.value=!1})],items:e(F),"item-title":"worldName","item-value":"id",label:e(l)("logs.world"),density:"compact",class:"mr-4"},null,8,["modelValue","items","label"]),o(me,{modelValue:e(T),"onUpdate:modelValue":t[3]||(t[3]=i=>p(T)?T.value=i:null),color:"info","hide-details":""},{prepend:a(()=>[o(ce,{color:"info"},{default:a(()=>[b(g(e(l)("logs.autoPull")),1)]),_:1})]),_:1},8,["modelValue"])])])]),_:1}),o(z,null,{default:a(()=>[e(S)?(s(),C(I,{key:0},[e(y)?(s(),m($,{key:0,content:e(y),height:r()-150},null,8,["content","height"])):(s(),m(c,{key:1,type:"info",height:r()-150,title:e(l)("logs.noContent")},null,8,["height","title"]))],64)):(s(),m(c,{key:1,type:"info",title:e(l)("logs.fetching"),height:r()-150},null,8,["title","height"])),o(ge,{class:"my-4"},{default:a(()=>[e(K)?N("",!0):(s(),m(fe,{key:0})),o(he,{class:"d-flex align-center justify-end"},{default:a(()=>[o(pe,{modelValue:e(V),"onUpdate:modelValue":t[4]||(t[4]=i=>p(V)?V.value=i:null),label:e(l)("logs.line"),"hide-details":"",density:"compact",class:"mr-4","max-width":"120"},null,8,["modelValue","label"]),o(U,{onClick:B},{default:a(()=>[b(g(e(l)("logs.pull")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["height"])]),_:1}),o(P,{value:"history"},{default:a(()=>[o(W,{height:r()},{default:a(()=>[o(j,{class:"my-2"},{default:a(()=>[w("div",Ve,[w("span",null,g(e(l)("logs.history")),1),w("div",be,[o(q,{modelValue:e(d),"onUpdate:modelValue":[t[5]||(t[5]=i=>p(d)?d.value=i:null),t[6]||(t[6]=i=>y.value="")],items:e(F),"item-title":"worldName","item-value":"id",label:e(l)("logs.world"),density:"compact",class:"mr-4","min-width":"100px"},null,8,["modelValue","items","label"]),o(q,{modelValue:e(_),"onUpdate:modelValue":[t[7]||(t[7]=i=>p(_)?_.value=i:null),Y],items:e(H),disabled:e(h),loading:e(h),label:e(l)("logs.logFile"),density:"compact","min-width":"100px"},null,8,["modelValue","items","disabled","loading","label"])])])]),_:1}),o(z,null,{default:a(()=>[e(_)?(s(),C(I,{key:0},[!e(h)&&e(k)?(s(),m($,{key:0,content:e(k),height:r()-150},null,8,["content","height"])):N("",!0),e(h)?(s(),m(c,{key:1,type:"info",title:e(l)("logs.fetching"),height:r()-150},null,8,["title","height"])):N("",!0),!e(h)&&!e(k)?(s(),m(c,{key:2,type:"info",height:r()-150,title:e(l)("logs.noContent")},null,8,["height","title"])):N("",!0)],64)):(s(),m(c,{key:1,type:"info",height:r()-150,title:e(l)("logs.noLogFile")},null,8,["height","title"]))]),_:1})]),_:1},8,["height"])]),_:1})]),_:1},8,["modelValue"])],64)):(s(),m(c,{key:1,title:e(l)("global.noRoomSelected.title"),"sub-title":e(l)("global.noRoomSelected.subTitle"),type:"error",height:r()},{default:a(()=>[o(U,{to:"/rooms",class:"mt-4"},{default:a(()=>[b(g(e(l)("global.noRoomSelected.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"]))],64)):(s(),C(I,{key:1},[e(J).userInfo.role==="admin"?(s(),m(c,{key:0,title:e(l)("global.noGame.title"),"sub-title":e(l)("global.noGame.subTitle"),height:r(),type:"error"},{default:a(()=>[o(U,{to:"/install",class:"mt-4"},{default:a(()=>[b(g(e(l)("global.noGame.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"])):(s(),m(c,{key:1,title:e(l)("global.noGameNoAdmin.title"),"sub-title":e(l)("global.noGameNoAdmin.subTitle"),height:r(),type:"error"},null,8,["title","sub-title","height"]))],64))}}};export{Oe as default};
