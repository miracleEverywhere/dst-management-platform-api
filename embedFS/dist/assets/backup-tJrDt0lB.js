import{_ as R}from"./Result-DgP0Q5NP.js";import{h as y}from"./axios-lI9Ovfql.js";import{g as U,d as J,b as K,e as O,h as p,f as W,c as x,l as t,o as f,y as v,w as e,a as o,a7 as X,s as Y,p as k,q as n,t as r,P as I,Q as T,G as w,bx as Z,a8 as ee,E as M,F as q,B as C}from"./index-DSqAz1aK.js";import{c as te,a as oe,V as ae}from"./VCard-DJ_zJ5IC.js";import{V as le}from"./VDataTable-BMT0ptc-.js";import{V as se}from"./VMenu-D73OD9NE.js";import{V as re}from"./VList-BEO0zeM6.js";import{V as B}from"./VChip-DOXEbDsk.js";import{V as ie,a as ne}from"./VToolbar-CQs50T8b.js";import{V as ue}from"./VSkeletonLoader-DzKgvitt.js";import"./VContainer-B5popFB1.js";/* empty css              */import"./VPagination-CiEfj4as.js";import"./VSelect-DxoiOzce.js";import"./VTextField-l-FdgV9P.js";import"./index-9rJqgBB5.js";import"./VInput-BKyi7uEB.js";import"./VCheckboxBtn-BRs82zRR.js";import"./VSelectionControl-BBgZzpZM.js";import"./dialog-transition-BcXBGmd8.js";import"./VTable-CUNexpgN.js";import"./filter-BwAfjlZ8.js";import"./ssrBoot-DOEArNsD.js";import"./VSlideGroup-BYN7qME8.js";const g={backup:{url:"/tools/backup",get:async function(c){return await y.get(this.url,c)},post:async function(c){return await y.post(this.url,c)},delete:async function(c){return await y.delete(this.url,c)},restore:{url:"/tools/backup/restore",post:async function(c){return await y.post(this.url,c)}},download:{url:"/tools/backup/download",download:async function(c,u){return await y.download(this.url,c,u)}}}},ce={key:0},Me={__name:"backup",setup(c){const u=U(),G=J(),{t:a}=K(),{mobile:L}=O(),$=p(window.innerHeight),V=p(!1),D=p([]),h=()=>{if(u.room.id===0)return;V.value=!0;const i={roomID:u.room.id};g.backup.get(i).then(l=>{D.value=l.data,D.value.sort((m,s)=>s.timestamp-m.timestamp)}).finally(()=>{V.value=!1})},b=p([]),A=[{key:"gameName",title:a("tools.backup.gameName")},{key:"cycles",title:a("tools.backup.cycles")},{key:"size",title:a("tools.backup.size")},{key:"timestamp",title:a("tools.backup.timestamp")},{key:"actions",title:a("tools.backup.actions")}],d=p(!1),F=p(!1),E=()=>{F.value=!0;const i={roomID:u.room.id};g.backup.post(i).then(l=>{h(),C(l.message)}).finally(()=>{F.value=!1})},_=p(!1),H=i=>{_.value=!0,d.value=!0;const l={roomID:u.room.id,filenames:[i]};g.backup.delete(l).then(m=>{h(),C(a("tools.backup.deleteMessage1")+m.data+a("tools.backup.deleteMessage2"))}).finally(()=>{_.value=!1,d.value=!1})},j=()=>{_.value=!0,d.value=!0;const i={roomID:u.room.id,filenames:b.value.map(l=>l.fileName)};g.backup.delete(i).then(l=>{h(),b.value=[],C(a("tools.backup.deleteMessage1")+l.data+a("tools.backup.deleteMessage2"))}).finally(()=>{_.value=!1,d.value=!1})},S=p(!1),P=i=>{d.value=!0,S.value=!0;const l={roomID:u.room.id,filename:i};g.backup.restore.post(l).then(m=>{C(m.message)}).finally(()=>{S.value=!1,d.value=!1})},Q=i=>{d.value=!0;const l={roomID:u.room.id,filename:i};g.backup.download.download(l,"dmp_backup.zip").finally(()=>{d.value=!1})},N=()=>Math.max(2,Math.floor($.value-150));return W(()=>{h()}),(i,l)=>{const m=R;return t(u).gameVersion.local!==0?(f(),x(q,{key:0},[t(u).room.id!==0?(f(),v(ae,{key:0},{default:e(()=>[o(te),o(oe,null,{default:e(()=>[o(X,{border:"",rounded:"",class:"mt-4"},{default:e(()=>[o(le,{modelValue:t(b),"onUpdate:modelValue":l[0]||(l[0]=s=>Y(b)?b.value=s:null),"show-select":"","return-object":"",headers:A,items:t(D),loading:t(V)},{loading:e(()=>[o(ue,{type:"table-row@10"})]),top:e(()=>[o(ie,{flat:""},{default:e(()=>[o(ne,null,{default:e(()=>[o(w,{icon:"ri-save-2-line",start:""}),t(L)?M("",!0):(f(),x("span",ce,r(t(a)("tools.backup.title")),1))]),_:1}),o(k,{"prepend-icon":"ri-add-line",color:"success",loading:t(F),onClick:E},{default:e(()=>[n(r(t(a)("tools.backup.backup")),1)]),_:1},8,["loading"]),o(k,{"prepend-icon":"ri-add-line",color:"error",disabled:t(b).length===0,loading:t(_),onClick:j},{default:e(()=>[n(r(t(a)("tools.backup.multiDelete")),1)]),_:1},8,["disabled","loading"]),t(L)?M("",!0):(f(),v(k,{key:0,"prepend-icon":"ri-refresh-line",loading:t(V),color:"default",onClick:h},{default:e(()=>[n(r(t(a)("platform.user.table.refresh")),1)]),_:1},8,["loading"]))]),_:1})]),"item.gameName":e(({value:s})=>[o(B,{label:"",color:"primary"},{default:e(()=>[n(r(s),1)]),_:2},1024)]),"item.cycles":e(({value:s})=>[o(B,{label:"",color:"info"},{default:e(()=>[n(r(s),1)]),_:2},1024)]),"item.size":e(({value:s})=>[o(B,{label:"",color:"success"},{default:e(()=>[n(r(t(ee)(s)),1)]),_:2},1024)]),"item.timestamp":e(({value:s})=>[o(B,{label:"",color:"default"},{default:e(()=>[n(r(t(Z)(s)),1)]),_:2},1024)]),"item.actions":e(({item:s})=>[o(k,{color:"info","append-icon":"ri-arrow-drop-down-line",variant:"text",loading:t(d)},{default:e(()=>[n(r(t(a)("tools.backup.actions"))+" ",1),o(se,{activator:"parent"},{default:e(()=>[o(re,null,{default:e(()=>[o(I,{class:"text-success",onClick:z=>P(s.fileName)},{prepend:e(()=>[o(w,{icon:"ri-device-recover-line",size:"22"})]),default:e(()=>[o(T,null,{default:e(()=>[n(r(t(a)("tools.backup.restore")),1)]),_:1})]),_:1},8,["onClick"]),o(I,{class:"text-info",onClick:z=>Q(s.fileName)},{prepend:e(()=>[o(w,{icon:"ri-download-line",size:"22"})]),default:e(()=>[o(T,null,{default:e(()=>[n(r(t(a)("tools.backup.download")),1)]),_:1})]),_:1},8,["onClick"]),o(I,{class:"text-error",onClick:z=>H(s.fileName)},{prepend:e(()=>[o(w,{icon:"ri-delete-bin-line",size:"22"})]),default:e(()=>[o(T,null,{default:e(()=>[n(r(t(a)("tools.backup.delete")),1)]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["loading"])]),_:1},8,["modelValue","items","loading"])]),_:1})]),_:1})]),_:1})):(f(),v(m,{key:1,title:t(a)("global.result.title"),"sub-title":t(a)("global.result.subTitle"),type:"error",height:N()},{default:e(()=>[o(k,{to:"/rooms",class:"mt-4"},{default:e(()=>[n(r(t(a)("global.result.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"]))],64)):(f(),x(q,{key:1},[t(G).userInfo.role==="admin"?(f(),v(m,{key:0,title:t(a)("global.noGame.title"),"sub-title":t(a)("global.noGame.subTitle"),height:N(),type:"error"},{default:e(()=>[o(k,{to:"/install",class:"mt-4"},{default:e(()=>[n(r(t(a)("global.noGame.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"])):(f(),v(m,{key:1,title:t(a)("global.noGameNoAdmin.title"),"sub-title":t(a)("global.noGameNoAdmin.subTitle"),height:N(),type:"error"},null,8,["title","sub-title","height"]))],64))}}};export{Me as default};
