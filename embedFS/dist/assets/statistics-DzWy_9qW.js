import{_ as S}from"./index-BH9DcOwJ.js";import{g as T,e as A,b as F,f as s,j as R,c as B,o as D,a as e,w as a,k as c,t as p,l,p as v,q as x,F as I,aF as L}from"./index-CkNbSyGh.js";import{p as C}from"./player-DORFM8er.js";import{c as b,a as w,V}from"./VCard-Chgb7NQr.js";import"./axios-D9wugClK.js";const O={class:"card-header"},q={class:"card-header"},M={__name:"statistics",setup(N){const g=T();A();const{t:r}=F(),k=s(),i=s({tooltip:{trigger:"axis"},xAxis:{type:"category",data:[]},yAxis:{type:"value"},series:[{data:[],type:"line",smooth:!0,areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(1, 255, 255, 0.8)"},{offset:1,color:"rgba(1, 255, 255,0)"}],global:!1}}}]}),h=s(),u=s({tooltip:{trigger:"item",formatter:`{b}: {c}${r("game.player.statistics.pieChart.unit")}`},legend:{top:"5%",left:"center"},series:[{name:"Top-10",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,padAngle:5,itemStyle:{borderRadius:10},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:40,fontWeight:"bold"}},labelLine:{show:!1},data:[]}]}),d=s(!1),_=()=>{d.value=!0;const n={roomID:g.room.id};C.statistics.playerCount.get(n).then(o=>{if(o.data!=null){i.value.xAxis.data=[],i.value.series[0].data=[];for(let t of o.data)i.value.xAxis.data.push(L(t.timestamp)),i.value.series[0].data.push(t?.playerInfo?.length||0)}}).finally(()=>{d.value=!1})},f=s(!1),y=()=>{f.value=!0;const n={roomID:g.room.id};C.statistics.onlineTime.get(n).then(o=>{o.data!=null&&(u.value.series[0].data=Object.entries(o.data).sort((t,m)=>m[1]-t[1]).slice(0,10).map(([t,m])=>({value:(m/480).toFixed(0),name:t})),h.value.redraw(u.value))}).finally(()=>{f.value=!1})};return R(()=>{_(),y()}),(n,o)=>{const t=S;return D(),B(I,null,[e(V,{class:"mb-8"},{default:a(()=>[e(b,null,{default:a(()=>[c("div",O,[c("span",null,p(l(r)("game.player.statistics.lineChart.title")),1),e(v,{loading:l(d),color:"default",onClick:_},{default:a(()=>[x(p(l(r)("platform.metrics.refresh")),1)]),_:1},8,["loading"])])]),_:1}),e(w,null,{default:a(()=>[e(t,{ref_key:"playerChartRef",ref:k,option:l(i),height:"50vh"},null,8,["option"])]),_:1})]),_:1}),e(V,null,{default:a(()=>[e(b,null,{default:a(()=>[c("div",q,[c("span",null,p(l(r)("game.player.statistics.pieChart.title")),1),e(v,{loading:l(f),color:"default",onClick:y},{default:a(()=>[x(p(l(r)("platform.metrics.refresh")),1)]),_:1},8,["loading"])])]),_:1}),e(w,null,{default:a(()=>[e(t,{ref_key:"pieChartRef",ref:h,option:l(u),height:"75vh",width:"75vw"},null,8,["option"])]),_:1})]),_:1})],64)}}};export{M as default};
