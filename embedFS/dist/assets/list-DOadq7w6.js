import{g as j,e as G,b as H,h as n,f as J,r as Q,y as _,o as f,w as l,a,k,t as u,l as o,p as w,q as y,s as R,c as S,F as W,v as X,E as Y,ab as Z,B as g,aw as ee}from"./index-CUqMz98Q.js";import{p as b}from"./player-BWGRp2vE.js";import{c as N,V as U,a as $}from"./VCard-CCXXQnDc.js";import{V as te}from"./VDialog-BvP4GPN7.js";import{V as q}from"./VAlert-CnUevvd0.js";import{V as le}from"./VContainer-Qfl3VloT.js";import{V as ae}from"./VRow-DjJRgvp1.js";import{V as oe}from"./VCol-CNyyfCgI.js";import{V as se}from"./VChip-D52a5STx.js";import{V as re}from"./VTextField-BC-Dauxh.js";import"./axios-BviZ8UZz.js";import"./dialog-transition-DKWwBUaX.js";/* empty css              */import"./index-DMUK-Sdt.js";import"./VInput-DLKXZnps.js";const ie={class:"card-header my-2"},ne={key:0},ue={class:"d-flex align-center",style:{width:"160px"}},be={__name:"list",props:{listType:{type:String,default:""},height:{type:Number,default:0},uidmap:{type:Array,default:()=>[]}},setup(A){const i=A,C=j(),{mobile:E}=G(),{t:s}=H(),x=n([]),D=n(!1),h=(r=!1)=>{D.value=!0;const e={roomID:C.room.id,listType:i.listType};b.list.get(e).then(c=>{x.value=c.data||[],r&&g(s("game.player.list.refreshSuccess"))}).finally(()=>{D.value=!1})},F=n(!1),I=(r,e)=>{F.value=!0;const c={roomID:C.room.id,listType:i.listType,uids:[r],actionType:e};b.list.post(c).then(t=>{g(t.message),h()}).finally(()=>{F.value=!1})},T=n(!1),B=n(),d=n(""),z=()=>{T.value=!0,ee(()=>{B.value.focus()})},L=()=>{if(d.value){if(!/^KU_/.test(d.value)){g(s("game.player.list.uidValid"),"error");return}I(d.value,"add")}T.value=!1,d.value=""},p=n(!1),K=()=>{p.value=!0},P=r=>/\.txt$/i.test(r.name),v=n(!1),M=r=>{if(v.value=!0,!P(r)){g(s("game.player.list.import.fileTypeError"),"error"),p.value=!1,v.value=!1;return}const e=new FileReader;e.readAsText(r),e.onload=()=>{const t=e.result.split(`
`),m=[];for(let V of t)V!==""&&m.push(V);const O={roomID:C.room.id,listType:i.listType,uids:m,actionType:"add"};b.list.post(O).then(V=>{g(V.message),h()}).finally(()=>{v.value=!1,p.value=!1})},e.onerror=()=>{g(s("game.player.list.import.fileReadError"),"error"),v.value=!1,p.value=!1}};return J(()=>{h()}),(r,e)=>{const c=Q("v-file-upload");return f(),_(U,{class:"mt-4",height:i.height-70},{default:l(()=>[a(N,null,{default:l(()=>[k("div",ie,[k("span",null,u(o(s)(`game.player.list.${i.listType}`)),1),k("div",null,[a(w,{class:"mr-2",onClick:K},{default:l(()=>[y(u(o(s)("game.player.list.import.title")),1)]),_:1}),a(te,{modelValue:o(p),"onUpdate:modelValue":e[0]||(e[0]=t=>R(p)?p.value=t:null),width:o(E)?"90%":"45%"},{default:l(()=>[a(U,null,{default:l(()=>[a(N),a($,null,{default:l(()=>[a(q,{color:"warning",density:"compact",class:"mt-2 mb-2"},{default:l(()=>[y(u(o(s)("game.player.list.import.tip")),1)]),_:1}),a(c,{density:"default",icon:"ri-upload-cloud-2-line","onUpdate:modelValue":M})]),_:1})]),_:1})]),_:1},8,["modelValue","width"]),a(w,{color:"default",onClick:e[1]||(e[1]=t=>h(!0))},{default:l(()=>[y(u(o(s)("game.player.list.refresh")),1)]),_:1})])])]),_:1}),a($,null,{default:l(()=>[a(le,{fluid:"",height:i.height-152,style:{"overflow-y":"auto"}},{default:l(()=>[a(ae,null,{default:l(()=>[a(q,{color:"success",density:"compact"},{default:l(()=>[y(u(o(s)("game.player.list.tip")),1)]),_:1}),a(oe,{class:"mt-4",cols:"12"}),(f(!0),S(W,null,X(o(x),t=>(f(),_(se,{key:t,closable:"",color:"info",class:"mt-2 mr-2",label:"",size:"large","onClick:close":m=>I(t,"delete")},{default:l(()=>[y(u(t)+" ",1),(i.uidmap.find(m=>m.uid===t)?.nickname||"")!==""?(f(),S("span",ne," ("+u(i.uidmap.find(m=>m.uid===t)?.nickname||"")+") ",1)):Y("",!0)]),_:2},1032,["onClick:close"]))),128)),k("div",ue,[o(T)?(f(),_(re,{key:0,ref_key:"inputRef",ref:B,modelValue:o(d),"onUpdate:modelValue":e[2]||(e[2]=t=>R(d)?d.value=t:null),density:"compact",placeholder:o(s)("game.player.list.placeholder"),class:"mt-2",onKeyup:Z(L,["enter"]),onBlur:L},null,8,["modelValue","placeholder"])):(f(),_(w,{key:1,variant:"tonal","append-icon":"ri-add-line",color:"default",class:"mt-2 mr-2",onClick:z},{default:l(()=>[y(u(o(s)("game.player.list.add")),1)]),_:1}))])]),_:1})]),_:1},8,["height"])]),_:1})]),_:1},8,["height"])}}};export{be as default};
