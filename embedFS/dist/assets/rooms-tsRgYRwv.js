import{_ as le}from"./ConfirmBox-CTsGBcIg.js";import{e as te,b as oe,g as re,f as u,c as q,o as g,a as l,w as e,p as K,l as a,ag as se,x as U,ac as ne,s as A,v as n,t as s,U as S,W as N,J as h,ab as E,A as k,D as z,V as G,aa as ie,k as B,F as J,y as de,G as I}from"./index-ClrSl1t3.js";import{r as L}from"./room-Ey6piun-.js";import{p as O}from"./platform-BR1jW48B.js";import{V as y}from"./VRow-CbuO1l1g.js";import{V as v}from"./VCol-sdmSdw58.js";import{V as me}from"./VTextField-C20ssUm5.js";import{V as ue}from"./VDataTableServer-OEEiFo-L.js";import{V as fe}from"./VMenu-DVaqAgsw.js";import{V as ce}from"./VList-CRtGEhVV.js";import{V as f}from"./VChip-DSSyFDgp.js";import{V as pe,a as ge}from"./VToolbar-BFcJYwkc.js";import{V as H}from"./VAlert-CWRnRAJx.js";import{V as ve}from"./VDialog-bsWPHVbc.js";import"./VSpacer-B5Fd494L.js";/* empty css              */import"./axios-DEwtRmaY.js";import"./index-rIMhUL3t.js";import"./VInput-Dh0vzV9z.js";import"./VDataTable-CLPCrmWo.js";import"./VPagination-DeZtXGve.js";import"./VSelect-HjFTEHVC.js";import"./VCheckboxBtn-CD061qxM.js";import"./VSelectionControl-DRns-ek4.js";import"./dialog-transition-BOVVgIJg.js";import"./VTable-BFIhFo8s.js";import"./filter-BbPhtgdI.js";import"./ssrBoot-4_sUra1R.js";const _e={key:0},Je={__name:"rooms",setup(be){const{mobile:W}=te(),{t:r}=oe(),T=re(),P=u(""),i=u({rows:[],page:1,pageSize:10,total:0}),x=u(!1),_=({page:d,itemsPerPage:o,sortBy:c})=>{const t={gameName:P.value,page:d,pageSize:o};x.value=!0,L.list.get(t).then(m=>{i.value=m.data,i.value.rows=m.data.rows||[]}).finally(()=>{x.value=!1})},Q=[{title:"ID",value:"id"},{title:r("platform.rooms.headers.gameName"),value:"gameName",minWidth:150},{title:r("platform.rooms.headers.status"),value:"status"},{title:r("platform.rooms.headers.maxPlayer"),value:"maxPlayer",minWidth:120},{title:r("platform.rooms.headers.worldNum"),value:"worldNum"},{title:r("platform.rooms.headers.modNum"),value:"modNum"},{title:r("platform.rooms.headers.serverPort"),value:"serverPort"},{title:r("platform.rooms.headers.actions"),value:"actions"}],C=u(!1),p=u({id:void 0,gameName:"",gameMode:"",ports:[],screens:[]}),j=u(!1),X=async d=>{C.value=!0,j.value=!0;const o={roomID:T.room.id},c=[],t=await O.screen.running.get(o);for(let V of t.data)V!==""&&c.push(V);const m=[];m.push(d.masterPort);for(let V of d.worlds)m.push(V.serverPort),m.push(V.masterServerPort),m.push(V.authenticationPort);p.value={id:d.id,gameName:d.gameName,gameMode:d.gameMode,ports:m,screens:c},j.value=!1},$=u(!1),Y=d=>{$.value=!0;const o={screenName:d};O.screen.kill.post(o).then(c=>{I(c.message)}).finally(()=>{$.value=!1})},D=(d,o)=>{switch(d){case"details":X(o);break;case"activate":Z(o);break;case"deactivate":ee(o);break;case"delete":R.value=o.id,b.value=!0;break}},F=u(!1),Z=d=>{F.value=!0;const o={roomID:d.id};L.activate.post(o).then(c=>{I(c.message),_({page:i.value.page,itemsPerPage:i.value.pageSize,sortBy:void 0})}).finally(()=>{F.value=!1})},M=u(!1),ee=d=>{M.value=!0;const o={roomID:d.id};L.deactivate.post(o).then(c=>{I(c.message),_({page:i.value.page,itemsPerPage:i.value.pageSize,sortBy:void 0})}).finally(()=>{M.value=!1})},b=u(!1),R=u(0),w=u(!1),ae=()=>{w.value=!0;const d={roomID:R.value};L.base.delete(d).then(o=>{b.value=!1,I(o.message),_({page:i.value.page,itemsPerPage:i.value.pageSize,sortBy:void 0}),T.room.id===R.value&&(T.room.id=0)}).finally(()=>{w.value=!1})};return(d,o)=>{const c=le;return g(),q(J,null,[l(G,null,{default:e(()=>[l(K,null,{default:e(()=>[l(y,null,{default:e(()=>[l(v,{cols:"12"},{default:e(()=>[l(me,{modelValue:a(P),"onUpdate:modelValue":o[0]||(o[0]=t=>U(P)?P.value=t:null),label:a(r)("platform.user.search.label"),placeholder:a(r)("platform.user.search.placeholder"),clearable:"",onKeyup:o[1]||(o[1]=se(t=>_({page:a(i).page,itemsPerPage:a(i).pageSize,sortBy:void 0}),["enter"])),"onClick:clear":o[2]||(o[2]=t=>_({page:a(i).page,itemsPerPage:a(i).pageSize,sortBy:void 0}))},null,8,["modelValue","label","placeholder"])]),_:1}),l(v,{cols:"12"},{default:e(()=>[l(ne,{rounded:"",border:""},{default:e(()=>[l(ue,{"items-per-page":a(i).pageSize,"onUpdate:itemsPerPage":o[4]||(o[4]=t=>a(i).pageSize=t),items:a(i).rows,"items-length":a(i).total,page:a(i).page,loading:a(x),headers:Q,"onUpdate:options":_},{top:e(()=>[l(pe,{flat:""},{default:e(()=>[l(ge,null,{default:e(()=>[l(h,{icon:"ri-instance-line",start:""}),a(W)?z("",!0):(g(),q("span",_e,s(a(r)("platform.rooms.title")),1))]),_:1}),l(A,{"prepend-icon":"ri-refresh-line",loading:a(x),color:"default",onClick:o[3]||(o[3]=t=>_({page:a(i).page,itemsPerPage:a(i).pageSize,sortBy:void 0}))},{default:e(()=>[n(s(a(r)("platform.user.table.refresh")),1)]),_:1},8,["loading"])]),_:1})]),"item.id":e(({value:t})=>[l(f,{label:"",color:"primary"},{default:e(()=>[n(s(t),1)]),_:2},1024)]),"item.status":e(({value:t})=>[t?(g(),k(f,{key:0,color:"success",label:""},{default:e(()=>[n(s(a(r)("platform.rooms.activate")),1)]),_:1})):(g(),k(f,{key:1,color:"warning",label:""},{default:e(()=>[n(s(a(r)("platform.rooms.deactivate")),1)]),_:1}))]),"item.maxPlayer":e(({value:t})=>[l(f,{label:""},{default:e(()=>[n(s(t),1)]),_:2},1024)]),"item.worldNum":e(({item:t})=>[l(f,{label:"",color:"info"},{default:e(()=>[n(s(t.worlds.length),1)]),_:2},1024)]),"item.modNum":e(({item:t})=>[l(f,{label:"",color:"info"},{default:e(()=>[n(s(t.modInOne?a(E)(t.modData).length:a(E)(t.worlds[0].modData).length),1)]),_:2},1024)]),"item.serverPort":e(({item:t})=>[l(f,{label:"",color:"info"},{default:e(()=>[n(s(t.worlds.map(m=>m.serverPort).join(",")),1)]),_:2},1024)]),"item.actions":e(({item:t})=>[l(A,{color:"info","append-icon":"ri-arrow-drop-down-line",variant:"text",loading:a(F)||a(M)||a(w)},{default:e(()=>[n(s(a(r)("platform.user.table.actions"))+" ",1),l(fe,{activator:"parent"},{default:e(()=>[l(ce,null,{default:e(()=>[l(S,{class:"text-info",onClick:m=>D("details",t)},{prepend:e(()=>[l(h,{icon:"ri-information-2-line",size:"22"})]),default:e(()=>[l(N,null,{default:e(()=>[n(s(a(r)("platform.rooms.actions.details")),1)]),_:1})]),_:1},8,["onClick"]),l(S,{class:"text-success",disabled:t.status,onClick:m=>D("activate",t)},{prepend:e(()=>[l(h,{icon:"ri-play-large-line",size:"22"})]),default:e(()=>[l(N,null,{default:e(()=>[n(s(a(r)("platform.rooms.actions.activate")),1)]),_:1})]),_:1},8,["disabled","onClick"]),l(S,{class:"text-warning",disabled:!t.status,onClick:m=>D("deactivate",t)},{prepend:e(()=>[l(h,{icon:"ri-stop-large-line",size:"22"})]),default:e(()=>[l(N,null,{default:e(()=>[n(s(a(r)("platform.rooms.actions.deactivate")),1)]),_:1})]),_:1},8,["disabled","onClick"]),l(S,{class:"text-error",onClick:m=>D("delete",t)},{prepend:e(()=>[l(h,{icon:"ri-delete-bin-line",size:"22"})]),default:e(()=>[l(N,null,{default:e(()=>[n(s(a(r)("platform.rooms.actions.delete")),1)]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["loading"])]),_:1},8,["items-per-page","items","items-length","page","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(ve,{modelValue:a(C),"onUpdate:modelValue":o[5]||(o[5]=t=>U(C)?C.value=t:null),width:a(W)?"90%":"60%"},{default:e(()=>[l(G,null,{default:e(()=>[l(ie,null,{default:e(()=>[n(s(a(r)("platform.rooms.dialog.title")),1)]),_:1}),l(K,{class:"ma-4"},{default:e(()=>[l(y,{class:"d-flex align-center"},{default:e(()=>[l(v,null,{default:e(()=>[l(f,{label:"",color:"info",class:"mr-4"},{default:e(()=>[...o[8]||(o[8]=[n(" ID ",-1)])]),_:1}),B("span",null,s(a(p).id),1)]),_:1})]),_:1}),l(y,{class:"d-flex align-center"},{default:e(()=>[l(v,null,{default:e(()=>[l(f,{label:"",color:"info",class:"mr-4"},{default:e(()=>[n(s(a(r)("platform.rooms.dialog.data.gameName")),1)]),_:1}),B("span",null,s(a(p).gameName),1)]),_:1})]),_:1}),l(y,{class:"d-flex align-center"},{default:e(()=>[l(v,null,{default:e(()=>[l(f,{label:"",color:"info",class:"mr-4"},{default:e(()=>[n(s(a(r)("platform.rooms.dialog.data.gameMode")),1)]),_:1}),B("span",null,s(a(r)(`game.base.step1.gameMode.modes.${a(p).gameMode}`)),1)]),_:1})]),_:1}),l(y,{class:"d-flex align-center"},{default:e(()=>[l(v,null,{default:e(()=>[l(f,{label:"",color:"info",class:"mr-4"},{default:e(()=>[n(s(a(r)("platform.rooms.dialog.data.ports")),1)]),_:1}),B("span",null,s(a(p).ports.join(",")),1)]),_:1})]),_:1}),a(p).screens.length!==0?(g(),k(H,{key:0,color:"primary",density:"compact",class:"mt-8 mb-4"},{default:e(()=>[n(s(a(r)("platform.rooms.dialog.data.screenTip")),1)]),_:1})):z("",!0),a(p).screens.length===0?(g(),k(H,{key:1,color:"warning",density:"compact",class:"mt-8 mb-4"},{default:e(()=>[n(s(a(r)("platform.rooms.dialog.data.noScreenTip")),1)]),_:1})):z("",!0),a(p).screens.length!==0?(g(!0),q(J,{key:2},de(a(p).screens,t=>(g(),k(y,null,{default:e(()=>[l(v,{cols:"6"},{default:e(()=>[l(f,{label:""},{default:e(()=>[n(s(t),1)]),_:2},1024)]),_:2},1024),l(v,{cols:"6"},{default:e(()=>[l(A,{density:"compact",loading:a($),onClick:m=>Y(t)},{default:e(()=>[n(s(a(r)("platform.rooms.dialog.data.kill")),1)]),_:1},8,["loading","onClick"])]),_:2},1024)]),_:2},1024))),256)):z("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue","width"]),l(c,{modelValue:a(b),"onUpdate:modelValue":o[6]||(o[6]=t=>U(b)?b.value=t:null),type:"warning",title:a(r)("global.confirm.title"),content:a(r)("global.confirm.content"),"confirm-text":a(r)("global.confirm.confirm"),"cancel-text":a(r)("global.confirm.cancel"),"confirm-loading":a(w),onConfirm:ae,onCancel:o[7]||(o[7]=t=>b.value=!1)},null,8,["modelValue","title","content","confirm-text","cancel-text","confirm-loading"])],64)}}};export{Je as default};
