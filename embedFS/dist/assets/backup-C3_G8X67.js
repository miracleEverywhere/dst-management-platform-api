import{_ as P}from"./Result-C6ff7QL2.js";import{t as b}from"./tools-s9AtCfHT.js";import{g as Q,d as R,b as U,e as J,h as d,f as K,c as F,l as t,o as p,y as h,w as e,a,s as O,p as k,q as n,t as i,P as N,Q as I,G as y,cu as W,a9 as X,E as T,a8 as Y,F as z,B as V}from"./index-Cpi_5jeC.js";import{V as Z}from"./VDataTable-MwzuhUk-.js";import{V as ee}from"./VMenu-CxB9H3rV.js";import{V as te}from"./VList-DRw1DleY.js";import{V as w}from"./VChip-Bh9Ug9id.js";import{V as oe,a as ae}from"./VToolbar-G4SrZZyX.js";import{V as le}from"./VSkeletonLoader-BNzgFud9.js";import"./VContainer-BaYWzqnG.js";/* empty css              */import"./axios-DcC5xP6t.js";import"./VPagination-DAL6okay.js";import"./VSelect-CBV9Nj71.js";import"./VTextField-DYhVUV9X.js";import"./index-C79QJLOU.js";import"./VInput-0HHYP18N.js";import"./VCheckboxBtn-SGlC0nov.js";import"./VSelectionControl-DnzLro3k.js";import"./dialog-transition-Cs1ajW-l.js";import"./VTable-B_THj38S.js";import"./filter-Dgu3Q5Sx.js";import"./ssrBoot-C_2zAg2k.js";const se={key:0},xe={__name:"backup",setup(ie){const u=Q(),M=R(),{t:o}=U(),{mobile:x}=J(),q=d(window.innerHeight),v=d(!1),B=d([]),g=()=>{if(u.room.id===0)return;v.value=!0;const r={roomID:u.room.id};b.backup.get(r).then(l=>{B.value=l.data,B.value.sort((m,s)=>s.timestamp-m.timestamp)}).finally(()=>{v.value=!1})},f=d([]),G=[{key:"gameName",title:o("tools.backup.gameName")},{key:"cycles",title:o("tools.backup.cycles")},{key:"size",title:o("tools.backup.size")},{key:"timestamp",title:o("tools.backup.timestamp")},{key:"actions",title:o("tools.backup.actions")}],c=d(!1),C=d(!1),$=()=>{C.value=!0;const r={roomID:u.room.id};b.backup.post(r).then(l=>{g(),V(l.message)}).finally(()=>{C.value=!1})},_=d(!1),A=r=>{_.value=!0,c.value=!0;const l={roomID:u.room.id,filenames:[r]};b.backup.delete(l).then(m=>{g(),V(o("tools.backup.deleteMessage1")+m.data+o("tools.backup.deleteMessage2"))}).finally(()=>{_.value=!1,c.value=!1})},E=()=>{_.value=!0,c.value=!0;const r={roomID:u.room.id,filenames:f.value.map(l=>l.fileName)};b.backup.delete(r).then(l=>{g(),f.value=[],V(o("tools.backup.deleteMessage1")+l.data+o("tools.backup.deleteMessage2"))}).finally(()=>{_.value=!1,c.value=!1})},L=d(!1),H=r=>{c.value=!0,L.value=!0;const l={roomID:u.room.id,filename:r};b.backup.restore.post(l).then(m=>{V(m.message)}).finally(()=>{L.value=!1,c.value=!1})},j=r=>{c.value=!0;const l={roomID:u.room.id,filename:r};b.backup.download.download(l,"dmp_backup.zip").finally(()=>{c.value=!1})},D=()=>Math.max(2,Math.floor(q.value-150));return K(()=>{g()}),(r,l)=>{const m=P;return t(u).gameVersion.local!==0?(p(),F(z,{key:0},[t(u).room.id!==0?(p(),h(Y,{key:0,border:"",rounded:""},{default:e(()=>[a(Z,{modelValue:t(f),"onUpdate:modelValue":l[0]||(l[0]=s=>O(f)?f.value=s:null),"show-select":"","return-object":"",headers:G,items:t(B),loading:t(v)},{loading:e(()=>[a(le,{type:"table-row@10"})]),top:e(()=>[a(oe,{flat:""},{default:e(()=>[a(ae,null,{default:e(()=>[a(y,{icon:"ri-save-2-line",start:""}),t(x)?T("",!0):(p(),F("span",se,i(t(o)("tools.backup.title")),1))]),_:1}),a(k,{"prepend-icon":"ri-add-line",color:"success",loading:t(C),onClick:$},{default:e(()=>[n(i(t(o)("tools.backup.backup")),1)]),_:1},8,["loading"]),a(k,{"prepend-icon":"ri-delete-bin-5-line",color:"error",disabled:t(f).length===0,loading:t(_),onClick:E},{default:e(()=>[n(i(t(o)("tools.backup.multiDelete")),1)]),_:1},8,["disabled","loading"]),t(x)?T("",!0):(p(),h(k,{key:0,"prepend-icon":"ri-refresh-line",loading:t(v),color:"default",onClick:g},{default:e(()=>[n(i(t(o)("platform.user.table.refresh")),1)]),_:1},8,["loading"]))]),_:1})]),"item.gameName":e(({value:s})=>[a(w,{label:"",color:"primary"},{default:e(()=>[n(i(s),1)]),_:2},1024)]),"item.cycles":e(({value:s})=>[a(w,{label:"",color:"info"},{default:e(()=>[n(i(s),1)]),_:2},1024)]),"item.size":e(({value:s})=>[a(w,{label:"",color:"success"},{default:e(()=>[n(i(t(X)(s)),1)]),_:2},1024)]),"item.timestamp":e(({value:s})=>[a(w,{label:"",color:"default"},{default:e(()=>[n(i(t(W)(s)),1)]),_:2},1024)]),"item.actions":e(({item:s})=>[a(k,{color:"info","append-icon":"ri-arrow-drop-down-line",variant:"text",loading:t(c)},{default:e(()=>[n(i(t(o)("tools.backup.actions"))+" ",1),a(ee,{activator:"parent"},{default:e(()=>[a(te,null,{default:e(()=>[a(N,{class:"text-success",onClick:S=>H(s.fileName)},{prepend:e(()=>[a(y,{icon:"ri-device-recover-line",size:"22"})]),default:e(()=>[a(I,null,{default:e(()=>[n(i(t(o)("tools.backup.restore")),1)]),_:1})]),_:1},8,["onClick"]),a(N,{class:"text-info",onClick:S=>j(s.fileName)},{prepend:e(()=>[a(y,{icon:"ri-download-line",size:"22"})]),default:e(()=>[a(I,null,{default:e(()=>[n(i(t(o)("tools.backup.download")),1)]),_:1})]),_:1},8,["onClick"]),a(N,{class:"text-error",onClick:S=>A(s.fileName)},{prepend:e(()=>[a(y,{icon:"ri-delete-bin-line",size:"22"})]),default:e(()=>[a(I,null,{default:e(()=>[n(i(t(o)("tools.backup.delete")),1)]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["loading"])]),_:1},8,["modelValue","items","loading"])]),_:1})):(p(),h(m,{key:1,title:t(o)("global.result.title"),"sub-title":t(o)("global.result.subTitle"),type:"error",height:D()},{default:e(()=>[a(k,{to:"/rooms",class:"mt-4"},{default:e(()=>[n(i(t(o)("global.result.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"]))],64)):(p(),F(z,{key:1},[t(M).userInfo.role==="admin"?(p(),h(m,{key:0,title:t(o)("global.noGame.title"),"sub-title":t(o)("global.noGame.subTitle"),height:D(),type:"error"},{default:e(()=>[a(k,{to:"/install",class:"mt-4"},{default:e(()=>[n(i(t(o)("global.noGame.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"])):(p(),h(m,{key:1,title:t(o)("global.noGameNoAdmin.title"),"sub-title":t(o)("global.noGameNoAdmin.subTitle"),height:D(),type:"error"},null,8,["title","sub-title","height"]))],64))}}};export{xe as default};
