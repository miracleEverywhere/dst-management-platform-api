import{_ as Z}from"./Result-_4bJ9fXr.js";import{m as _}from"./mod-ZF27zciD.js";import{g as ee,e as ae,b as le,h as n,f as oe,y as f,o as c,w as e,a,k as D,q as i,t as r,l as s,p as S,P as y,Q as k,G as z,c as de,aa as te,F as re,v as se,a7 as ie,E as B,a8 as ne,V as ue,a9 as me,B as b}from"./index-CDcWfGDJ.js";import{r as ce}from"./room-C4fPaH6c.js";import{c as T,V as A,a as P,b as pe}from"./VCard-BouBlXSm.js";import{V as j}from"./VMenu-xIC2NBar.js";import{V as G}from"./VList-D8GqwDvf.js";import{V as fe}from"./VDialog-mcn7TQwE.js";import{V as ge}from"./VAlert-4c5itZOk.js";import{V as g}from"./VChip-Dku4Yyu4.js";import{V as ve}from"./VTextField-DmrWhRLR.js";import{V as _e}from"./VDataTable-ximAcr7-.js";import{V as be}from"./VSkeletonLoader-yzcAQXkT.js";import"./VContainer-BoKUoFFr.js";/* empty css              */import"./axios-BurQrId6.js";import"./dialog-transition-QRikj67Z.js";import"./index-DpLahWRr.js";import"./ssrBoot-DgnhOsXk.js";import"./VInput-G0w3PBPn.js";import"./VPagination-BBkha3un.js";import"./VSelect-BNmCSL0R.js";import"./VCheckboxBtn-6Huv9Ei8.js";import"./VSelectionControl-Bq8e-kuH.js";import"./VTable-zgyLbzUK.js";import"./filter-CN91-Ghg.js";const we={class:"card-header"},Ve={class:"card-header"},he={class:"d-flex align-center justify-center fill-height"},Oe={__name:"add",setup(De){const p=ee(),{mobile:Q}=ae(),{t}=le(),E=n([]),w=n(!1),M=()=>{const o={roomID:p.room.id};w.value=!0,_.downloaded.get(o).then(d=>{E.value=d.data||[]}).finally(()=>{w.value=!1})},x=n(""),W=[{key:"preview_url",title:t("game.mod.add.preview")},{key:"name",title:t("game.mod.add.name")},{key:"serverSize",title:t("game.mod.add.size")},{key:"id",title:"ID"},{key:"update",title:t("game.mod.add.update")},{key:"actions",title:t("game.mod.add.actions")}],v=n([]),F=(o,d)=>{switch(o){case"enable":H(d);break;case"update":J(d);break;default:b("牛哇","error")}},L=n(!1),H=o=>{L.value=!0;const d={roomID:p.room.id,worldID:0,id:o.id,file_url:o.file_url};_.add.enable.post(d).then(m=>{b(m.message)}).finally(()=>{L.value=!1})},U=n(!1),J=o=>{U.value=!0;const d={roomID:p.room.id,id:o.id,file_url:o.file_url,update:!0,name:o.name,size:o.serverSize};_.download.post(d).then(m=>{b(m.message),M()}).finally(()=>{U.value=!1})},V=n(!1),K=async()=>{let o=!0;V.value=!0,console.log(v.value);for(let d of v.value){const m={roomID:p.room.id,worldID:0,id:d.id,file_url:d.file_url};try{await _.add.enable.post(m)}catch{o=!1,b(`${d.name} ${t("game.mod.add.enableMultiFail")}`,"error")}}o&&(v.value=[],b(t("game.mod.add.enableMultiSuccess"))),V.value=!1},h=n(!1),C=n(0),O=async()=>{h.value=!0;for(let o=0;o<u.value.length;o++){const d={roomID:p.room.id,id:u.value[o].id,file_url:u.value[o].file_url,update:!1,name:u.value[o].name,size:u.value[o].size};try{const m=await _.download.post(d);u.value[o].color="success",C.value=(o+1)/u.value.length*100}catch{b(`${u.value[o].name} ${t("game.mod.add.preDownloadFail")}`,"error")}}C.value=100,h.value=!1},$=n(!1),I=n(!1),R=()=>{$.value=!0,I.value=!0,Y().finally(()=>{I.value=!1})},u=n([]),N=n([]),X=async()=>{const o={roomID:p.room.id},d=await ce.worlds.get(o);N.value=d.data},Y=async()=>{u.value=[];const o={roomID:p.room.id,worldID:N.value[0]?.id},m=(await _.setting.enabledMods.get(o)).data||[];for(let l of m){l.color="default";const q={id:l.id,name:l.name,file_url:l.file_url,size:l.serverSize};u.value.push(q)}};return oe(()=>{X(),M()}),(o,d)=>{const m=Z;return c(),f(A,null,{default:e(()=>[a(T,null,{default:e(()=>[D("div",we,[i(r(s(t)("game.mod.add.tabName"))+" ",1),D("div",null,[a(S,{"append-icon":"ri-arrow-drop-down-line",loading:V.value,color:"primary"},{default:e(()=>[i(r(s(t)("game.mod.add.headerMenuButton"))+" ",1),a(j,{activator:"parent"},{default:e(()=>[a(G,null,{default:e(()=>[a(y,{disabled:h.value,class:"text-info",onClick:R},{prepend:e(()=>[a(z,{icon:"ri-download-2-line",size:"22"})]),default:e(()=>[a(k,null,{default:e(()=>[i(r(s(t)("game.mod.add.preDownload")),1)]),_:1})]),_:1},8,["disabled"]),a(y,{disabled:v.value.length===0||V.value,class:"text-success",onClick:K},{prepend:e(()=>[a(z,{icon:"ri-list-check-3",size:"22"})]),default:e(()=>[a(k,null,{default:e(()=>[i(r(s(t)("game.mod.add.enableMulti")),1)]),_:1})]),_:1},8,["disabled"]),a(y,{disabled:V.value,class:"text-warning",onClick:d[0]||(d[0]=l=>F("enable",{id:0,file_url:""}))},{prepend:e(()=>[a(z,{icon:"ri-add-line",size:"22"})]),default:e(()=>[a(k,null,{default:e(()=>[i(r(s(t)("game.mod.add.addClientModsDisabled")),1)]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["loading"]),a(fe,{modelValue:$.value,"onUpdate:modelValue":d[2]||(d[2]=l=>$.value=l),persistent:h.value,width:s(Q)?"90%":"40%"},{default:e(()=>[a(A,{"min-height":"300"},{default:e(()=>[a(T,null,{default:e(()=>[D("div",Ve,[D("span",null,r(s(t)("game.mod.add.preDownloadDialog.title")),1),a(S,{disabled:I.value,loading:h.value,onClick:O},{default:e(()=>[i(r(s(t)("game.mod.add.preDownloadDialog.button")),1)]),_:1},8,["disabled","loading"])])]),_:1}),I.value?(c(),f(pe,{key:1},{default:e(()=>[a(m,{height:230,color:"info",title:s(t)("game.mod.setting.tip.fetching")},null,8,["title"])]),_:1})):(c(),f(P,{key:0},{default:e(()=>[a(ge,{color:"warning",density:"compact",class:"mt-2 mb-4"},{default:e(()=>[i(r(s(t)("game.mod.add.preDownloadDialog.tip")),1)]),_:1}),a(te,{modelValue:C.value,"onUpdate:modelValue":d[1]||(d[1]=l=>C.value=l),color:"info",height:"12",rounded:"","rounded-bar":"",class:"mb-4"},null,8,["modelValue"]),(c(!0),de(re,null,se(u.value,l=>(c(),f(g,{key:l.id,color:l.color,label:"",class:"mr-4 mt-4"},{default:e(()=>[i(r(l.name),1)]),_:2},1032,["color"]))),128))]),_:1}))]),_:1})]),_:1},8,["modelValue","persistent","width"])])])]),_:1}),a(P,{class:"mt-4"},{default:e(()=>[a(ve,{modelValue:x.value,"onUpdate:modelValue":d[3]||(d[3]=l=>x.value=l),loading:w.value,label:s(t)("game.mod.add.search"),variant:"outlined","hide-details":"","single-line":""},{append:e(()=>[a(S,{loading:w.value,"prepend-icon":"ri-refresh-line",color:"default",variant:"elevated",size:"large",onClick:M},{default:e(()=>[i(r(s(t)("game.mod.add.refresh")),1)]),_:1},8,["loading"])]),_:1},8,["modelValue","loading","label"]),a(ie,{border:"",rounded:"",class:"mt-4"},{default:e(()=>[a(_e,{modelValue:v.value,"onUpdate:modelValue":d[4]||(d[4]=l=>v.value=l),"show-select":"","return-object":"",headers:W,items:E.value,search:x.value,loading:w.value},{loading:e(()=>[a(be,{type:"table-row@10"})]),"item.preview_url":e(({value:l})=>[a(ue,{src:l,width:100,cover:"",rounded:"","aspect-ratio":"1",class:"ma-2"},{placeholder:e(()=>[D("div",he,[a(me,{color:"grey-lighten-4",indeterminate:""})])]),_:1},8,["src"])]),"item.name":e(({value:l})=>[a(g,{label:"",color:"info"},{default:e(()=>[i(r(l),1)]),_:2},1024)]),"item.serverSize":e(({value:l})=>[a(g,{label:"",color:"primary"},{default:e(()=>[i(r(s(ne)(parseInt(l))),1)]),_:2},1024)]),"item.id":e(({value:l})=>[a(g,{label:""},{default:e(()=>[i(r(l),1)]),_:2},1024)]),"item.update":e(({item:l})=>[l.file_url!==""?(c(),f(g,{key:0,label:""},{default:e(()=>[i(r(s(t)("game.mod.add.notUGC")),1)]),_:1})):B("",!0),l.file_url===""&&l.serverSize===l.localSize?(c(),f(g,{key:1,label:"",color:"success"},{default:e(()=>[i(r(s(t)("game.mod.add.needNoUpdate")),1)]),_:1})):B("",!0),l.file_url===""&&l.serverSize!==l.localSize?(c(),f(g,{key:2,label:"",color:"error"},{default:e(()=>[i(r(s(t)("game.mod.add.needUpdate")),1)]),_:1})):B("",!0)]),"item.actions":e(({item:l})=>[a(S,{color:"info","append-icon":"ri-arrow-drop-down-line",variant:"text"},{default:e(()=>[i(r(s(t)("game.mod.add.actions"))+" ",1),a(j,{activator:"parent"},{default:e(()=>[a(G,null,{default:e(()=>[a(y,{disabled:L.value,class:"text-success",onClick:q=>F("enable",l)},{prepend:e(()=>[a(z,{icon:"ri-file-check-line",size:"22"})]),default:e(()=>[a(k,null,{default:e(()=>[i(r(s(t)("game.mod.add.enable")),1)]),_:1})]),_:1},8,["disabled","onClick"]),a(y,{disabled:U.value,class:"text-info",onClick:q=>F("update",l)},{prepend:e(()=>[a(z,{icon:"ri-arrow-up-circle-line",size:"22"})]),default:e(()=>[a(k,null,{default:e(()=>[i(r(s(t)("game.mod.add.updateMod")),1)]),_:1})]),_:1},8,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","items","search","loading"])]),_:1})]),_:1})]),_:1})}}};export{Oe as default};
