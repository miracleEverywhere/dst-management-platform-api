import{_ as Q}from"./Result-janRKoKr.js";import{g as j,d as K,b as X,e as Y,h as c,f as Z,c as y,o as m,a as o,l as e,F as T,y as p,w as t,a7 as ee,p as v,q as d,t as s,P as R,Q as q,G as D,W as te,E as oe,m as le,k as B,x as F,s as ne,aw as ae,B as M,bq as se}from"./index-CBjUexYG.js";import{t as I}from"./tools-KwIBF-ia.js";import{V as ie}from"./VDataTable-C4axgTlY.js";import{V as re}from"./VMenu-uy8W7KRE.js";import{V as ue}from"./VList-DnzQkVfF.js";import{V as k}from"./VChip-IzQUOK91.js";import{V as me,a as de}from"./VToolbar-DSbf84te.js";import{V as ce}from"./VSkeletonLoader-CU-3KRn_.js";import{V as U,c as fe,a as pe,b as ve}from"./VCard-Dcae7csx.js";import{V as Ve}from"./VForm-B7DtTdqw.js";import{V as N}from"./VRow-Bj3h_q5V.js";import{V as be,a as $}from"./VRadioGroup-DJr_pqav.js";import{T as A}from"./index-Bc0f1mGm.js";import{V as ge}from"./VNumberInput-BWm29x0J.js";import{V as _e}from"./VTextField-DbONA2f3.js";import{V as he}from"./VSpacer-BHp0DjOQ.js";import{V as ye}from"./VDialog-Cn58afmS.js";import"./VContainer-B2aJUZeU.js";/* empty css              */import"./axios-KbiksPFU.js";import"./VPagination-BwJ1kUOp.js";import"./VSelect-BBiWe61W.js";import"./VInput-k_ad5GzK.js";import"./index-Cyt7-BUT.js";import"./VCheckboxBtn-Bs4X0880.js";import"./VSelectionControl-DM_cupWE.js";import"./dialog-transition-D112y9Z-.js";import"./VTable-DxG2gNbF.js";import"./filter-BwkLsJCB.js";import"./ssrBoot-Cy1jdUTU.js";import"./VSlideGroup-BTJY2N2a.js";import"./VTooltip-H5SM5WTO.js";const ke={key:0},we={style:{width:"50px"}},nt={__name:"announce",setup(xe){const V=j(),z=K(),{t:l}=X(),{mobile:G}=Y(),E=c(window.innerHeight),f=c([]),g=c(!1),_=()=>{if(V.room.id===0)return;g.value=!0;const r={roomID:V.room.id};I.announce.get(r).then(a=>{a.data!==""&&(f.value=JSON.parse(a.data))}).finally(()=>{g.value=!1})},J=[{key:"status",title:l("tools.announce.form.status.title")},{key:"interval",title:l("tools.announce.form.interval.title"),minWidth:120},{key:"content",title:l("tools.announce.form.content.title")},{key:"actions",title:l("tools.announce.actions")}],b=c(!1),w=c(!1),L=(r,a=!1)=>{a?(w.value=!0,i.value={...r}):(w.value=!1,i.value={id:"",status:!0,interval:600,content:""}),ae(()=>{h.value&&h.value.resetValidation()}),b.value=!0},h=c(),i=c({id:"",status:!0,interval:600,content:""}),O=c({content:[r=>r?r.includes('"')||r.includes("'")?l("tools.announce.form.content.rule"):!0:l("tools.announce.form.content.required")]}),x=c(!1),H=async()=>{const{valid:r}=await h.value.validate();if(r){if(i.value.content=i.value.content.replace(/['"]/g,""),w.value){for(let u=0;u<f.value.length;u++)if(f.value[u].id===i.value.id){f.value[u]=i.value;break}}else x.value=!0,i.value.id=se(),f.value.push(i.value);const a={roomID:V.room.id,setting:JSON.stringify(f.value)};I.announce.put(a).then(u=>{M(u.message),b.value=!1,_()}).finally(()=>{x.value=!1})}},S=c(!1),W=r=>{S.value=!0;const a=f.value.filter(n=>n.id!==r),u={roomID:V.room.id,setting:JSON.stringify(a)};I.announce.put(u).then(n=>{M(l("tools.announce.deleteMessage")),_()}).finally(()=>{S.value=!1})},C=()=>Math.max(2,Math.floor(E.value-150));return Z(()=>{_()}),(r,a)=>{const u=Q;return m(),y(T,null,[e(V).gameVersion.local!==0?(m(),y(T,{key:0},[e(V).room.id!==0?(m(),p(U,{key:0},{default:t(()=>[o(ee,{border:"",rounded:""},{default:t(()=>[o(ie,{headers:J,items:e(f),loading:e(g)},{loading:t(()=>[o(ce,{type:"table-row@10"})]),top:t(()=>[o(me,{flat:""},{default:t(()=>[o(de,null,{default:t(()=>[o(D,{icon:"ri-chat-smile-ai-3-line",start:""}),e(G)?oe("",!0):(m(),y("span",ke,s(e(l)("tools.announce.title")),1))]),_:1}),o(v,{"prepend-icon":"ri-add-line",color:"success",onClick:L},{default:t(()=>[d(s(e(l)("tools.announce.add")),1)]),_:1}),o(v,{"prepend-icon":"ri-refresh-line",loading:e(g),color:"default",onClick:_},{default:t(()=>[d(s(e(l)("tools.announce.refresh")),1)]),_:1},8,["loading"])]),_:1})]),"item.status":t(({value:n})=>[n?(m(),p(k,{key:0,label:"",color:"success"},{default:t(()=>[d(s(e(l)("tools.announce.form.status.y")),1)]),_:1})):(m(),p(k,{key:1,label:"",color:"error"},{default:t(()=>[d(s(e(l)("tools.announce.form.status.n")),1)]),_:1}))]),"item.interval":t(({value:n})=>[o(k,{label:""},{default:t(()=>[d(s(n),1)]),_:2},1024)]),"item.content":t(({value:n})=>[d(s(e(te)(n,40)),1)]),"item.actions":t(({item:n})=>[o(v,{color:"info","append-icon":"ri-arrow-drop-down-line",variant:"text",loading:e(S)},{default:t(()=>[d(s(e(l)("tools.announce.actions"))+" ",1),o(re,{activator:"parent"},{default:t(()=>[o(ue,null,{default:t(()=>[o(R,{class:"text-info",onClick:P=>L(n,!0)},{prepend:t(()=>[o(D,{icon:"ri-edit-line",size:"22"})]),default:t(()=>[o(q,null,{default:t(()=>[d(s(e(l)("tools.announce.update")),1)]),_:1})]),_:1},8,["onClick"]),o(R,{class:"text-error",onClick:P=>W(n.id)},{prepend:t(()=>[o(D,{icon:"ri-delete-bin-line",size:"22"})]),default:t(()=>[o(q,null,{default:t(()=>[d(s(e(l)("tools.announce.delete")),1)]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["loading"])]),_:1},8,["items","loading"])]),_:1})]),_:1})):(m(),p(u,{key:1,title:e(l)("global.result.title"),"sub-title":e(l)("global.result.subTitle"),type:"error",height:C()},{default:t(()=>[o(v,{to:"/rooms",class:"mt-4"},{default:t(()=>[d(s(e(l)("global.result.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"]))],64)):(m(),y(T,{key:1},[e(z).userInfo.role==="admin"?(m(),p(u,{key:0,title:e(l)("global.noGame.title"),"sub-title":e(l)("global.noGame.subTitle"),height:C(),type:"error"},{default:t(()=>[o(v,{to:"/install",class:"mt-4"},{default:t(()=>[d(s(e(l)("global.noGame.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"])):(m(),p(u,{key:1,title:e(l)("global.noGameNoAdmin.title"),"sub-title":e(l)("global.noGameNoAdmin.subTitle"),height:C(),type:"error"},null,8,["title","sub-title","height"]))],64)),o(ye,{modelValue:e(b),"onUpdate:modelValue":a[4]||(a[4]=n=>ne(b)?b.value=n:null),width:e(G)?"90%":"60%"},{default:t(()=>[o(U,null,{default:t(()=>[o(Ve,{ref_key:"announceFormRef",ref:h,class:"ma-4",onSubmit:le(H,["prevent"])},{default:t(()=>[o(fe,null,{default:t(()=>[B("span",null,s(e(l)("tools.announce.title")),1)]),_:1}),o(pe,{class:"my-8"},{default:t(()=>[o(N,{class:"mb-8"},{default:t(()=>[o(be,{modelValue:e(i).status,"onUpdate:modelValue":a[0]||(a[0]=n=>e(i).status=n),inline:""},{prepend:t(()=>[F((m(),p(k,null,{default:t(()=>[d(s(e(l)("tools.announce.form.status.title")),1)]),_:1})),[[A,e(l)("tools.announce.form.status.tip")]])]),default:t(()=>[o($,{label:e(l)("tools.announce.form.status.y"),value:!0,class:"mr-4"},null,8,["label"]),o($,{label:e(l)("tools.announce.form.status.n"),value:!1,class:"mr-4"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),o(N,{class:"mb-8"},{default:t(()=>[F((m(),p(ge,{modelValue:e(i).interval,"onUpdate:modelValue":a[1]||(a[1]=n=>e(i).interval=n),label:e(l)("tools.announce.form.interval.title"),min:1,style:{"margin-bottom":"-1.25rem"}},{"append-inner":t(()=>[B("div",we,s(e(l)("tools.announce.form.interval.unit")),1)]),_:1},8,["modelValue","label"])),[[A,e(l)("tools.announce.form.interval.tip")]])]),_:1}),o(N,null,{default:t(()=>[F(o(_e,{modelValue:e(i).content,"onUpdate:modelValue":a[2]||(a[2]=n=>e(i).content=n),label:e(l)("tools.announce.form.content.title"),rules:e(O).content},null,8,["modelValue","label","rules"]),[[A,e(l)("tools.announce.form.content.tip")]])]),_:1})]),_:1}),o(ve,null,{default:t(()=>[o(he),o(v,{color:"default",variant:"elevated",text:e(l)("login.cancel"),class:"mr-4",onClick:a[3]||(a[3]=n=>b.value=!1)},null,8,["text"]),o(v,{text:e(l)("login.submit"),loading:e(x),variant:"elevated",type:"submit"},null,8,["text","loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue","width"])],64)}}};export{nt as default};
