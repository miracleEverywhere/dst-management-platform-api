import{_ as de}from"./ConfirmBox-BvMmWtOQ.js";import{e as fe,b as pe,h as v,f as ce,c as L,o as u,a as l,w as a,l as e,ab as ve,s as $,a7 as be,p as P,q as i,t as n,P as h,Q as J,G as I,y as d,F as N,x as b,z as O,V as X,R as Y,E as Z,m as ge,v as Ve,B as T,aw as ee,S as ye}from"./index-CBjUexYG.js";import{u as F}from"./user-CF2iIPr8.js";import{r as xe}from"./room-CKn3OSGJ.js";import{a as _e,b as ke,c as Ce,d as we}from"./avatar-4-CIA6Px0_.js";import{a as ae,V as le,c as Pe,b as Se}from"./VCard-Dcae7csx.js";import{V as g}from"./VRow-Bj3h_q5V.js";import{V as c}from"./VCol-B45jb4cO.js";import{V as R}from"./VTextField-DbONA2f3.js";import{V as Ue}from"./VDataTableServer-sgTygxXX.js";import{V as We}from"./VMenu-uy8W7KRE.js";import{V as Be}from"./VList-DnzQkVfF.js";import{V as f}from"./VChip-IzQUOK91.js";import{V as De,a as ze}from"./VToolbar-DSbf84te.js";import{V as Le}from"./VForm-B7DtTdqw.js";import{T as V}from"./index-Bc0f1mGm.js";import{V as E,a as w}from"./VRadioGroup-DJr_pqav.js";import{V as Te}from"./VBadge-CCNOQWi6.js";import{V as Fe}from"./VSelect-BBiWe61W.js";import{V as re}from"./VSlider-Dw30NEPo.js";import{V as Re}from"./VSpacer-BHp0DjOQ.js";import{V as qe}from"./VDialog-Cn58afmS.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VAlert-DeNVDusX.js";import"./axios-KbiksPFU.js";/* empty css              */import"./index-Cyt7-BUT.js";import"./VInput-k_ad5GzK.js";import"./VDataTable-C4axgTlY.js";import"./VPagination-BwJ1kUOp.js";import"./VCheckboxBtn-Bs4X0880.js";import"./VSelectionControl-DM_cupWE.js";import"./VTable-DxG2gNbF.js";import"./filter-BwkLsJCB.js";import"./dialog-transition-D112y9Z-.js";import"./ssrBoot-Cy1jdUTU.js";import"./VSlideGroup-BTJY2N2a.js";import"./VTooltip-H5SM5WTO.js";const Ae={key:0},Ca={__name:"user",setup($e){const{mobile:M}=fe(),{t:r}=pe(),j=v([{roomName:"",roomID:0}]),oe=()=>{xe.basic.get().then(m=>{j.value=m.data||[]})},S=v(""),p=v({rows:[],page:1,pageSize:10,total:0}),U=v(!1),x=({page:m,itemsPerPage:t,sortBy:C})=>{const o={q:S.value,page:m,pageSize:t};U.value=!0,F.list.get(o).then(z=>{p.value=z.data}).finally(()=>{U.value=!1})},te=[{title:r("platform.user.form.username.title"),value:"username"},{title:r("platform.user.form.nickname.title"),value:"nickname"},{title:r("platform.user.form.role.title"),value:"role"},{title:r("platform.user.form.avatar.title"),value:"avatar"},{title:r("platform.user.form.disabled.title"),value:"disabled"},{title:r("platform.user.form.rooms.title"),value:"rooms"},{title:r("platform.user.form.roomCreation.title"),value:"roomCreation"},{title:r("platform.user.form.maxWorlds.title"),value:"maxWorlds"},{title:r("platform.user.form.maxPlayers.title"),value:"maxPlayers"},{title:r("platform.user.table.actions"),value:"actions"}],_=v(),s=v({username:"",nickname:"",role:"non-admin",avatar:"1",password:"",disabled:!1,rooms:[],roomCreation:!0,maxWorlds:2,maxPlayers:6}),q={username:[m=>m?!0:r("platform.user.form.username.required")],nickname:[m=>m?!0:r("platform.user.form.nickname.required")],password:[m=>m?!0:r("platform.user.form.password.required")]},y=v(!1),W=v(!1),se=()=>{y.value=!0,W.value=!1,s.value={username:"",nickname:"",role:"non-admin",avatar:"1",password:"",disabled:!1,rooms:[],roomCreation:!1,maxWorlds:2,maxPlayers:6},ee(()=>{_.value&&_.value.resetValidation()})},me={1:we,2:Ce,3:ke,4:_e},G=m=>me[m],B=v(!1),D=v(!1),ne=async()=>{const{valid:m}=await _.value.validate();if(m)if(D.value=!0,W.value){const t={username:s.value.username,nickname:s.value.nickname,role:s.value.role,avatar:s.value.avatar,password:"",disabled:s.value.disabled,rooms:s.value.rooms.join(","),roomCreation:s.value.roomCreation,maxWorlds:s.value.maxWorlds,maxPlayers:s.value.maxPlayers};F.base.put(t).then(C=>{y.value=!1,T(C.message),x({page:p.value.page,itemsPerPage:p.value.pageSize,sortBy:void 0})}).finally(()=>{D.value=!1})}else{const t={username:s.value.username,nickname:s.value.nickname,role:s.value.role,avatar:s.value.avatar,password:ye(s.value.password),disabled:s.value.disabled,rooms:s.value.rooms.join(","),roomCreation:s.value.roomCreation,maxWorlds:s.value.maxWorlds,maxPlayers:s.value.maxPlayers};F.base.post(t).then(C=>{y.value=!1,T(C.message),x({page:p.value.page,itemsPerPage:p.value.pageSize,sortBy:void 0})}).finally(()=>{D.value=!1})}},K=m=>m?m.split(",").map(Number).filter(t=>!isNaN(t)):[],H=(m,t)=>{switch(m){case"update":ie(t);break;case"delete":Q.value=t.username,k.value=!0;break;default:T("牛哇","error")}},ie=m=>{y.value=!0,W.value=!0,s.value={username:m.username,nickname:m.nickname,role:m.role,avatar:m.avatar,disabled:m.disabled,rooms:K(m.rooms),roomCreation:m.roomCreation,maxWorlds:m.maxWorlds,maxPlayers:m.maxPlayers},ee(()=>{_.value&&_.value.resetValidation()})},k=v(!1),A=v(!1),Q=v(""),ue=()=>{A.value=!0;const m={username:Q.value};F.base.delete(m).then(t=>{k.value=!1,T(t.message),x({page:p.value.page,itemsPerPage:p.value.pageSize,sortBy:void 0})}).finally(()=>{A.value=!1})};return ce(()=>{oe()}),(m,t)=>{const C=de;return u(),L(N,null,[l(le,null,{default:a(()=>[l(ae,null,{default:a(()=>[l(g,null,{default:a(()=>[l(c,{cols:"12"},{default:a(()=>[l(R,{modelValue:e(S),"onUpdate:modelValue":t[0]||(t[0]=o=>$(S)?S.value=o:null),label:e(r)("platform.user.search.label"),placeholder:e(r)("platform.user.search.placeholder"),clearable:"",onKeyup:t[1]||(t[1]=ve(o=>x({page:e(p).page,itemsPerPage:e(p).pageSize,sortBy:void 0}),["enter"])),"onClick:clear":t[2]||(t[2]=o=>x({page:e(p).page,itemsPerPage:e(p).pageSize,sortBy:void 0}))},null,8,["modelValue","label","placeholder"])]),_:1}),l(c,{cols:"12"},{default:a(()=>[l(be,{rounded:"",border:""},{default:a(()=>[l(Ue,{"items-per-page":e(p).pageSize,"onUpdate:itemsPerPage":t[4]||(t[4]=o=>e(p).pageSize=o),items:e(p).rows,"items-length":e(p).total,page:e(p).page,loading:e(U),headers:te,"onUpdate:options":x},{top:a(()=>[l(De,{flat:""},{default:a(()=>[l(ze,null,{default:a(()=>[l(I,{icon:"ri-id-card-line",start:""}),e(M)?Z("",!0):(u(),L("span",Ae,n(e(r)("platform.user.table.title")),1))]),_:1}),l(P,{"prepend-icon":"ri-add-line",color:"success",onClick:se},{default:a(()=>[i(n(e(r)("platform.user.table.create")),1)]),_:1}),l(P,{"prepend-icon":"ri-refresh-line",loading:e(U),color:"default",onClick:t[3]||(t[3]=o=>x({page:e(p).page,itemsPerPage:e(p).pageSize,sortBy:void 0}))},{default:a(()=>[i(n(e(r)("platform.user.table.refresh")),1)]),_:1},8,["loading"])]),_:1})]),"item.role":a(({value:o})=>[o==="admin"?(u(),d(f,{key:0,color:"primary",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.admin")),1)]),_:1})):(u(),d(f,{key:1,label:""},{default:a(()=>[i(n(e(r)("platform.user.table.nonAdmin")),1)]),_:1}))]),"item.avatar":a(({value:o})=>[b((u(),d(O,{color:"primary",variant:"tonal"},{default:a(()=>[l(X,{src:G(o)},null,8,["src"])]),_:2},1024)),[[Y]])]),"item.disabled":a(({value:o})=>[o?(u(),d(f,{key:0,color:"error",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.yes")),1)]),_:1})):(u(),d(f,{key:1,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.no")),1)]),_:1}))]),"item.rooms":a(({item:o})=>[o.role==="admin"?(u(),d(f,{key:0,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.noLimit")),1)]),_:1})):(u(),d(f,{key:1,color:"info",label:""},{default:a(()=>[i(n(K(o.rooms).length)+n(e(r)("platform.user.table.unit")),1)]),_:2},1024))]),"item.roomCreation":a(({item:o})=>[o.role==="admin"?(u(),d(f,{key:0,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.yes")),1)]),_:1})):(u(),L(N,{key:1},[o.roomCreation?(u(),d(f,{key:0,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.yes")),1)]),_:1})):(u(),d(f,{key:1,color:"error",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.no")),1)]),_:1}))],64))]),"item.maxWorlds":a(({item:o})=>[o.role==="admin"?(u(),d(f,{key:0,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.noLimit")),1)]),_:1})):(u(),d(f,{key:1,label:""},{default:a(()=>[i(n(o.maxWorlds),1)]),_:2},1024))]),"item.maxPlayers":a(({item:o})=>[o.role==="admin"?(u(),d(f,{key:0,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.noLimit")),1)]),_:1})):(u(),d(f,{key:1,label:""},{default:a(()=>[i(n(o.maxPlayers),1)]),_:2},1024))]),"item.actions":a(({item:o})=>[l(P,{color:"info","append-icon":"ri-arrow-drop-down-line",variant:"text"},{default:a(()=>[i(n(e(r)("platform.user.table.actions"))+" ",1),l(We,{activator:"parent"},{default:a(()=>[l(Be,null,{default:a(()=>[l(h,{class:"text-warning",onClick:z=>H("update",o)},{prepend:a(()=>[l(I,{icon:"ri-user-settings-line",size:"22"})]),default:a(()=>[l(J,null,{default:a(()=>[i(n(e(r)("platform.user.table.update")),1)]),_:1})]),_:1},8,["onClick"]),l(h,{disabled:o.role==="admin",class:"text-error",onClick:z=>H("delete",o)},{prepend:a(()=>[l(I,{icon:"ri-user-unfollow-line",size:"22"})]),default:a(()=>[l(J,null,{default:a(()=>[i(n(e(r)("platform.user.table.delete")),1)]),_:1})]),_:1},8,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["items-per-page","items","items-length","page","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(qe,{modelValue:e(y),"onUpdate:modelValue":t[16]||(t[16]=o=>$(y)?y.value=o:null),width:e(M)?"85%":"60%"},{default:a(()=>[l(le,null,{default:a(()=>[l(Pe,null,{default:a(()=>[...t[19]||(t[19]=[i(" 新建用户 ",-1)])]),_:1}),l(Le,{ref_key:"userFormRef",ref:_,class:"mx-6",onSubmit:ge(ne,["prevent"])},{default:a(()=>[l(ae,{class:"my-2"},{default:a(()=>[l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[b(l(R,{modelValue:e(s).username,"onUpdate:modelValue":t[5]||(t[5]=o=>e(s).username=o),rules:q.username,label:e(r)("platform.user.form.username.title")},null,8,["modelValue","rules","label"]),[[V,e(r)("platform.user.form.username.tip")]])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[b(l(R,{modelValue:e(s).nickname,"onUpdate:modelValue":t[6]||(t[6]=o=>e(s).nickname=o),rules:q.nickname,label:e(r)("platform.user.form.nickname.title")},null,8,["modelValue","rules","label"]),[[V,e(r)("platform.user.form.nickname.tip")]])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,{cols:"12",md:"6"},{default:a(()=>[l(E,{modelValue:e(s).role,"onUpdate:modelValue":t[7]||(t[7]=o=>e(s).role=o),inline:""},{prepend:a(()=>[b((u(),d(f,null,{default:a(()=>[i(n(e(r)("platform.user.form.role.title")),1)]),_:1})),[[V,e(r)("platform.user.form.role.tip")]])]),default:a(()=>[l(w,{label:e(r)("platform.user.form.role.admin"),value:"admin",class:"mr-4"},null,8,["label"]),l(w,{label:e(r)("platform.user.form.role.nonAdmin"),value:"non-admin",class:"mr-4"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),l(c,{cols:"12",md:"6"},{default:a(()=>[l(E,{modelValue:e(s).disabled,"onUpdate:modelValue":t[8]||(t[8]=o=>e(s).disabled=o),inline:""},{prepend:a(()=>[b((u(),d(f,null,{default:a(()=>[i(n(e(r)("platform.user.form.disabled.title")),1)]),_:1})),[[V,e(r)("platform.user.form.disabled.tip")]])]),default:a(()=>[l(w,{label:e(r)("platform.user.form.disabled.yes"),value:!0,class:"mr-4"},null,8,["label"]),l(w,{label:e(r)("platform.user.form.disabled.no"),value:!1,class:"mr-4"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,{cols:"2",class:"d-flex align-center"},{default:a(()=>[l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[b((u(),d(f,null,{default:a(()=>[i(n(e(r)("platform.user.form.avatar.title")),1)]),_:1})),[[V,e(r)("platform.user.form.avatar.tip")]])]),_:1})]),_:1})]),_:1}),l(c,{cols:"10"},{default:a(()=>[l(g,null,{default:a(()=>[(u(),L(N,null,Ve(4,o=>l(c,{key:o},{default:a(()=>[l(Te,{dot:"",location:"bottom right","offset-x":"3","offset-y":"3",color:"success","model-value":e(s).avatar===o.toString()},{default:a(()=>[b((u(),d(O,{color:"primary",variant:"tonal",onClick:z=>e(s).avatar=o.toString()},{default:a(()=>[l(X,{src:G(o)},null,8,["src"])]),_:2},1032,["onClick"])),[[Y]])]),_:2},1032,["model-value"])]),_:2},1024)),64))]),_:1})]),_:1})]),_:1}),e(W)?Z("",!0):(u(),d(g,{key:0},{default:a(()=>[l(c,null,{default:a(()=>[b(l(R,{modelValue:e(s).password,"onUpdate:modelValue":t[9]||(t[9]=o=>e(s).password=o),"append-inner-icon":e(B)?"ri-eye-off-line":"ri-eye-line",type:e(B)?"text":"password",autocomplete:"password",label:e(r)("platform.user.form.password.title"),rules:q.password,clearable:"","onClick:appendInner":t[10]||(t[10]=o=>B.value=!e(B))},null,8,["modelValue","append-inner-icon","type","label","rules"]),[[V,e(r)("platform.user.form.password.tip")]])]),_:1})]),_:1})),l(g,null,{default:a(()=>[l(c,{cols:"12"},{default:a(()=>[l(E,{modelValue:e(s).roomCreation,"onUpdate:modelValue":t[11]||(t[11]=o=>e(s).roomCreation=o),disabled:e(s).role==="admin",inline:""},{prepend:a(()=>[b((u(),d(f,null,{default:a(()=>[i(n(e(r)("platform.user.form.roomCreation.title")),1)]),_:1})),[[V,e(r)("platform.user.form.roomCreation.tip")]])]),default:a(()=>[l(w,{label:e(r)("platform.user.form.roomCreation.yes"),value:!0,class:"mr-4"},null,8,["label"]),l(w,{label:e(r)("platform.user.form.roomCreation.no"),value:!1,class:"mr-4"},null,8,["label"])]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,{cols:"12"},{default:a(()=>[b(l(Fe,{modelValue:e(s).rooms,"onUpdate:modelValue":t[12]||(t[12]=o=>e(s).rooms=o),disabled:e(s).role==="admin",items:e(j),"item-title":"roomName","item-value":"roomID",label:e(r)("platform.user.form.rooms.title"),multiple:"",chips:""},null,8,["modelValue","disabled","items","label"]),[[V,e(r)("platform.user.form.rooms.tip")]])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[l(re,{modelValue:e(s).maxPlayers,"onUpdate:modelValue":t[13]||(t[13]=o=>e(s).maxPlayers=o),disabled:e(s).role==="admin",max:64,min:1,class:"align-center","hide-details":"",step:"1",style:{"margin-left":"-1px"}},{label:a(()=>[b((u(),d(f,{style:{"margin-right":"1rem"}},{default:a(()=>[i(n(e(r)("platform.user.form.maxPlayers.title")),1)]),_:1})),[[V,e(r)("platform.user.form.maxPlayers.tip")]])]),append:a(()=>[l(f,{label:"",color:"primary"},{default:a(()=>[i(n(e(s).maxPlayers),1)]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[l(re,{modelValue:e(s).maxWorlds,"onUpdate:modelValue":t[14]||(t[14]=o=>e(s).maxWorlds=o),disabled:e(s).role==="admin",max:64,min:1,class:"align-center","hide-details":"",step:"1",style:{"margin-left":"-1px"}},{label:a(()=>[b((u(),d(f,{style:{"margin-right":"1rem"}},{default:a(()=>[i(n(e(r)("platform.user.form.maxWorlds.title")),1)]),_:1})),[[V,e(r)("platform.user.form.maxWorlds.tip")]])]),append:a(()=>[l(f,{label:"",color:"primary"},{default:a(()=>[i(n(e(s).maxWorlds),1)]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),l(Se,{class:"my-6"},{default:a(()=>[l(Re),l(P,{color:"default",variant:"elevated",text:e(r)("login.cancel"),class:"mr-4",onClick:t[15]||(t[15]=o=>y.value=!1)},null,8,["text"]),l(P,{text:e(r)("login.submit"),loading:e(D),variant:"elevated",type:"submit"},null,8,["text","loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue","width"]),l(C,{modelValue:e(k),"onUpdate:modelValue":t[17]||(t[17]=o=>$(k)?k.value=o:null),type:"warning",title:e(r)("global.confirm.title"),content:e(r)("global.confirm.content"),"confirm-text":e(r)("global.confirm.confirm"),"cancel-text":e(r)("global.confirm.cancel"),"confirm-loading":e(A),onConfirm:ue,onCancel:t[18]||(t[18]=o=>k.value=!1)},null,8,["modelValue","title","content","confirm-text","cancel-text","confirm-loading"])],64)}}};export{Ca as default};
