import{_ as Z}from"./Result-0C3w8lY6.js";import $ from"./log-DJ9lOFIb.js";import{l as L}from"./logs-oy7M1X2N.js";import{r as ee}from"./room-Db-EkeKz.js";import{g as te,d as le,e as oe,b as ae,h as n,f as se,a4 as ie,N as ne,c as C,l as e,o as i,y as m,F as I,a as l,w as a,q as b,t as g,s as p,k as w,p as S,E as U}from"./index-CdazYsXs.js";import{c as A,d as re,e as P,f as ue}from"./VTabs-D6rsxDsv.js";import{V as W,c as z,a as j}from"./VCard-CGfU41V6.js";import{V as q}from"./VSelect-D-CpaDxw.js";import{V as de}from"./VSwitch-95IXMkL3.js";import{V as me}from"./VChip-D5T73rYJ.js";import{V as ce}from"./VRow-BSBKnbX1.js";import{V as ge}from"./VSpacer-BlbldoqA.js";import{V as he}from"./VCol-nofoYWO0.js";import{V as fe}from"./VNumberInput-DfeDwIoy.js";import"./VContainer-i_8MNGz0.js";/* empty css              */import"./preview-Bnslggab.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./axios-B6WrsswM.js";import"./ssrBoot-BdSAGq_c.js";import"./VTextField-D0Ki9G5g.js";import"./index-F_tKZn5V.js";import"./VInput-xf8cSZvT.js";import"./VList-DRcsg_FG.js";import"./VMenu-BFDj5E0P.js";import"./dialog-transition-BV35mueV.js";import"./VCheckboxBtn-BjZNuGS_.js";import"./VSelectionControl-DN4LuCu6.js";const pe={class:"card-header"},ve={class:"fcc"},ye={class:"card-header"},Ve={class:"fcc"},Oe={__name:"game",setup(be){const h=te(),J=le();oe();const{t:o}=ae(),v=n("current"),y=n(""),d=n(0),T=n(!0),V=n(0),K=u=>{u==="current"&&(N.value=!0),u==="history"&&(N.value=!1)},B=n(!1),N=n(!0),H=()=>{if(d.value===0||!N.value)return;const u={roomID:h.room.id,worldID:d.value,logType:"game",lines:V.value};L.content.get(u).then(t=>{t.data===null?y.value="":y.value=t.data.join(`
`),B.value=!0})},F=n([]),O=async()=>{const u={roomID:h.room.id},t=await ee.worlds.get(u);F.value=t.data,d.value=F.value[0]?.id||0},M=n([]),Q=()=>{const u={roomID:h.room.id,worldID:d.value,logType:"game"};L.history.list.get(u).then(t=>{M.value=t.data})},_=n(""),k=n(""),f=n(!1),X=()=>{f.value=!0;const u={roomID:h.room.id,worldID:d.value,logType:"game",logFile:_.value};L.history.content.get(u).then(t=>{k.value="",k.value=t.data}).finally(()=>{f.value=!1})};let x=null;const Y=()=>{x=setInterval(()=>{T.value&&H()},2e3)},E=()=>{x&&(clearInterval(x),x=null)},G=()=>Math.round(Math.max(2,Math.floor(D.value-427))/22.5),r=()=>Math.max(2,Math.floor(D.value-160-37)),D=n(window.innerHeight),R=ie(()=>{D.value=window.innerHeight,V.value=G()},200);return se(async()=>{h.room.id!==0&&(window.addEventListener("resize",R),await O(),Q(),V.value=G(),Y())}),ne(()=>{E(),window.removeEventListener("beforeunload",E),window.removeEventListener("resize",R)}),(u,t)=>{const c=Z;return e(h).gameVersion.local!==0?(i(),C(I,{key:0},[e(h).room.id!==0?(i(),C(I,{key:0},[l(re,{modelValue:e(v),"onUpdate:modelValue":[t[0]||(t[0]=s=>p(v)?v.value=s:null),K],"align-tabs":"start",color:"primary","show-arrows":""},{default:a(()=>[l(A,{value:"current"},{default:a(()=>[b(g(e(o)("logs.current")),1)]),_:1}),l(A,{value:"history"},{default:a(()=>[b(g(e(o)("logs.history")),1)]),_:1})]),_:1},8,["modelValue"]),l(ue,{modelValue:e(v),"onUpdate:modelValue":t[8]||(t[8]=s=>p(v)?v.value=s:null),class:"mt-4"},{default:a(()=>[l(P,{value:"current"},{default:a(()=>[l(W,{height:r()},{default:a(()=>[l(z,{class:"my-2"},{default:a(()=>[w("div",pe,[w("span",null,g(e(o)("logs.current")),1),w("div",ve,[l(q,{modelValue:e(d),"onUpdate:modelValue":[t[1]||(t[1]=s=>p(d)?d.value=s:null),t[2]||(t[2]=s=>y.value="")],items:e(F),"item-title":"worldName","item-value":"id",label:e(o)("logs.world"),density:"compact",class:"mr-4"},null,8,["modelValue","items","label"]),l(de,{modelValue:e(T),"onUpdate:modelValue":t[3]||(t[3]=s=>p(T)?T.value=s:null),color:"info","hide-details":""},{prepend:a(()=>[l(me,{color:"info"},{default:a(()=>[b(g(e(o)("logs.autoPull")),1)]),_:1})]),_:1},8,["modelValue"])])])]),_:1}),l(j,null,{default:a(()=>[e(B)?(i(),C(I,{key:0},[e(y)?(i(),m($,{key:0,content:e(y),height:r()-150},null,8,["content","height"])):(i(),m(c,{key:1,type:"info",height:r()-150,title:e(o)("logs.noContent")},null,8,["height","title"]))],64)):(i(),m(c,{key:1,type:"info",title:e(o)("logs.fetching"),height:r()-150},null,8,["title","height"])),l(ce,{class:"my-4"},{default:a(()=>[l(ge),l(he,{class:"d-flex align-center justify-end"},{default:a(()=>[l(fe,{modelValue:e(V),"onUpdate:modelValue":t[4]||(t[4]=s=>p(V)?V.value=s:null),label:e(o)("logs.line"),"hide-details":"",density:"compact",class:"mr-4","max-width":"120"},null,8,["modelValue","label"]),l(S,{onClick:H},{default:a(()=>[b(g(e(o)("logs.pull")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["height"])]),_:1}),l(P,{value:"history"},{default:a(()=>[l(W,{height:r()},{default:a(()=>[l(z,{class:"my-2"},{default:a(()=>[w("div",ye,[w("span",null,g(e(o)("logs.history")),1),w("div",Ve,[l(q,{modelValue:e(d),"onUpdate:modelValue":[t[5]||(t[5]=s=>p(d)?d.value=s:null),t[6]||(t[6]=s=>y.value="")],items:e(F),"item-title":"worldName","item-value":"id",label:e(o)("logs.world"),density:"compact",class:"mr-4","min-width":"100px"},null,8,["modelValue","items","label"]),l(q,{modelValue:e(_),"onUpdate:modelValue":[t[7]||(t[7]=s=>p(_)?_.value=s:null),X],items:e(M),disabled:e(f),loading:e(f),label:e(o)("logs.logFile"),density:"compact","min-width":"100px"},null,8,["modelValue","items","disabled","loading","label"])])])]),_:1}),l(j,null,{default:a(()=>[e(_)?(i(),C(I,{key:0},[!e(f)&&e(k)?(i(),m($,{key:0,content:e(k),height:r()-150},null,8,["content","height"])):U("",!0),e(f)?(i(),m(c,{key:1,type:"info",title:e(o)("logs.fetching"),height:r()-150},null,8,["title","height"])):U("",!0),!e(f)&&!e(k)?(i(),m(c,{key:2,type:"info",height:r()-150,title:e(o)("logs.noContent")},null,8,["height","title"])):U("",!0)],64)):(i(),m(c,{key:1,type:"info",height:r()-150,title:e(o)("logs.noLogFile")},null,8,["height","title"]))]),_:1})]),_:1},8,["height"])]),_:1})]),_:1},8,["modelValue"])],64)):(i(),m(c,{key:1,title:e(o)("global.result.title"),"sub-title":e(o)("global.result.subTitle"),type:"error",height:r()},{default:a(()=>[l(S,{to:"/rooms",class:"mt-4"},{default:a(()=>[b(g(e(o)("global.result.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"]))],64)):(i(),C(I,{key:1},[e(J).userInfo.role==="admin"?(i(),m(c,{key:0,title:e(o)("global.noGame.title"),"sub-title":e(o)("global.noGame.subTitle"),height:r(),type:"error"},{default:a(()=>[l(S,{to:"/install",class:"mt-4"},{default:a(()=>[b(g(e(o)("global.noGame.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"])):(i(),m(c,{key:1,title:e(o)("global.noGameNoAdmin.title"),"sub-title":e(o)("global.noGameNoAdmin.subTitle"),height:r(),type:"error"},null,8,["title","sub-title","height"]))],64))}}};export{Oe as default};
