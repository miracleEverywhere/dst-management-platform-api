import{_ as Se}from"./Result-Cn2_UdEw.js";import{ac as M,ad as B,Z as ye,ae as U,k as O,a as l,p as z,af as ae,ag as ke,R as le,ah as we,j as k,x as Ve,ai as Ie,G as A,z as _e,H as De,aj as xe,ak as R,al as ce,am as Ce,A as Y,an as Pe,ao as Te,e as pe,ap as Re,aq as oe,ar as Be,a7 as ne,U as H,F as X,as as Ee,at as Ae,au as Ne,av as We,h as g,d as Oe,g as ze,u as $e,b as Ge,f as Le,a3 as Fe,a4 as He,c as re,l as t,o as v,y as b,w as u,s as ie,E as se,q as j,t as J,B as ue,aw as Me}from"./index-y7gjWuPm.js";import Ue from"./room-DAyTbaxa.js";import je from"./world-BFUx5mhB.js";import Je from"./mod-BUjAsuw-.js";import qe from"./roomSetting-C3skYwql.js";import{r as q}from"./room-6pGSGymX.js";import{V as de,m as Ze,a as me,b as Ke}from"./VTabs-CfS5KWP8.js";import{V as Z}from"./VContainer-BnSh_MTZ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VRow-DSxK_lZ_.js";/* empty css              */import"./VCol-umKj9uol.js";import"./VTextField-uMFdyion.js";import"./index-MCHUliHX.js";import"./VInput-MzIIapS-.js";import"./index-DsZHk2_O.js";import"./VTooltip-C69kia46.js";import"./VRadioGroup-BCN_Kltz.js";import"./VSelectionControl-BnRoO89R.js";import"./VChip-wyhN0sI-.js";import"./VSlideGroup-C6UwHDjq.js";import"./VSlider-DVIREgNk.js";import"./VNumberInput-CGuiiiie.js";import"./VForm-JEVD2o8Q.js";import"./VCard-3t1lA3T-.js";import"./VSpacer-Mg5KYyj9.js";import"./VDialog-Dt6YkoTe.js";import"./dialog-transition-BlTEFOz9.js";import"./CodeEditor-Df66YU6C.js";import"./levelDataSetting-CNSgOqjg.js";import"./VMenu-DsEiLSfo.js";import"./VList-Dq7nw64W.js";import"./ssrBoot-DoU4Hx8y.js";import"./VAlert-CvkfT0jV.js";import"./VTimePicker-DvCD9Cto.js";import"./axios-BmRfRVbX.js";const ee=Symbol.for("vuetify:v-stepper"),ve=B({color:String,disabled:{type:[Boolean,String],default:!1},prevText:{type:String,default:"$vuetify.stepper.prev"},nextText:{type:String,default:"$vuetify.stepper.next"}},"VStepperActions"),fe=M()({name:"VStepperActions",props:ve(),emits:{"click:prev":()=>!0,"click:next":()=>!0},setup(e,h){let{emit:r,slots:i}=h;const{t:o}=ye();function c(){r("click:prev")}function f(){r("click:next")}return U(()=>{const S={onClick:c},w={onClick:f};return O("div",{class:"v-stepper-actions"},[l(ae,{defaults:{VBtn:{disabled:["prev",!0].includes(e.disabled),text:o(e.prevText),variant:"text"}}},{default:()=>[i.prev?.({props:S})??l(z,S,null)]}),l(ae,{defaults:{VBtn:{color:e.color,disabled:["next",!0].includes(e.disabled),text:o(e.nextText),variant:"tonal"}}},{default:()=>[i.next?.({props:w})??l(z,w,null)]})])}),{}}}),ge=ke("v-stepper-header"),Qe=B({color:String,title:String,subtitle:String,complete:Boolean,completeIcon:{type:R,default:"$complete"},editable:Boolean,editIcon:{type:R,default:"$edit"},error:Boolean,errorIcon:{type:R,default:"$error"},icon:R,ripple:{type:[Boolean,Object],default:!0},rules:{type:Array,default:()=>[]}},"StepperItem"),Xe=B({...Qe(),...xe()},"VStepperItem"),N=M()({name:"VStepperItem",directives:{vRipple:le},props:Xe(),emits:{"group:selected":e=>!0},setup(e,h){let{slots:r}=h;const i=we(e,ee,!0),o=k(()=>i?.value.value??e.value),c=k(()=>e.rules.every(C=>C()===!0)),f=k(()=>!e.disabled&&e.editable),S=k(()=>!e.disabled&&e.editable),w=k(()=>e.error||!c.value),V=k(()=>e.complete||e.rules.length>0&&c.value),n=k(()=>w.value?e.errorIcon:V.value?e.completeIcon:i.isSelected.value&&e.editable?e.editIcon:e.icon),m=k(()=>({canEdit:S.value,hasError:w.value,hasCompleted:V.value,title:e.title,subtitle:e.subtitle,step:o.value,value:e.value}));return U(()=>{const C=(!i||i.isSelected.value||V.value||S.value)&&!w.value&&!e.disabled,$=!!(e.title!=null||r.title),I=!!(e.subtitle!=null||r.subtitle);function y(){i?.toggle()}return Ve(O("button",{class:De(["v-stepper-item",{"v-stepper-item--complete":V.value,"v-stepper-item--disabled":e.disabled,"v-stepper-item--error":w.value},i?.selectedClass.value]),disabled:!e.editable,type:"button",onClick:y},[f.value&&Ie(!0,"v-stepper-item"),l(_e,{key:"stepper-avatar",class:"v-stepper-item__avatar",color:C?e.color:void 0,size:24},{default:()=>[r.icon?.(m.value)??(n.value?l(A,{icon:n.value},null):o.value)]}),O("div",{class:"v-stepper-item__content"},[$&&O("div",{key:"title",class:"v-stepper-item__title"},[r.title?.(m.value)??e.title]),I&&O("div",{key:"subtitle",class:"v-stepper-item__subtitle"},[r.subtitle?.(m.value)??e.subtitle]),r.default?.(m.value)])]),[[le,e.editable&&e.ripple,null]])}),{}}}),Ye=B({...Pe(Ze(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VStepperWindow"),be=M()({name:"VStepperWindow",props:Ye(),emits:{"update:modelValue":e=>!0},setup(e,h){let{slots:r}=h;const i=ce(ee,null),o=Ce(e,"modelValue"),c=k({get(){return o.value!=null||!i?o.value:i.items.value.find(f=>i.selected.value.includes(f.id))?.value},set(f){o.value=f}});return U(()=>{const f=de.filterProps(e);return l(de,Y({_as:"VStepperWindow"},f,{modelValue:c.value,"onUpdate:modelValue":S=>c.value=S,class:["v-stepper-window",e.class],style:e.style,mandatory:!1,touch:!1}),r)}),{}}}),et=B({...Ke()},"VStepperWindowItem"),W=M()({name:"VStepperWindowItem",props:et(),setup(e,h){let{slots:r}=h;return U(()=>{const i=me.filterProps(e);return l(me,Y({_as:"VStepperWindowItem"},i,{class:["v-stepper-window-item",e.class],style:e.style}),r)}),{}}}),tt=B({altLabels:Boolean,bgColor:String,completeIcon:R,editIcon:R,editable:Boolean,errorIcon:R,hideActions:Boolean,items:{type:Array,default:()=>[]},itemTitle:{type:String,default:"title"},itemValue:{type:String,default:"value"},nonLinear:Boolean,flat:Boolean,...We()},"Stepper"),at=B({...tt(),...Ne({mandatory:"force",selectedClass:"v-stepper-item--selected"}),...Ae(),...Ee(ve(),["prevText","nextText"])},"VStepper"),lt=M()({name:"VStepper",props:at(),emits:{"update:modelValue":e=>!0},setup(e,h){let{slots:r}=h;const{items:i,next:o,prev:c,selected:f}=Te(e,ee),{displayClasses:S,mobile:w}=pe(e),{completeIcon:V,editIcon:n,errorIcon:m,color:C,editable:$,prevText:I,nextText:y}=Re(e),E=k(()=>e.items.map((p,P)=>{const d=oe(p,e.itemTitle,p),L=oe(p,e.itemValue,P+1);return{title:d,value:L,raw:p}})),_=k(()=>i.value.findIndex(p=>f.value.includes(p.id))),G=k(()=>e.disabled?e.disabled:_.value===0?"prev":_.value===i.value.length-1?"next":!1);return Be({VStepperItem:{editable:$,errorIcon:m,completeIcon:V,editIcon:n,prevText:I,nextText:y},VStepperActions:{color:C,disabled:G,prevText:I,nextText:y}}),U(()=>{const p=ne.filterProps(e),P=!!(r.header||e.items.length),d=e.items.length>0,L=!e.hideActions&&!!(d||r.actions);return l(ne,Y(p,{color:e.bgColor,class:["v-stepper",{"v-stepper--alt-labels":e.altLabels,"v-stepper--flat":e.flat,"v-stepper--non-linear":e.nonLinear,"v-stepper--mobile":w.value},S.value,e.class],style:e.style}),{default:()=>[P&&l(ge,{key:"stepper-header"},{default:()=>[E.value.map((D,T)=>{let{raw:K,...F}=D;return O(X,null,[!!T&&l(H,null,null),l(N,F,{default:r[`header-item.${F.value}`]??r.header,icon:r.icon,title:r.title,subtitle:r.subtitle})])})]}),d&&l(be,{key:"stepper-window"},{default:()=>[E.value.map(D=>l(W,{value:D.value},{default:()=>r[`item.${D.value}`]?.(D)??r.item?.(D)}))]}),r.default?.({prev:c,next:o}),L&&(r.actions?.({next:o,prev:c})??l(fe,{key:"stepper-actions","onClick:prev":c,"onClick:next":o},r))]})}),{prev:c,next:o}}}),Lt={__name:"base",setup(e){const h=g(window.innerHeight),r=Oe(),i=ze();pe(),$e();const{t:o}=Ge(),c=g(!1),f=g(0),S=g(0),w=async()=>{if(i.room.id!==0){const a=await q.base.get({id:i.room.id});y.value=a.data.roomData,_.value=a.data.worldData,D(a.data.roomSettingData)}},V=async()=>{const a=await q.factor.get();f.value=a.data.roomCount,S.value=a.data.worldCount},n=g(0),m=()=>Math.max(2,Math.floor(h.value-304)),C=()=>{n.value--},$=async()=>{if(n.value===0&&I.value){const a=await I.value.validate();if(a.validate){y.value=a.formData,n.value++;return}}if(n.value===1&&E.value){const a=await E.value.validate();if(a.validate){_.value=a.formData,n.value++;return}}if(n.value===2&&G.value){const a=await G.value.validate();if(a.validate){p.value=a.formData,n.value++;return}}if(n.value===3&&P.value){const a=await P.value.validate();if(a.validate){d.value=a.formData,n.value++;return}}},I=g(),y=g({}),E=g(),_=g([]),G=g(),p=g(),P=g(),d=g({}),L=()=>({roomID:0,backupEnable:d.value.backup.enable,backupSetting:JSON.stringify(d.value.backup.setting),backupCleanEnable:d.value.backupClean.enable,backupCleanSetting:d.value.backupClean.setting,restartEnable:d.value.restart.enable,restartSetting:d.value.restart.setting,keepaliveEnable:d.value.keepalive.enable,keepaliveSetting:d.value.keepalive.setting,scheduledStartStopEnable:d.value.scheduledStartStop.enable,scheduledStartStopSetting:JSON.stringify(d.value.scheduledStartStop.setting),tickRate:d.value.tickRate,startType:d.value.startType,announceSetting:d.value.announceSetting}),D=a=>{d.value={backup:{enable:a.backupEnable,setting:JSON.parse(a.backupSetting)},backupClean:{enable:a.backupCleanEnable,setting:a.backupCleanSetting},restart:{enable:a.restartEnable,setting:a.restartSetting},keepalive:{enable:a.keepaliveEnable,setting:a.keepaliveSetting},scheduledStartStop:{enable:a.scheduledStartStopEnable,setting:JSON.parse(a.scheduledStartStopSetting)},tickRate:a.tickRate,startType:a.startType,announceSetting:a.announceSetting}},T=g(!1),K=ce("refresh"),F=()=>{setTimeout(()=>{K(!1),Me(()=>{K(!0)})},0)},he=()=>{const a={roomData:y.value,worldData:_.value,roomSettingData:L()};if(i.room.id){for(let s=0;s<a.worldData.length;s++)p.value.modInOne?(a.roomData.modInOne=!0,a.roomData.modData=p.value.modData):(a.roomData.modInOne=!1,a.worldData[s].modData=p.value.worlds[s].modData),a.worldData[s].roomID=i.room.id,delete a.worldData[s].name,delete a.worldData[s].id;a.roomSettingData.roomID=i.room.id,T.value=!0,q.base.put(a).then(s=>{ue(s.message),i.room={id:s.data.id,gameName:s.data.gameName},F()}).finally(()=>{T.value=!1})}else{for(let s=0;s<a.worldData.length;s++)p.value.modInOne?(a.roomData.modInOne=!0,a.roomData.modData=p.value.modData):(a.roomData.modInOne=!1,a.worldData[s].modData=p.value.worlds[s].modData),a.worldData[s].id=0,delete a.worldData[s].name;T.value=!0,q.base.post(a).then(s=>{ue(s.message),i.room={id:s.data.id,gameName:s.data.gameName},F()}).finally(()=>{T.value=!1})}},te=Fe(()=>{h.value=window.innerHeight},200);return Le(async()=>{await Promise.all([V(),w()]),c.value=!0,window.addEventListener("resize",te)}),He(()=>{window.removeEventListener("resize",te)}),(a,s)=>{const x=Se;return t(i).gameVersion.local!==0?(v(),re(X,{key:0},[t(i).room.name===""?(v(),b(x,{key:0,type:"error",title:t(o)("global.result.title"),"sub-title":t(o)("global.result.subTitle"),height:t(h)},null,8,["title","sub-title","height"])):(v(),b(lt,{key:1,modelValue:t(n),"onUpdate:modelValue":s[1]||(s[1]=Q=>ie(n)?n.value=Q:null)},{default:u(()=>[l(ge,null,{default:u(()=>[l(N,{color:t(n)>0?"success":"",complete:t(n)>0,value:0,title:t(o)("game.header.step1")},{icon:u(()=>[l(A,{icon:"ri-number-1",size:"12"})]),_:1},8,["color","complete","title"]),l(H),l(N,{color:t(n)>1?"success":"",complete:t(n)>1,value:1,title:t(o)("game.header.step2")},{icon:u(()=>[l(A,{icon:"ri-number-2",size:"12"})]),_:1},8,["color","complete","title"]),l(H),l(N,{color:t(n)>2?"success":"",complete:t(n)>2,value:2,title:t(o)("game.header.step3")},{icon:u(()=>[l(A,{icon:"ri-number-3",size:"12"})]),_:1},8,["color","complete","title"]),l(H),l(N,{color:t(n)>3?"success":"",complete:t(n)>3,value:3,title:t(o)("game.header.step4")},{icon:u(()=>[l(A,{icon:"ri-number-4",size:"12"})]),_:1},8,["color","complete","title"]),l(H),l(N,{color:t(n)>4?"success":"",complete:t(n)>4,value:4,title:t(o)("game.header.step5")},{icon:u(()=>[l(A,{icon:"ri-number-5",size:"12"})]),_:1},8,["color","complete","title"])]),_:1}),l(be,{modelValue:t(n),"onUpdate:modelValue":s[0]||(s[0]=Q=>ie(n)?n.value=Q:null),class:"mt-4"},{default:u(()=>[l(W,{value:0},{default:u(()=>[t(c)?(v(),b(Z,{key:0,height:m(),style:{"overflow-y":"auto"}},{default:u(()=>[l(Ue,{ref_key:"roomRef",ref:I,"room-count":t(f),"max-players":t(r).userInfo.role==="admin"?0:t(r).userInfo.maxPlayers,"form-data":t(y)},null,8,["room-count","max-players","form-data"])]),_:1},8,["height"])):(v(),b(x,{key:1,type:"info",title:t(o)("game.base.loading"),height:m()},null,8,["title","height"]))]),_:1}),l(W,{value:1},{default:u(()=>[t(c)?(v(),b(Z,{key:0,height:m(),style:{"overflow-y":"auto"}},{default:u(()=>[l(je,{ref_key:"worldRef",ref:E,"world-count":t(S),"form-data":t(_),"game-mode":t(y).gameMode,"max-worlds":t(r).userInfo.role==="admin"?0:t(r).userInfo.maxWorlds,theme:t(i).theme,"tab-window-height":m()-300},null,8,["world-count","form-data","game-mode","max-worlds","theme","tab-window-height"])]),_:1},8,["height"])):(v(),b(x,{key:1,type:"info",title:t(o)("game.base.loading"),height:m()},null,8,["title","height"]))]),_:1}),l(W,{value:2},{default:u(()=>[t(c)?(v(),b(Z,{key:0,height:m(),style:{"overflow-y":"auto"}},{default:u(()=>[l(Je,{ref_key:"modRef",ref:G,worlds:t(_),mod:t(y).modData,"mod-in-one":t(y).modInOne,theme:t(i).theme,"tab-window-height":m()-110},null,8,["worlds","mod","mod-in-one","theme","tab-window-height"])]),_:1},8,["height"])):(v(),b(x,{key:1,type:"info",title:t(o)("game.base.loading"),height:m()},null,8,["title","height"]))]),_:1}),l(W,{value:3},{default:u(()=>[t(c)?(v(),b(Z,{key:0,height:m(),style:{"overflow-y":"auto"}},{default:u(()=>[l(qe,{ref_key:"roomSettingRef",ref:P,"room-setting":t(d)},null,8,["room-setting"])]),_:1},8,["height"])):(v(),b(x,{key:1,type:"info",title:t(o)("game.base.loading"),height:m()},null,8,["title","height"]))]),_:1}),l(W,{value:4},{default:u(()=>[l(x,{type:"success",height:m(),title:t(o)("game.base.step5.title"),"sub-title":t(o)("game.base.step5.subTitle")},null,8,["height","title","sub-title"])]),_:1})]),_:1},8,["modelValue"]),l(fe,{class:"mx-8"},{prev:u(()=>[l(z,{disabled:t(n)===0,color:"grey-lighten-3",variant:"elevated",onClick:C},{default:u(()=>[j(J(t(o)("game.prev")),1)]),_:1},8,["disabled"])]),next:u(()=>[t(n)!==4?(v(),b(z,{key:0,color:"primary",variant:"elevated",onClick:$},{default:u(()=>[j(J(t(o)("game.next.button")),1)]),_:1})):se("",!0),t(n)===4?(v(),b(z,{key:1,color:"success",disabled:!1,loading:t(T),variant:"elevated",onClick:he},{default:u(()=>[j(J(t(o)("game.next.save")),1)]),_:1},8,["loading"])):se("",!0)]),_:1})]),_:1},8,["modelValue"]))],64)):(v(),re(X,{key:1},[t(r).userInfo.role==="admin"?(v(),b(x,{key:0,title:t(o)("global.noGame.title"),"sub-title":t(o)("global.noGame.subTitle"),height:m(),type:"error"},{default:u(()=>[l(z,{to:"/install",class:"mt-4"},{default:u(()=>[j(J(t(o)("global.noGame.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"])):(v(),b(x,{key:1,title:t(o)("global.noGameNoAdmin.title"),"sub-title":t(o)("global.noGameNoAdmin.subTitle"),height:m(),type:"error"},null,8,["title","sub-title","height"]))],64))}}};export{Lt as default};
