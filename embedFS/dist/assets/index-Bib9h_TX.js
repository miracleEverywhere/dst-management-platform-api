import{_ as ne}from"./ConfirmBox-CBTy0VDE.js";import{_ as ie}from"./Result-BvQhh4Hg.js";import{e as re,b as ce,u as de,d as ue,g as me,h as d,L as fe,f as ge,a3 as pe,a4 as he,c as k,o as i,a as t,l as e,F as $,k as v,y as g,E as b,ab as ve,w as a,q as c,t as r,p as C,v as _e,x as be,W as ye,G as N,P as D,Q as B,A as ke,a6 as X,a7 as Ve,R as we,s as xe,B as U}from"./index-CSWM8PGT.js";import{r as F}from"./room-T2ZmcF4P.js";import{C as Ce}from"./vue3-count-to.esm-BfZmqxtO.js";import{e as Ne}from"./eventBus-B8tShFcG.js";import{V as ze}from"./VTextField-DgFfv3B-.js";import{V}from"./VRow-BwGkVpfK.js";import{V as p}from"./VCol-Dk4rjd-B.js";import{V as Y,c as Ie,a as Re}from"./VCard-DoH6Ajyn.js";import{V as z}from"./VChip-DAB0yfSC.js";import{V as Se}from"./VMenu-B4BE62PC.js";import{V as Me}from"./VList-PDv2Ilkl.js";import{V as Le}from"./VSparkline-DWydcCFd.js";import{V as Te}from"./VPagination-CD-yJcl-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VAlert-BE9s7kxy.js";import"./VSpacer-CmX1Lvra.js";/* empty css              */import"./VDialog-Bg9ejpQi.js";import"./dialog-transition-Bv0U4mMB.js";import"./VContainer-B4rEQyGp.js";import"./axios-Bvo3OPMF.js";import"./index-BqN8vuBc.js";import"./VInput-DLz1cftP.js";import"./ssrBoot-CYBeFzdW.js";const $e={class:"fcc"},De={class:"fcb"},Be={class:"fcc"},Fe=["onClick"],Ge={class:"text-caption text-grey"},He={class:"text-h3 font-weight-black"},qe={key:1},Ae={key:1},Pe={key:2},ht={__name:"index",setup(Ee){const{mobile:u}=re(),{t:l}=ce(),W=de(),w=ue(),_=me(),R=d(window.innerHeight),K=()=>Math.max(2,Math.floor((R.value-204)/300)*2),m=d({gameName:"",page:1,pageSize:0}),S=d([]),G=d(0),M=d(!1),h=async()=>{M.value=!0;const s=await F.list.get(m.value);S.value=s.data.rows||[],G.value=s.data.total,M.value=!1},O=async()=>{_.room={id:0,gameName:""},Z(),await W.push("/game/base")},Z=()=>{Ne.emit("toggleMenu",3)},ee=s=>{_.room.id=s.id,_.room.gameName=s.gameName},te=async s=>{_.room.id=s.id,_.room.gameName=s.gameName,await W.push("/dashboard")},Q=s=>{if(s.length===0)return[0,0];const n=[];for(let f of s)n.push(f.playerInfo?.length||0);return n},H=(s,n)=>{switch(s){case"activate":ae(n);break;case"deactivate":le(n);break;case"delete":E.value=n.id,x.value=!0;break}},q=d(!1),ae=s=>{q.value=!0;const n={roomID:s.id};F.activate.post(n).then(f=>{U(f.message),h()}).finally(()=>{q.value=!1})},A=d(!1),le=s=>{A.value=!0;const n={roomID:s.id};F.deactivate.post(n).then(f=>{U(f.message),h()}).finally(()=>{A.value=!1})},P=d(!1),E=d(0),x=d(!1),oe=()=>{P.value=!0;const s={roomID:E.value};F.base.delete(s).then(n=>{x.value=!1,U(n.message),h(),_.room.id===E.value&&(_.room.id=0)}).finally(()=>{P.value=!1})},I=d(),L=d(0),T=()=>Math.max(2,Math.floor(R.value-120));fe(R,()=>{h()},{immediate:!1});const j=pe(()=>{R.value=window.innerHeight,m.value.pageSize=K(),I.value&&(L.value=I.value.$el.offsetWidth)},200);return ge(async()=>{m.value.pageSize=K(),await h(),I.value&&(L.value=I.value.$el.offsetWidth),window.addEventListener("resize",j)}),he(()=>{window.removeEventListener("resize",j)}),(s,n)=>{const f=ie,se=ne;return i(),k($,null,[e(_).gameVersion.local!==0?(i(),k($,{key:0},[v("div",$e,[t(ze,{modelValue:e(m).gameName,"onUpdate:modelValue":n[0]||(n[0]=o=>e(m).gameName=o),label:e(l)("rooms.header.input.label"),placeholder:e(l)("rooms.header.input.placeholder"),"append-inner-icon":"ri-search-line",class:"mr-4",loading:e(M),"onClick:appendInner":h,onKeyup:ve(h,["enter"])},null,8,["modelValue","label","placeholder","loading"]),e(u)?b("",!0):(i(),g(C,{key:0,disabled:!e(w).userInfo.roomCreation&&e(w).userInfo.role!=="admin","prepend-icon":"ri-add-line",variant:"elevated",size:"large",class:"mr-4",onClick:O},{default:a(()=>[c(r(e(l)("rooms.header.button.create")),1)]),_:1},8,["disabled"])),e(u)?b("",!0):(i(),g(C,{key:1,"prepend-icon":"ri-refresh-line",color:"default",variant:"elevated",size:"large",onClick:h},{default:a(()=>[c(r(e(l)("rooms.header.button.refresh")),1)]),_:1})),e(u)?(i(),g(C,{key:2,disabled:!e(w).userInfo.roomCreation&&e(w).userInfo.role!=="admin",icon:"ri-add-line",class:"mr-4",onClick:O},null,8,["disabled"])):b("",!0),e(u)?(i(),g(C,{key:3,icon:"ri-refresh-line",color:"default",onClick:h})):b("",!0)]),t(V,{class:"mt-8"},{default:a(()=>[t(V,{class:"mx-1"},{default:a(()=>[(i(!0),k($,null,_e(e(S),(o,J)=>(i(),g(p,{key:J,cols:e(u)?12:6},{default:a(()=>[t(Y,{ref_for:!0,ref:y=>{J===0&&(I.value=y)},hover:"",variant:"flat",height:"300px"},{default:a(()=>[t(Ie,null,{default:a(()=>[v("div",De,[v("div",Be,[t(z,{color:"primary"},{default:a(()=>[c(r(e(ye)(o.gameName,e(u)?8:15)),1)]),_:2},1024),t(z,{color:o.status?"success":"warning",class:"ml-4"},{default:a(()=>[c(r(o.status?e(l)("rooms.card.success.header.title.activated"):e(l)("rooms.card.success.header.title.deactivated")),1)]),_:2},1032,["color"]),e(_).room.id===o.id?(i(),g(N,{key:0,icon:"ri-crosshair-2-line",color:"info",class:"ml-4"})):b("",!0)]),t(Se,null,{activator:a(({props:y})=>[t(C,ke({ref_for:!0},y,{disabled:e(M),loading:e(q)||e(A),color:"primary",icon:"ri-more-2-line"}),null,16,["disabled","loading"])]),default:a(()=>[t(Me,null,{default:a(()=>[t(D,{class:"text-success",onClick:y=>te(o)},{prepend:a(()=>[t(N,{icon:"ri-checkbox-circle-line",size:"22"})]),default:a(()=>[t(B,null,{default:a(()=>[c(r(e(l)("rooms.card.success.header.menu.select")),1)]),_:1})]),_:1},8,["onClick"]),t(D,{class:"text-success",disabled:o.status,onClick:y=>H("activate",o)},{prepend:a(()=>[t(N,{icon:"ri-play-large-line",size:"22"})]),default:a(()=>[t(B,null,{default:a(()=>[c(r(e(l)("rooms.card.success.header.menu.activate")),1)]),_:1})]),_:1},8,["disabled","onClick"]),t(D,{class:"text-warning",disabled:!o.status,onClick:y=>H("deactivate",o)},{prepend:a(()=>[t(N,{icon:"ri-stop-large-line",color:"warning",size:"22"})]),default:a(()=>[t(B,null,{default:a(()=>[c(r(e(l)("rooms.card.success.header.menu.deactivate")),1)]),_:1})]),_:1},8,["disabled","onClick"]),t(D,{class:"text-error",disabled:e(w).userInfo.role!=="admin",onClick:y=>H("delete",o)},{prepend:a(()=>[t(N,{icon:"ri-delete-bin-line",size:"22"})]),default:a(()=>[t(B,null,{default:a(()=>[c(r(e(l)("platform.rooms.actions.delete")),1)]),_:1})]),_:1},8,["disabled","onClick"])]),_:2},1024)]),_:2},1024)])]),_:2},1024),be((i(),g(Re,null,{default:a(()=>[o.gameName!==""?(i(),k("div",{key:0,class:"mt-4",onClick:y=>ee(o)},[t(V,null,{default:a(()=>[t(p,{cols:e(u)?12:6},{default:a(()=>[t(V,null,{default:a(()=>[t(p,{cols:"6"},{default:a(()=>[v("span",null,r(e(l)("rooms.card.success.text.left.gameMode")),1)]),_:1}),t(p,{cols:"6"},{default:a(()=>[t(z,{color:"info",label:""},{default:a(()=>[c(r(e(l)(`game.base.step1.gameMode.modes.${o.gameMode}`)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(V,null,{default:a(()=>[t(p,{cols:"6"},{default:a(()=>[v("span",null,r(e(l)("rooms.card.success.text.left.worldNum")),1)]),_:1}),t(p,{cols:"6"},{default:a(()=>[t(z,{color:"info",label:""},{default:a(()=>[c(r(o.worlds.length),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(V,null,{default:a(()=>[t(p,{cols:"6"},{default:a(()=>[v("span",null,r(e(l)("rooms.card.success.text.left.modNum")),1)]),_:1}),t(p,{cols:"6"},{default:a(()=>[t(z,{color:"info",label:""},{default:a(()=>[c(r(o.modInOne?e(X)(o.modData).length:e(X)(o.worlds[0].modData).length),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(V,null,{default:a(()=>[t(p,{cols:"6"},{default:a(()=>[v("span",null,r(e(l)("rooms.card.success.text.left.playerNum")),1)]),_:1}),t(p,{cols:"6"},{default:a(()=>[t(z,{color:"info",label:""},{default:a(()=>[c(r(o.maxPlayer),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["cols"]),e(u)?b("",!0):(i(),g(p,{key:0,cols:e(u)?12:6},{default:a(()=>[t(Y,{height:240,variant:"flat"},{prepend:a(()=>[t(N,{color:"primary",class:"me-8",icon:"ri-line-chart-line",size:"48"})]),title:a(()=>[v("div",Ge,r(e(l)("rooms.card.success.text.right.chartTitle")),1),v("span",He,[t(e(Ce),{duration:4e3,"end-val":Math.max(...Q(o.players)),"start-val":0},null,8,["end-val"])]),v("strong",null,r(e(l)("rooms.card.success.text.right.unit")),1)]),default:a(()=>[t(Ve,{color:"transparent"},{default:a(()=>[t(Le,{width:e(u)?e(L):e(L)/2,gradient:["#1feaea"],"line-width":3,"model-value":Q(o.players),smooth:"",padding:"8","stroke-linecap":"round","auto-draw":""},null,8,["width","model-value"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["cols"]))]),_:2},1024)],8,Fe)):(i(),k("div",qe,[t(f,{type:"warning",height:e(u)?600:300,title:e(l)("rooms.card.warning.title"),"sub-title":e(l)("rooms.card.warning.subTitle")},null,8,["height","title","sub-title"])]))]),_:2},1024)),[[we]])]),_:2},1536)]),_:2},1032,["cols"]))),128))]),_:1})]),_:1}),e(G)>e(m).pageSize?(i(),g(Te,{key:0,modelValue:e(m).page,"onUpdate:modelValue":[n[1]||(n[1]=o=>e(m).page=o),h],length:Math.max(1,Math.ceil(e(G)/e(m).pageSize)),class:"mt-8"},null,8,["modelValue","length"])):b("",!0),e(S).length===0&&e(m).gameName!==""?(i(),k("div",Ae,[t(f,{type:"warning",height:T()-72,title:e(l)("rooms.result.noResult.title"),"sub-title":e(l)("rooms.result.noResult.subTitle")},null,8,["height","title","sub-title"])])):b("",!0),e(S).length===0&&e(m).gameName===""?(i(),k("div",Pe,[t(f,{type:"warning",height:T()-72,title:e(l)("rooms.result.noRoom.title"),"sub-title":e(l)("rooms.result.noRoom.subTitle")},null,8,["height","title","sub-title"])])):b("",!0)],64)):(i(),k($,{key:1},[e(w).userInfo.role==="admin"?(i(),g(f,{key:0,title:e(l)("global.noGame.title"),"sub-title":e(l)("global.noGame.subTitle"),height:T(),type:"error"},{default:a(()=>[t(C,{to:"/install",class:"mt-4"},{default:a(()=>[c(r(e(l)("global.noGame.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"])):(i(),g(f,{key:1,title:e(l)("global.noGameNoAdmin.title"),"sub-title":e(l)("global.noGameNoAdmin.subTitle"),height:T(),type:"error"},null,8,["title","sub-title","height"]))],64)),t(se,{modelValue:e(x),"onUpdate:modelValue":n[2]||(n[2]=o=>xe(x)?x.value=o:null),type:"warning",title:e(l)("global.confirm.title"),content:e(l)("global.confirm.content"),"confirm-text":e(l)("global.confirm.confirm"),"cancel-text":e(l)("global.confirm.cancel"),"confirm-loading":e(P),onConfirm:oe,onCancel:n[3]||(n[3]=o=>x.value=!1)},null,8,["modelValue","title","content","confirm-text","cancel-text","confirm-loading"])],64)}}};export{ht as default};
