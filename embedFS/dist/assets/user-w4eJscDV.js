import{_ as de}from"./ConfirmBox-CPZbh5_a.js";import{e as fe,b as pe,h as v,f as ce,c as T,o as u,a as l,w as a,l as e,ac as ve,s as I,a8 as be,p as S,q as i,t as n,P as h,Q as J,G as N,y as d,F as E,x as b,z as O,V as X,R as Y,E as Z,m as ge,v as Ve,B as F,ax as ee,S as ye}from"./index-Cpi_5jeC.js";import{u as R}from"./user-C_pZs9SC.js";import{r as xe}from"./room-DJfQFaHt.js";import{V as _e,a as ke,b as Ce,c as we,d as Pe}from"./VBadge-DJ0NRu46.js";import{a as ae,V as le,c as Se,b as Ue}from"./VCard-ZqPzOf5v.js";import{V as g}from"./VRow-Btq46u2M.js";import{V as c}from"./VCol-Br9p8SvW.js";import{V as q}from"./VTextField-DYhVUV9X.js";import{V as We}from"./VDataTableServer-CRFCkTGN.js";import{V as Be}from"./VMenu-CxB9H3rV.js";import{V as De}from"./VList-DRw1DleY.js";import{V as f}from"./VChip-Bh9Ug9id.js";import{V as ze,a as Le}from"./VToolbar-G4SrZZyX.js";import{V as Te}from"./VForm-Dx6QmHot.js";import{T as V}from"./index-F5hD5yeZ.js";import{V as M,a as w}from"./VRadioGroup-iOOKV3tE.js";import{V as Fe}from"./VSelect-CBV9Nj71.js";import{V as re}from"./VSlider-_4wjeYT1.js";import{V as Re}from"./VSpacer-DElNdgDF.js";import{V as qe}from"./VDialog-DWc1dWI_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VAlert-BkYt7vzY.js";import"./axios-DcC5xP6t.js";/* empty css              */import"./index-C79QJLOU.js";import"./VInput-0HHYP18N.js";import"./VDataTable-MwzuhUk-.js";import"./VPagination-DAL6okay.js";import"./VCheckboxBtn-SGlC0nov.js";import"./VSelectionControl-DnzLro3k.js";import"./VTable-B_THj38S.js";import"./filter-Dgu3Q5Sx.js";import"./dialog-transition-Cs1ajW-l.js";import"./ssrBoot-C_2zAg2k.js";import"./VTooltip-D-HEEtuq.js";const Ae={key:0},_a={__name:"user",setup($e){const{mobile:P}=fe(),{t:r}=pe(),j=v([{roomName:"",roomID:0}]),oe=()=>{xe.basic.get().then(m=>{j.value=m.data||[]})},U=v(""),p=v({rows:[],page:1,pageSize:10,total:0}),W=v(!1),x=({page:m,itemsPerPage:t,sortBy:C})=>{const o={q:U.value,page:m,pageSize:t};W.value=!0,R.list.get(o).then(L=>{p.value=L.data}).finally(()=>{W.value=!1})},te=[{title:r("platform.user.form.username.title"),value:"username"},{title:r("platform.user.form.nickname.title"),value:"nickname"},{title:r("platform.user.form.role.title"),value:"role"},{title:r("platform.user.form.avatar.title"),value:"avatar"},{title:r("platform.user.form.disabled.title"),value:"disabled"},{title:r("platform.user.form.rooms.title"),value:"rooms"},{title:r("platform.user.form.roomCreation.title"),value:"roomCreation"},{title:r("platform.user.form.maxWorlds.title"),value:"maxWorlds"},{title:r("platform.user.form.maxPlayers.title"),value:"maxPlayers"},{title:r("platform.user.table.actions"),value:"actions"}],_=v(),s=v({username:"",nickname:"",role:"non-admin",avatar:"1",password:"",disabled:!1,rooms:[],roomCreation:!0,maxWorlds:2,maxPlayers:6}),A={username:[m=>m?!0:r("platform.user.form.username.required")],nickname:[m=>m?!0:r("platform.user.form.nickname.required")],password:[m=>m?!0:r("platform.user.form.password.required")]},y=v(!1),B=v(!1),se=()=>{y.value=!0,B.value=!1,s.value={username:"",nickname:"",role:"non-admin",avatar:"1",password:"",disabled:!1,rooms:[],roomCreation:!1,maxWorlds:2,maxPlayers:6},ee(()=>{_.value&&_.value.resetValidation()})},me={1:Pe,2:we,3:Ce,4:ke},G=m=>me[m],D=v(!1),z=v(!1),ne=async()=>{const{valid:m}=await _.value.validate();if(m)if(z.value=!0,B.value){const t={username:s.value.username,nickname:s.value.nickname,role:s.value.role,avatar:s.value.avatar,password:"",disabled:s.value.disabled,rooms:s.value.rooms.join(","),roomCreation:s.value.roomCreation,maxWorlds:s.value.maxWorlds,maxPlayers:s.value.maxPlayers};R.base.put(t).then(C=>{y.value=!1,F(C.message),x({page:p.value.page,itemsPerPage:p.value.pageSize,sortBy:void 0})}).finally(()=>{z.value=!1})}else{const t={username:s.value.username,nickname:s.value.nickname,role:s.value.role,avatar:s.value.avatar,password:ye(s.value.password),disabled:s.value.disabled,rooms:s.value.rooms.join(","),roomCreation:s.value.roomCreation,maxWorlds:s.value.maxWorlds,maxPlayers:s.value.maxPlayers};R.base.post(t).then(C=>{y.value=!1,F(C.message),x({page:p.value.page,itemsPerPage:p.value.pageSize,sortBy:void 0})}).finally(()=>{z.value=!1})}},K=m=>m?m.split(",").map(Number).filter(t=>!isNaN(t)):[],H=(m,t)=>{switch(m){case"update":ie(t);break;case"delete":Q.value=t.username,k.value=!0;break;default:F("牛哇","error")}},ie=m=>{y.value=!0,B.value=!0,s.value={username:m.username,nickname:m.nickname,role:m.role,avatar:m.avatar,disabled:m.disabled,rooms:K(m.rooms),roomCreation:m.roomCreation,maxWorlds:m.maxWorlds,maxPlayers:m.maxPlayers},ee(()=>{_.value&&_.value.resetValidation()})},k=v(!1),$=v(!1),Q=v(""),ue=()=>{$.value=!0;const m={username:Q.value};R.base.delete(m).then(t=>{k.value=!1,F(t.message),x({page:p.value.page,itemsPerPage:p.value.pageSize,sortBy:void 0})}).finally(()=>{$.value=!1})};return ce(()=>{oe()}),(m,t)=>{const C=de;return u(),T(E,null,[l(le,null,{default:a(()=>[l(ae,null,{default:a(()=>[l(g,null,{default:a(()=>[l(c,{cols:"12"},{default:a(()=>[l(q,{modelValue:e(U),"onUpdate:modelValue":t[0]||(t[0]=o=>I(U)?U.value=o:null),label:e(r)("platform.user.search.label"),placeholder:e(r)("platform.user.search.placeholder"),clearable:"",onKeyup:t[1]||(t[1]=ve(o=>x({page:e(p).page,itemsPerPage:e(p).pageSize,sortBy:void 0}),["enter"])),"onClick:clear":t[2]||(t[2]=o=>x({page:e(p).page,itemsPerPage:e(p).pageSize,sortBy:void 0}))},null,8,["modelValue","label","placeholder"])]),_:1}),l(c,{cols:"12"},{default:a(()=>[l(be,{rounded:"",border:""},{default:a(()=>[l(We,{"items-per-page":e(p).pageSize,"onUpdate:itemsPerPage":t[4]||(t[4]=o=>e(p).pageSize=o),items:e(p).rows,"items-length":e(p).total,page:e(p).page,loading:e(W),headers:te,"onUpdate:options":x},{top:a(()=>[l(ze,{flat:""},{default:a(()=>[l(Le,null,{default:a(()=>[l(N,{icon:"ri-id-card-line",start:""}),e(P)?Z("",!0):(u(),T("span",Ae,n(e(r)("platform.user.table.title")),1))]),_:1}),l(S,{"prepend-icon":"ri-add-line",color:"success",onClick:se},{default:a(()=>[i(n(e(r)("platform.user.table.create")),1)]),_:1}),l(S,{"prepend-icon":"ri-refresh-line",loading:e(W),color:"default",onClick:t[3]||(t[3]=o=>x({page:e(p).page,itemsPerPage:e(p).pageSize,sortBy:void 0}))},{default:a(()=>[i(n(e(r)("platform.user.table.refresh")),1)]),_:1},8,["loading"])]),_:1})]),"item.role":a(({value:o})=>[o==="admin"?(u(),d(f,{key:0,color:"primary",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.admin")),1)]),_:1})):(u(),d(f,{key:1,label:""},{default:a(()=>[i(n(e(r)("platform.user.table.nonAdmin")),1)]),_:1}))]),"item.avatar":a(({value:o})=>[b((u(),d(O,{color:"primary",variant:"tonal"},{default:a(()=>[l(X,{src:G(o)},null,8,["src"])]),_:2},1024)),[[Y]])]),"item.disabled":a(({value:o})=>[o?(u(),d(f,{key:0,color:"error",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.yes")),1)]),_:1})):(u(),d(f,{key:1,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.no")),1)]),_:1}))]),"item.rooms":a(({item:o})=>[o.role==="admin"?(u(),d(f,{key:0,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.noLimit")),1)]),_:1})):(u(),d(f,{key:1,color:"info",label:""},{default:a(()=>[i(n(K(o.rooms).length)+n(e(r)("platform.user.table.unit")),1)]),_:2},1024))]),"item.roomCreation":a(({item:o})=>[o.role==="admin"?(u(),d(f,{key:0,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.yes")),1)]),_:1})):(u(),T(E,{key:1},[o.roomCreation?(u(),d(f,{key:0,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.yes")),1)]),_:1})):(u(),d(f,{key:1,color:"error",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.no")),1)]),_:1}))],64))]),"item.maxWorlds":a(({item:o})=>[o.role==="admin"?(u(),d(f,{key:0,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.noLimit")),1)]),_:1})):(u(),d(f,{key:1,label:""},{default:a(()=>[i(n(o.maxWorlds),1)]),_:2},1024))]),"item.maxPlayers":a(({item:o})=>[o.role==="admin"?(u(),d(f,{key:0,color:"success",label:""},{default:a(()=>[i(n(e(r)("platform.user.table.noLimit")),1)]),_:1})):(u(),d(f,{key:1,label:""},{default:a(()=>[i(n(o.maxPlayers),1)]),_:2},1024))]),"item.actions":a(({item:o})=>[l(S,{color:"info","append-icon":"ri-arrow-drop-down-line",variant:"text"},{default:a(()=>[i(n(e(r)("platform.user.table.actions"))+" ",1),l(Be,{activator:"parent"},{default:a(()=>[l(De,null,{default:a(()=>[l(h,{class:"text-warning",onClick:L=>H("update",o)},{prepend:a(()=>[l(N,{icon:"ri-user-settings-line",size:"22"})]),default:a(()=>[l(J,null,{default:a(()=>[i(n(e(r)("platform.user.table.update")),1)]),_:1})]),_:1},8,["onClick"]),l(h,{disabled:o.role==="admin",class:"text-error",onClick:L=>H("delete",o)},{prepend:a(()=>[l(N,{icon:"ri-user-unfollow-line",size:"22"})]),default:a(()=>[l(J,null,{default:a(()=>[i(n(e(r)("platform.user.table.delete")),1)]),_:1})]),_:1},8,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["items-per-page","items","items-length","page","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(qe,{modelValue:e(y),"onUpdate:modelValue":t[16]||(t[16]=o=>I(y)?y.value=o:null),width:e(P)?"85%":"60%"},{default:a(()=>[l(le,null,{default:a(()=>[l(Se,null,{default:a(()=>[...t[19]||(t[19]=[i(" 新建用户 ",-1)])]),_:1}),l(Te,{ref_key:"userFormRef",ref:_,class:"mx-6",onSubmit:ge(ne,["prevent"])},{default:a(()=>[l(ae,{class:"my-2"},{default:a(()=>[l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[b(l(q,{modelValue:e(s).username,"onUpdate:modelValue":t[5]||(t[5]=o=>e(s).username=o),rules:A.username,label:e(r)("platform.user.form.username.title")},null,8,["modelValue","rules","label"]),[[V,e(r)("platform.user.form.username.tip")]])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[b(l(q,{modelValue:e(s).nickname,"onUpdate:modelValue":t[6]||(t[6]=o=>e(s).nickname=o),rules:A.nickname,label:e(r)("platform.user.form.nickname.title")},null,8,["modelValue","rules","label"]),[[V,e(r)("platform.user.form.nickname.tip")]])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,{cols:"12",md:"6"},{default:a(()=>[l(M,{modelValue:e(s).role,"onUpdate:modelValue":t[7]||(t[7]=o=>e(s).role=o),inline:""},{prepend:a(()=>[b((u(),d(f,null,{default:a(()=>[i(n(e(r)("platform.user.form.role.title")),1)]),_:1})),[[V,e(r)("platform.user.form.role.tip")]])]),default:a(()=>[l(w,{label:e(r)("platform.user.form.role.admin"),value:"admin",class:"mr-4"},null,8,["label"]),l(w,{label:e(r)("platform.user.form.role.nonAdmin"),value:"non-admin",class:"mr-4"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),l(c,{cols:"12",md:"6"},{default:a(()=>[l(M,{modelValue:e(s).disabled,"onUpdate:modelValue":t[8]||(t[8]=o=>e(s).disabled=o),inline:""},{prepend:a(()=>[b((u(),d(f,null,{default:a(()=>[i(n(e(r)("platform.user.form.disabled.title")),1)]),_:1})),[[V,e(r)("platform.user.form.disabled.tip")]])]),default:a(()=>[l(w,{label:e(r)("platform.user.form.disabled.yes"),value:!0,class:"mr-4"},null,8,["label"]),l(w,{label:e(r)("platform.user.form.disabled.no"),value:!1,class:"mr-4"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,{cols:e(P)?4:2,class:"d-flex align-center"},{default:a(()=>[l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[b((u(),d(f,null,{default:a(()=>[i(n(e(r)("platform.user.form.avatar.title")),1)]),_:1})),[[V,e(r)("platform.user.form.avatar.tip")]])]),_:1})]),_:1})]),_:1},8,["cols"]),l(c,{cols:e(P)?8:10},{default:a(()=>[l(g,null,{default:a(()=>[(u(),T(E,null,Ve(4,o=>l(c,{key:o,cols:e(P)?6:3},{default:a(()=>[l(_e,{dot:"",location:"bottom right","offset-x":"3","offset-y":"3",color:"success","model-value":e(s).avatar===o.toString()},{default:a(()=>[b((u(),d(O,{color:"primary",variant:"tonal",onClick:L=>e(s).avatar=o.toString()},{default:a(()=>[l(X,{src:G(o)},null,8,["src"])]),_:2},1032,["onClick"])),[[Y]])]),_:2},1032,["model-value"])]),_:2},1032,["cols"])),64))]),_:1})]),_:1},8,["cols"])]),_:1}),e(B)?Z("",!0):(u(),d(g,{key:0},{default:a(()=>[l(c,null,{default:a(()=>[b(l(q,{modelValue:e(s).password,"onUpdate:modelValue":t[9]||(t[9]=o=>e(s).password=o),"append-inner-icon":e(D)?"ri-eye-off-line":"ri-eye-line",type:e(D)?"text":"password",autocomplete:"password",label:e(r)("platform.user.form.password.title"),rules:A.password,clearable:"","onClick:appendInner":t[10]||(t[10]=o=>D.value=!e(D))},null,8,["modelValue","append-inner-icon","type","label","rules"]),[[V,e(r)("platform.user.form.password.tip")]])]),_:1})]),_:1})),l(g,null,{default:a(()=>[l(c,{cols:"12"},{default:a(()=>[l(M,{modelValue:e(s).roomCreation,"onUpdate:modelValue":t[11]||(t[11]=o=>e(s).roomCreation=o),disabled:e(s).role==="admin",inline:""},{prepend:a(()=>[b((u(),d(f,null,{default:a(()=>[i(n(e(r)("platform.user.form.roomCreation.title")),1)]),_:1})),[[V,e(r)("platform.user.form.roomCreation.tip")]])]),default:a(()=>[l(w,{label:e(r)("platform.user.form.roomCreation.yes"),value:!0,class:"mr-4"},null,8,["label"]),l(w,{label:e(r)("platform.user.form.roomCreation.no"),value:!1,class:"mr-4"},null,8,["label"])]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,{cols:"12"},{default:a(()=>[b(l(Fe,{modelValue:e(s).rooms,"onUpdate:modelValue":t[12]||(t[12]=o=>e(s).rooms=o),disabled:e(s).role==="admin",items:e(j),"item-title":"roomName","item-value":"roomID",label:e(r)("platform.user.form.rooms.title"),multiple:"",chips:""},null,8,["modelValue","disabled","items","label"]),[[V,e(r)("platform.user.form.rooms.tip")]])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[l(re,{modelValue:e(s).maxPlayers,"onUpdate:modelValue":t[13]||(t[13]=o=>e(s).maxPlayers=o),disabled:e(s).role==="admin",max:64,min:1,class:"align-center","hide-details":"",step:"1",style:{"margin-left":"-1px"}},{label:a(()=>[b((u(),d(f,{style:{"margin-right":"1rem"}},{default:a(()=>[i(n(e(r)("platform.user.form.maxPlayers.title")),1)]),_:1})),[[V,e(r)("platform.user.form.maxPlayers.tip")]])]),append:a(()=>[l(f,{label:"",color:"primary"},{default:a(()=>[i(n(e(s).maxPlayers),1)]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(c,null,{default:a(()=>[l(re,{modelValue:e(s).maxWorlds,"onUpdate:modelValue":t[14]||(t[14]=o=>e(s).maxWorlds=o),disabled:e(s).role==="admin",max:64,min:1,class:"align-center","hide-details":"",step:"1",style:{"margin-left":"-1px"}},{label:a(()=>[b((u(),d(f,{style:{"margin-right":"1rem"}},{default:a(()=>[i(n(e(r)("platform.user.form.maxWorlds.title")),1)]),_:1})),[[V,e(r)("platform.user.form.maxWorlds.tip")]])]),append:a(()=>[l(f,{label:"",color:"primary"},{default:a(()=>[i(n(e(s).maxWorlds),1)]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),l(Ue,{class:"my-6"},{default:a(()=>[l(Re),l(S,{color:"default",variant:"elevated",text:e(r)("login.cancel"),class:"mr-4",onClick:t[15]||(t[15]=o=>y.value=!1)},null,8,["text"]),l(S,{text:e(r)("login.submit"),loading:e(z),variant:"elevated",type:"submit"},null,8,["text","loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue","width"]),l(C,{modelValue:e(k),"onUpdate:modelValue":t[17]||(t[17]=o=>I(k)?k.value=o:null),type:"warning",title:e(r)("global.confirm.title"),content:e(r)("global.confirm.content"),"confirm-text":e(r)("global.confirm.confirm"),"cancel-text":e(r)("global.confirm.cancel"),"confirm-loading":e($),onConfirm:ue,onCancel:t[18]||(t[18]=o=>k.value=!1)},null,8,["modelValue","title","content","confirm-text","cancel-text","confirm-loading"])],64)}}};export{_a as default};
