import{_ as U}from"./Result-xqSnAKSL.js";import{t as b}from"./tools-DXH5-QJ9.js";import{g as P,d as Q,b as J,e as K,f as d,j as O,a4 as W,a5 as X,c as D,l as t,o as p,y as v,w as e,a,s as Y,p as k,q as r,t as i,P as N,Q as S,G as y,aF as Z,a9 as ee,A as M,a8 as te,F as q,C as V}from"./index-CkNbSyGh.js";import{V as oe}from"./VDataTable-rXtQItL3.js";import{V as ae}from"./VMenu-D2l1j7S0.js";import{V as le}from"./VList-B4ZoK83V.js";import{V as w}from"./VChip-BYgMm5U1.js";import{V as se,a as ie}from"./VToolbar-CpVJajtM.js";import{V as ne}from"./VSkeletonLoader-CiMs7sWU.js";import"./VContainer-DphP_HXU.js";/* empty css              */import"./axios-D9wugClK.js";import"./VPagination-DyeMdUEe.js";import"./VSelect-CCrSk_bo.js";import"./VInput-DAl67pJ-.js";import"./index-C_E8fDh9.js";import"./VTextField-CIbt9Jw8.js";import"./VCheckboxBtn-DTkK2TZk.js";import"./VSelectionControl-CV465D96.js";import"./dialog-transition-CkYDvwCe.js";import"./VTable-DW-OVTmL.js";import"./filter-D10Qczcc.js";import"./ssrBoot-vMFB3qzm.js";const re={key:0},xe={__name:"backup",setup(ue){const u=P(),G=Q(),{t:o}=J(),{mobile:z}=K(),I=d(window.innerHeight),h=d(!1),C=d([]),g=()=>{if(u.room.id===0)return;h.value=!0;const n={roomID:u.room.id};b.backup.get(n).then(l=>{C.value=l.data,C.value.sort((m,s)=>s.timestamp-m.timestamp)}).finally(()=>{h.value=!1})},f=d([]),$=[{key:"gameName",title:o("tools.backup.gameName")},{key:"cycles",title:o("tools.backup.cycles")},{key:"size",title:o("tools.backup.size")},{key:"timestamp",title:o("tools.backup.timestamp")},{key:"actions",title:o("tools.backup.actions")}],c=d(!1),B=d(!1),R=()=>{B.value=!0;const n={roomID:u.room.id};b.backup.post(n).then(l=>{g(),V(l.message)}).finally(()=>{B.value=!1})},_=d(!1),A=n=>{_.value=!0,c.value=!0;const l={roomID:u.room.id,filenames:[n]};b.backup.delete(l).then(m=>{g(),V(o("tools.backup.deleteMessage1")+m.data+o("tools.backup.deleteMessage2"))}).finally(()=>{_.value=!1,c.value=!1})},E=()=>{_.value=!0,c.value=!0;const n={roomID:u.room.id,filenames:f.value.map(l=>l.fileName)};b.backup.delete(n).then(l=>{g(),f.value=[],V(o("tools.backup.deleteMessage1")+l.data+o("tools.backup.deleteMessage2"))}).finally(()=>{_.value=!1,c.value=!1})},L=d(!1),H=n=>{c.value=!0,L.value=!0;const l={roomID:u.room.id,filename:n};b.backup.restore.post(l).then(m=>{V(m.message)}).finally(()=>{L.value=!1,c.value=!1})},j=n=>{c.value=!0;const l={roomID:u.room.id,filename:n};b.backup.download.download(l,"dmp_backup.zip").finally(()=>{c.value=!1})},x=W(()=>{I.value=window.innerHeight},200),F=()=>Math.max(2,Math.floor(I.value-150));return O(()=>{window.addEventListener("resize",x),g()}),X(()=>{window.removeEventListener("resize",x)}),(n,l)=>{const m=U;return t(u).gameVersion.local!==0?(p(),D(q,{key:0},[t(u).room.id!==0?(p(),v(te,{key:0,border:"",rounded:""},{default:e(()=>[a(oe,{modelValue:t(f),"onUpdate:modelValue":l[0]||(l[0]=s=>Y(f)?f.value=s:null),"show-select":"","return-object":"",headers:$,items:t(C),loading:t(h)},{loading:e(()=>[a(ne,{type:"table-row@10"})]),top:e(()=>[a(se,{flat:""},{default:e(()=>[a(ie,null,{default:e(()=>[a(y,{icon:"ri-save-2-line",start:""}),t(z)?M("",!0):(p(),D("span",re,i(t(o)("tools.backup.title")),1))]),_:1}),a(k,{"prepend-icon":"ri-add-line",color:"success",loading:t(B),onClick:R},{default:e(()=>[r(i(t(o)("tools.backup.backup")),1)]),_:1},8,["loading"]),a(k,{"prepend-icon":"ri-delete-bin-5-line",color:"error",disabled:t(f).length===0,loading:t(_),onClick:E},{default:e(()=>[r(i(t(o)("tools.backup.multiDelete")),1)]),_:1},8,["disabled","loading"]),t(z)?M("",!0):(p(),v(k,{key:0,"prepend-icon":"ri-refresh-line",loading:t(h),color:"default",onClick:g},{default:e(()=>[r(i(t(o)("platform.user.table.refresh")),1)]),_:1},8,["loading"]))]),_:1})]),"item.gameName":e(({value:s})=>[a(w,{label:"",color:"primary"},{default:e(()=>[r(i(s),1)]),_:2},1024)]),"item.cycles":e(({value:s})=>[a(w,{label:"",color:"info"},{default:e(()=>[r(i(s),1)]),_:2},1024)]),"item.size":e(({value:s})=>[a(w,{label:"",color:"success"},{default:e(()=>[r(i(t(ee)(s)),1)]),_:2},1024)]),"item.timestamp":e(({value:s})=>[a(w,{label:"",color:"default"},{default:e(()=>[r(i(t(Z)(s)),1)]),_:2},1024)]),"item.actions":e(({item:s})=>[a(k,{color:"info","append-icon":"ri-arrow-drop-down-line",variant:"text",loading:t(c)},{default:e(()=>[r(i(t(o)("tools.backup.actions"))+" ",1),a(ae,{activator:"parent"},{default:e(()=>[a(le,null,{default:e(()=>[a(N,{class:"text-success",onClick:T=>H(s.fileName)},{prepend:e(()=>[a(y,{icon:"ri-device-recover-line",size:"22"})]),default:e(()=>[a(S,null,{default:e(()=>[r(i(t(o)("tools.backup.restore")),1)]),_:1})]),_:1},8,["onClick"]),a(N,{class:"text-info",onClick:T=>j(s.fileName)},{prepend:e(()=>[a(y,{icon:"ri-download-line",size:"22"})]),default:e(()=>[a(S,null,{default:e(()=>[r(i(t(o)("tools.backup.download")),1)]),_:1})]),_:1},8,["onClick"]),a(N,{class:"text-error",onClick:T=>A(s.fileName)},{prepend:e(()=>[a(y,{icon:"ri-delete-bin-line",size:"22"})]),default:e(()=>[a(S,null,{default:e(()=>[r(i(t(o)("tools.backup.delete")),1)]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["loading"])]),_:1},8,["modelValue","items","loading"])]),_:1})):(p(),v(m,{key:1,title:t(o)("global.noRoomSelected.title"),"sub-title":t(o)("global.noRoomSelected.subTitle"),type:"error",height:F()},{default:e(()=>[a(k,{to:"/rooms",class:"mt-4"},{default:e(()=>[r(i(t(o)("global.noRoomSelected.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"]))],64)):(p(),D(q,{key:1},[t(G).userInfo.role==="admin"?(p(),v(m,{key:0,title:t(o)("global.noGame.title"),"sub-title":t(o)("global.noGame.subTitle"),height:F(),type:"error"},{default:e(()=>[a(k,{to:"/install",class:"mt-4"},{default:e(()=>[r(i(t(o)("global.noGame.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"])):(p(),v(m,{key:1,title:t(o)("global.noGameNoAdmin.title"),"sub-title":t(o)("global.noGameNoAdmin.subTitle"),height:F(),type:"error"},null,8,["title","sub-title","height"]))],64))}}};export{xe as default};
