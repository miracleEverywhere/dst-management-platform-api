import{_ as Q}from"./Result-0C3w8lY6.js";import{g as j,d as K,b as X,e as Y,h as d,f as Z,c as y,o as m,a as o,l as e,F as T,y as p,w as t,a8 as ee,p as v,q as c,t as s,P as R,Q as B,G as D,W as te,E as oe,m as le,k as M,x as F,s as ne,ax as ae,B as U,ct as se}from"./index-CdazYsXs.js";import{t as I}from"./tools-C94QI2RF.js";import{V as ie}from"./VDataTable-BN1SJioQ.js";import{V as re}from"./VMenu-BFDj5E0P.js";import{V as ue}from"./VList-DRcsg_FG.js";import{V as k}from"./VChip-D5T73rYJ.js";import{V as me,a as ce}from"./VToolbar-CEGA3JT6.js";import{V as de}from"./VSkeletonLoader-ChnwrmF1.js";import{V as $,c as fe,a as pe,b as ve}from"./VCard-CGfU41V6.js";import{V as Ve}from"./VForm-CvuAZ-6x.js";import{V as N}from"./VRow-BSBKnbX1.js";import{V as ge,a as q}from"./VRadioGroup-CBmBoobw.js";import{T as A}from"./index-BUte65zl.js";import{V as be}from"./VNumberInput-DfeDwIoy.js";import{V as _e}from"./VTextField-D0Ki9G5g.js";import{V as he}from"./VSpacer-BlbldoqA.js";import{V as ye}from"./VDialog-BTFCVy4A.js";import"./VContainer-i_8MNGz0.js";/* empty css              */import"./axios-B6WrsswM.js";import"./VPagination-Cpy1tpsp.js";import"./VSelect-D-CpaDxw.js";import"./VInput-xf8cSZvT.js";import"./index-F_tKZn5V.js";import"./VCheckboxBtn-BjZNuGS_.js";import"./VSelectionControl-DN4LuCu6.js";import"./dialog-transition-BV35mueV.js";import"./VTable-B9rlmoSI.js";import"./filter-_9W70m4p.js";import"./ssrBoot-BdSAGq_c.js";import"./VTooltip-BVw35RBe.js";const ke={key:0},we={style:{width:"50px"}},lt={__name:"announce",setup(xe){const V=j(),z=K(),{t:l}=X(),{mobile:G}=Y(),E=d(window.innerHeight),f=d([]),b=d(!1),_=()=>{if(V.room.id===0)return;b.value=!0;const r={roomID:V.room.id};I.announce.get(r).then(a=>{a.data!==""&&(f.value=JSON.parse(a.data))}).finally(()=>{b.value=!1})},J=[{key:"status",title:l("tools.announce.form.status.title")},{key:"interval",title:l("tools.announce.form.interval.title"),minWidth:120},{key:"content",title:l("tools.announce.form.content.title")},{key:"actions",title:l("tools.announce.actions")}],g=d(!1),w=d(!1),L=(r,a=!1)=>{a?(w.value=!0,i.value={...r}):(w.value=!1,i.value={id:"",status:!0,interval:600,content:""}),ae(()=>{h.value&&h.value.resetValidation()}),g.value=!0},h=d(),i=d({id:"",status:!0,interval:600,content:""}),O=d({content:[r=>r?r.includes('"')||r.includes("'")?l("tools.announce.form.content.rule"):!0:l("tools.announce.form.content.required")]}),x=d(!1),H=async()=>{const{valid:r}=await h.value.validate();if(r){if(i.value.content=i.value.content.replace(/['"]/g,""),w.value){for(let u=0;u<f.value.length;u++)if(f.value[u].id===i.value.id){f.value[u]=i.value;break}}else x.value=!0,i.value.id=se(),f.value.push(i.value);const a={roomID:V.room.id,setting:JSON.stringify(f.value)};I.announce.put(a).then(u=>{U(u.message),g.value=!1,_()}).finally(()=>{x.value=!1})}},S=d(!1),W=r=>{S.value=!0;const a=f.value.filter(n=>n.id!==r),u={roomID:V.room.id,setting:JSON.stringify(a)};I.announce.put(u).then(n=>{U(l("tools.announce.deleteMessage")),_()}).finally(()=>{S.value=!1})},C=()=>Math.max(2,Math.floor(E.value-150));return Z(()=>{_()}),(r,a)=>{const u=Q;return m(),y(T,null,[e(V).gameVersion.local!==0?(m(),y(T,{key:0},[e(V).room.id!==0?(m(),p($,{key:0},{default:t(()=>[o(ee,{border:"",rounded:""},{default:t(()=>[o(ie,{headers:J,items:e(f),loading:e(b)},{loading:t(()=>[o(de,{type:"table-row@10"})]),top:t(()=>[o(me,{flat:""},{default:t(()=>[o(ce,null,{default:t(()=>[o(D,{icon:"ri-chat-smile-ai-3-line",start:""}),e(G)?oe("",!0):(m(),y("span",ke,s(e(l)("tools.announce.title")),1))]),_:1}),o(v,{"prepend-icon":"ri-add-line",color:"success",onClick:L},{default:t(()=>[c(s(e(l)("tools.announce.add")),1)]),_:1}),o(v,{"prepend-icon":"ri-refresh-line",loading:e(b),color:"default",onClick:_},{default:t(()=>[c(s(e(l)("tools.announce.refresh")),1)]),_:1},8,["loading"])]),_:1})]),"item.status":t(({value:n})=>[n?(m(),p(k,{key:0,label:"",color:"success"},{default:t(()=>[c(s(e(l)("tools.announce.form.status.y")),1)]),_:1})):(m(),p(k,{key:1,label:"",color:"error"},{default:t(()=>[c(s(e(l)("tools.announce.form.status.n")),1)]),_:1}))]),"item.interval":t(({value:n})=>[o(k,{label:""},{default:t(()=>[c(s(n),1)]),_:2},1024)]),"item.content":t(({value:n})=>[c(s(e(te)(n,40)),1)]),"item.actions":t(({item:n})=>[o(v,{color:"info","append-icon":"ri-arrow-drop-down-line",variant:"text",loading:e(S)},{default:t(()=>[c(s(e(l)("tools.announce.actions"))+" ",1),o(re,{activator:"parent"},{default:t(()=>[o(ue,null,{default:t(()=>[o(R,{class:"text-info",onClick:P=>L(n,!0)},{prepend:t(()=>[o(D,{icon:"ri-edit-line",size:"22"})]),default:t(()=>[o(B,null,{default:t(()=>[c(s(e(l)("tools.announce.update")),1)]),_:1})]),_:1},8,["onClick"]),o(R,{class:"text-error",onClick:P=>W(n.id)},{prepend:t(()=>[o(D,{icon:"ri-delete-bin-line",size:"22"})]),default:t(()=>[o(B,null,{default:t(()=>[c(s(e(l)("tools.announce.delete")),1)]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["loading"])]),_:1},8,["items","loading"])]),_:1})]),_:1})):(m(),p(u,{key:1,title:e(l)("global.result.title"),"sub-title":e(l)("global.result.subTitle"),type:"error",height:C()},{default:t(()=>[o(v,{to:"/rooms",class:"mt-4"},{default:t(()=>[c(s(e(l)("global.result.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"]))],64)):(m(),y(T,{key:1},[e(z).userInfo.role==="admin"?(m(),p(u,{key:0,title:e(l)("global.noGame.title"),"sub-title":e(l)("global.noGame.subTitle"),height:C(),type:"error"},{default:t(()=>[o(v,{to:"/install",class:"mt-4"},{default:t(()=>[c(s(e(l)("global.noGame.button")),1)]),_:1})]),_:1},8,["title","sub-title","height"])):(m(),p(u,{key:1,title:e(l)("global.noGameNoAdmin.title"),"sub-title":e(l)("global.noGameNoAdmin.subTitle"),height:C(),type:"error"},null,8,["title","sub-title","height"]))],64)),o(ye,{modelValue:e(g),"onUpdate:modelValue":a[4]||(a[4]=n=>ne(g)?g.value=n:null),width:e(G)?"90%":"60%"},{default:t(()=>[o($,null,{default:t(()=>[o(Ve,{ref_key:"announceFormRef",ref:h,class:"ma-4",onSubmit:le(H,["prevent"])},{default:t(()=>[o(fe,null,{default:t(()=>[M("span",null,s(e(l)("tools.announce.title")),1)]),_:1}),o(pe,{class:"my-8"},{default:t(()=>[o(N,{class:"mb-8"},{default:t(()=>[o(ge,{modelValue:e(i).status,"onUpdate:modelValue":a[0]||(a[0]=n=>e(i).status=n),inline:""},{prepend:t(()=>[F((m(),p(k,null,{default:t(()=>[c(s(e(l)("tools.announce.form.status.title")),1)]),_:1})),[[A,e(l)("tools.announce.form.status.tip")]])]),default:t(()=>[o(q,{label:e(l)("tools.announce.form.status.y"),value:!0,class:"mr-4"},null,8,["label"]),o(q,{label:e(l)("tools.announce.form.status.n"),value:!1,class:"mr-4"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),o(N,{class:"mb-8"},{default:t(()=>[F((m(),p(be,{modelValue:e(i).interval,"onUpdate:modelValue":a[1]||(a[1]=n=>e(i).interval=n),label:e(l)("tools.announce.form.interval.title"),min:1,style:{"margin-bottom":"-1.25rem"}},{"append-inner":t(()=>[M("div",we,s(e(l)("tools.announce.form.interval.unit")),1)]),_:1},8,["modelValue","label"])),[[A,e(l)("tools.announce.form.interval.tip")]])]),_:1}),o(N,null,{default:t(()=>[F(o(_e,{modelValue:e(i).content,"onUpdate:modelValue":a[2]||(a[2]=n=>e(i).content=n),label:e(l)("tools.announce.form.content.title"),rules:e(O).content},null,8,["modelValue","label","rules"]),[[A,e(l)("tools.announce.form.content.tip")]])]),_:1})]),_:1}),o(ve,null,{default:t(()=>[o(he),o(v,{color:"default",variant:"elevated",text:e(l)("login.cancel"),class:"mr-4",onClick:a[3]||(a[3]=n=>g.value=!1)},null,8,["text"]),o(v,{text:e(l)("login.submit"),loading:e(x),variant:"elevated",type:"submit"},null,8,["text","loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue","width"])],64)}}};export{lt as default};
