import{m as p}from"./mod-DaUgsV6D.js";import{g as G,b as P,h as n,f as Q,y as k,o as y,w as e,a,k as z,q as t,t as r,l as s,p as F,P as _,Q as b,G as w,a7 as H,E as $,a8 as J,V as K,a9 as O,B as u}from"./index-CBjUexYG.js";import{r as R}from"./room-CKn3OSGJ.js";import{c as W,a as X,V as Y}from"./VCard-Dcae7csx.js";import{V as q}from"./VMenu-uy8W7KRE.js";import{V as B}from"./VList-DnzQkVfF.js";import{V as Z}from"./VTextField-DbONA2f3.js";import{V as ee}from"./VDataTable-C4axgTlY.js";import{V as f}from"./VChip-IzQUOK91.js";import{V as ae}from"./VSkeletonLoader-CU-3KRn_.js";import"./axios-KbiksPFU.js";import"./dialog-transition-D112y9Z-.js";import"./index-Cyt7-BUT.js";import"./ssrBoot-Cy1jdUTU.js";import"./VInput-k_ad5GzK.js";import"./VPagination-BwJ1kUOp.js";import"./VSelect-BBiWe61W.js";import"./VCheckboxBtn-Bs4X0880.js";import"./VSelectionControl-DM_cupWE.js";import"./VTable-DxG2gNbF.js";import"./filter-BwkLsJCB.js";import"./VSlideGroup-BTJY2N2a.js";const le={class:"card-header"},oe={class:"d-flex align-center justify-center fill-height"},Me={__name:"add",setup(de){const m=G(),{t:o}=P(),L=n([]),g=n(!1),D=()=>{const i={roomID:m.room.id};g.value=!0,p.downloaded.get(i).then(d=>{L.value=d.data||[]}).finally(()=>{g.value=!1})},C=n(""),U=[{key:"preview_url",title:o("game.mod.add.preview")},{key:"name",title:o("game.mod.add.name")},{key:"serverSize",title:o("game.mod.add.size")},{key:"id",title:"ID"},{key:"update",title:o("game.mod.add.update")},{key:"actions",title:o("game.mod.add.actions")}],c=n([]),I=(i,d)=>{switch(i){case"enable":N(d);break;case"update":T(d);break;default:u("牛哇","error")}},S=n(!1),N=i=>{S.value=!0;const d={roomID:m.room.id,worldID:0,id:i.id,file_url:i.file_url};p.add.enable.post(d).then(l=>{u(l.message)}).finally(()=>{S.value=!1})},M=n(!1),T=i=>{M.value=!0;const d={roomID:m.room.id,id:i.id,file_url:i.file_url,update:!0};p.download.post(d).then(l=>{u(l.message),D()}).finally(()=>{M.value=!1})},v=n(!1),E=async()=>{let i=!0;v.value=!0,console.log(c.value);for(let d of c.value){const l={roomID:m.room.id,worldID:0,id:d.id,file_url:d.file_url};try{await p.add.enable.post(l)}catch{i=!1,u(`${d.name} ${o("game.mod.add.enableMultiFail")}`,"error")}}i&&(c.value=[],u(o("game.mod.add.enableMultiSuccess"))),v.value=!1},V=n(!1),A=async()=>{V.value=!0;let d=(await R.base.get({id:m.room.id})).data.worldData||[];if(d.length===0){u(o("game.mod.add.preDownloadFail"),"error");return}const l={roomID:m.room.id,worldID:d[0]?.id||0};p.setting.enabledMods.get(l).then(async x=>{for(let h of x.data){const j={roomID:m.room.id,id:h.id,file_url:h.file_url,update:!0};try{const te=await p.download.post(j);u(`${h.name} ${o("game.mod.add.preDownloadSuccess")}`)}catch{u(`${h.name} ${o("game.mod.add.preDownloadFail")}`,"error")}}}).finally(()=>{V.value=!1})};return Q(()=>{D()}),(i,d)=>(y(),k(Y,null,{default:e(()=>[a(W,null,{default:e(()=>[z("div",le,[t(r(s(o)("game.mod.add.tabName"))+" ",1),z("div",null,[a(F,{"append-icon":"ri-arrow-drop-down-line",loading:V.value||v.value,color:"primary"},{default:e(()=>[t(r(s(o)("game.mod.add.headerMenuButton"))+" ",1),a(q,{activator:"parent"},{default:e(()=>[a(B,null,{default:e(()=>[a(_,{disabled:V.value,class:"text-info",onClick:A},{prepend:e(()=>[a(w,{icon:"ri-download-2-line",size:"22"})]),default:e(()=>[a(b,null,{default:e(()=>[t(r(s(o)("game.mod.add.preDownload")),1)]),_:1})]),_:1},8,["disabled"]),a(_,{disabled:c.value.length===0||v.value,class:"text-success",onClick:E},{prepend:e(()=>[a(w,{icon:"ri-list-check-3",size:"22"})]),default:e(()=>[a(b,null,{default:e(()=>[t(r(s(o)("game.mod.add.enableMulti")),1)]),_:1})]),_:1},8,["disabled"]),a(_,{disabled:v.value,class:"text-warning",onClick:d[0]||(d[0]=l=>I("enable",{id:0,file_url:""}))},{prepend:e(()=>[a(w,{icon:"ri-add-line",size:"22"})]),default:e(()=>[a(b,null,{default:e(()=>[t(r(s(o)("game.mod.add.addClientModsDisabled")),1)]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["loading"])])])]),_:1}),a(X,{class:"mt-4"},{default:e(()=>[a(Z,{modelValue:C.value,"onUpdate:modelValue":d[1]||(d[1]=l=>C.value=l),loading:g.value,label:s(o)("game.mod.add.search"),variant:"outlined","hide-details":"","single-line":""},{append:e(()=>[a(F,{loading:g.value,"prepend-icon":"ri-refresh-line",color:"default",variant:"elevated",size:"large",onClick:D},{default:e(()=>[t(r(s(o)("game.mod.add.refresh")),1)]),_:1},8,["loading"])]),_:1},8,["modelValue","loading","label"]),a(H,{border:"",rounded:"",class:"mt-4"},{default:e(()=>[a(ee,{modelValue:c.value,"onUpdate:modelValue":d[2]||(d[2]=l=>c.value=l),"show-select":"","return-object":"",headers:U,items:L.value,search:C.value,loading:g.value},{loading:e(()=>[a(ae,{type:"table-row@10"})]),"item.preview_url":e(({value:l})=>[a(K,{src:l,width:100,cover:"",rounded:"","aspect-ratio":"1",class:"ma-2"},{placeholder:e(()=>[z("div",oe,[a(O,{color:"grey-lighten-4",indeterminate:""})])]),_:1},8,["src"])]),"item.name":e(({value:l})=>[a(f,{label:"",color:"info"},{default:e(()=>[t(r(l),1)]),_:2},1024)]),"item.serverSize":e(({value:l})=>[a(f,{label:"",color:"primary"},{default:e(()=>[t(r(s(J)(parseInt(l))),1)]),_:2},1024)]),"item.id":e(({value:l})=>[a(f,{label:""},{default:e(()=>[t(r(l),1)]),_:2},1024)]),"item.update":e(({item:l})=>[l.file_url!==""?(y(),k(f,{key:0,label:""},{default:e(()=>[t(r(s(o)("game.mod.add.notUGC")),1)]),_:1})):$("",!0),l.file_url===""&&l.serverSize===l.localSize?(y(),k(f,{key:1,label:"",color:"success"},{default:e(()=>[t(r(s(o)("game.mod.add.needNoUpdate")),1)]),_:1})):$("",!0),l.file_url===""&&l.serverSize!==l.localSize?(y(),k(f,{key:2,label:"",color:"error"},{default:e(()=>[t(r(s(o)("game.mod.add.needUpdate")),1)]),_:1})):$("",!0)]),"item.actions":e(({item:l})=>[a(F,{color:"info","append-icon":"ri-arrow-drop-down-line",variant:"text"},{default:e(()=>[t(r(s(o)("game.mod.add.actions"))+" ",1),a(q,{activator:"parent"},{default:e(()=>[a(B,null,{default:e(()=>[a(_,{disabled:S.value,class:"text-success",onClick:x=>I("enable",l)},{prepend:e(()=>[a(w,{icon:"ri-file-check-line",size:"22"})]),default:e(()=>[a(b,null,{default:e(()=>[t(r(s(o)("game.mod.add.enable")),1)]),_:1})]),_:1},8,["disabled","onClick"]),a(_,{disabled:M.value,class:"text-info",onClick:x=>I("update",l)},{prepend:e(()=>[a(w,{icon:"ri-arrow-up-circle-line",size:"22"})]),default:e(()=>[a(b,null,{default:e(()=>[t(r(s(o)("game.mod.add.updateMod")),1)]),_:1})]),_:1},8,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","items","search","loading"])]),_:1})]),_:1})]),_:1}))}};export{Me as default};
