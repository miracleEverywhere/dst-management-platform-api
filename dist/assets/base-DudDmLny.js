import{r as j,_ as fe}from"./room-LC7nfLFJ.js";import{I as J,J as R,a0 as ge,K as M,k as $,a as l,s as G,aj as ee,ak as be,R as te,al as he,j as y,z as Se,am as we,O as N,A as ye,L as ke,an as Ve,ag as P,ao as De,ap as _e,C as Y,aq as Ie,ar as xe,e as ue,as as Ce,at as ae,au as Pe,F as Re,av as Be,aw as Te,ax as Ee,f as We,h as v,ay as Ae,az as Ne,d as ze,g as Oe,u as $e,b as Le,y as S,l as a,o as w,w as u,x as le,H as oe,v as Q,t as X,D as ne}from"./index-Bnu2ge-9.js";import Fe from"./room-rPCsL1IH.js";import He from"./world-D8kU-ar4.js";import Ge from"./mod-KBCSTLeX.js";import Je from"./roomSetting-B8-NHFii.js";import{V as H}from"./VDivider-BK7OigPp.js";import{V as ie,m as Me,a as re,b as je}from"./VTabs-9M10Wv2D.js";import{V as U}from"./VContainer-DbJZthkO.js";import{V as se,m as Ue}from"./VSheet-CySGE6mX.js";import"./axios-DlN8jXrA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VRow-CvuV0OT5.js";/* empty css              */import"./VTextField-rNVqoHjK.js";import"./index-DAgEKh0P.js";import"./VInput-dFZ5Mk8T.js";import"./index-C1_EnFUq.js";import"./VTooltip-BzghMA6y.js";import"./VRadioGroup-BqpsvxAr.js";import"./VSelectionControl-B8AU1ljJ.js";import"./VChip-Bc5rzJEM.js";import"./VSlideGroup-CBurGPdq.js";import"./VNumberInput-jo-9XGDG.js";import"./VForm-ChNC49Iq.js";import"./CodeEditor-D6k283Pz.js";import"./levelDataSetting-BZStVpNF.js";import"./VMenu-D6Lx_LmM.js";import"./dialog-transition-DxoZoDaa.js";import"./VList-CwGfKth6.js";import"./ssrBoot-CdbDOlRW.js";import"./VSpacer-DjNluZPW.js";const Z=Symbol.for("vuetify:v-stepper"),ce=R({color:String,disabled:{type:[Boolean,String],default:!1},prevText:{type:String,default:"$vuetify.stepper.prev"},nextText:{type:String,default:"$vuetify.stepper.next"}},"VStepperActions"),de=J()({name:"VStepperActions",props:ce(),emits:{"click:prev":()=>!0,"click:next":()=>!0},setup(e,f){let{emit:n,slots:i}=f;const{t:d}=ge();function s(){n("click:prev")}function m(){n("click:next")}return M(()=>{const g={onClick:s},b={onClick:m};return $("div",{class:"v-stepper-actions"},[l(ee,{defaults:{VBtn:{disabled:["prev",!0].includes(e.disabled),text:d(e.prevText),variant:"text"}}},{default:()=>[i.prev?.({props:g})??l(G,g,null)]}),l(ee,{defaults:{VBtn:{color:e.color,disabled:["next",!0].includes(e.disabled),text:d(e.nextText),variant:"tonal"}}},{default:()=>[i.next?.({props:b})??l(G,b,null)]})])}),{}}}),me=be("v-stepper-header"),qe=R({color:String,title:String,subtitle:String,complete:Boolean,completeIcon:{type:P,default:"$complete"},editable:Boolean,editIcon:{type:P,default:"$edit"},error:Boolean,errorIcon:{type:P,default:"$error"},icon:P,ripple:{type:[Boolean,Object],default:!0},rules:{type:Array,default:()=>[]}},"StepperItem"),Ke=R({...qe(),...Ve()},"VStepperItem"),z=J()({name:"VStepperItem",directives:{vRipple:te},props:Ke(),emits:{"group:selected":e=>!0},setup(e,f){let{slots:n}=f;const i=he(e,Z,!0),d=y(()=>i?.value.value??e.value),s=y(()=>e.rules.every(p=>p()===!0)),m=y(()=>!e.disabled&&e.editable),g=y(()=>!e.disabled&&e.editable),b=y(()=>e.error||!s.value),D=y(()=>e.complete||e.rules.length>0&&s.value),B=y(()=>b.value?e.errorIcon:D.value?e.completeIcon:i.isSelected.value&&e.editable?e.editIcon:e.icon),o=y(()=>({canEdit:g.value,hasError:b.value,hasCompleted:D.value,title:e.title,subtitle:e.subtitle,step:d.value,value:e.value}));return M(()=>{const p=(!i||i.isSelected.value||D.value||g.value)&&!b.value&&!e.disabled,L=!!(e.title!=null||n.title),T=!!(e.subtitle!=null||n.subtitle);function _(){i?.toggle()}return Se($("button",{class:ke(["v-stepper-item",{"v-stepper-item--complete":D.value,"v-stepper-item--disabled":e.disabled,"v-stepper-item--error":b.value},i?.selectedClass.value]),disabled:!e.editable,type:"button",onClick:_},[m.value&&we(!0,"v-stepper-item"),l(ye,{key:"stepper-avatar",class:"v-stepper-item__avatar",color:p?e.color:void 0,size:24},{default:()=>[n.icon?.(o.value)??(B.value?l(N,{icon:B.value},null):d.value)]}),$("div",{class:"v-stepper-item__content"},[L&&$("div",{key:"title",class:"v-stepper-item__title"},[n.title?.(o.value)??e.title]),T&&$("div",{key:"subtitle",class:"v-stepper-item__subtitle"},[n.subtitle?.(o.value)??e.subtitle]),n.default?.(o.value)])]),[[te,e.editable&&e.ripple,null]])}),{}}}),Qe=R({...Ie(Me(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VStepperWindow"),pe=J()({name:"VStepperWindow",props:Qe(),emits:{"update:modelValue":e=>!0},setup(e,f){let{slots:n}=f;const i=De(Z,null),d=_e(e,"modelValue"),s=y({get(){return d.value!=null||!i?d.value:i.items.value.find(m=>i.selected.value.includes(m.id))?.value},set(m){d.value=m}});return M(()=>{const m=ie.filterProps(e);return l(ie,Y({_as:"VStepperWindow"},m,{modelValue:s.value,"onUpdate:modelValue":g=>s.value=g,class:["v-stepper-window",e.class],style:e.style,mandatory:!1,touch:!1}),n)}),{}}}),Xe=R({...je()},"VStepperWindowItem"),O=J()({name:"VStepperWindowItem",props:Xe(),setup(e,f){let{slots:n}=f;return M(()=>{const i=re.filterProps(e);return l(re,Y({_as:"VStepperWindowItem"},i,{class:["v-stepper-window-item",e.class],style:e.style}),n)}),{}}}),Ye=R({altLabels:Boolean,bgColor:String,completeIcon:P,editIcon:P,editable:Boolean,errorIcon:P,hideActions:Boolean,items:{type:Array,default:()=>[]},itemTitle:{type:String,default:"title"},itemValue:{type:String,default:"value"},nonLinear:Boolean,flat:Boolean,...Ee()},"Stepper"),Ze=R({...Ye(),...Te({mandatory:"force",selectedClass:"v-stepper-item--selected"}),...Ue(),...Be(ce(),["prevText","nextText"])},"VStepper"),et=J()({name:"VStepper",props:Ze(),emits:{"update:modelValue":e=>!0},setup(e,f){let{slots:n}=f;const{items:i,next:d,prev:s,selected:m}=xe(e,Z),{displayClasses:g,mobile:b}=ue(e),{completeIcon:D,editIcon:B,errorIcon:o,color:p,editable:L,prevText:T,nextText:_}=Ce(e),V=y(()=>e.items.map((h,k)=>{const I=ae(h,e.itemTitle,h),c=ae(h,e.itemValue,k+1);return{title:I,value:c,raw:h}})),E=y(()=>i.value.findIndex(h=>m.value.includes(h.id))),C=y(()=>e.disabled?e.disabled:E.value===0?"prev":E.value===i.value.length-1?"next":!1);return Pe({VStepperItem:{editable:L,errorIcon:o,completeIcon:D,editIcon:B,prevText:T,nextText:_},VStepperActions:{color:p,disabled:C,prevText:T,nextText:_}}),M(()=>{const h=se.filterProps(e),k=!!(n.header||e.items.length),I=e.items.length>0,c=!e.hideActions&&!!(I||n.actions);return l(se,Y(h,{color:e.bgColor,class:["v-stepper",{"v-stepper--alt-labels":e.altLabels,"v-stepper--flat":e.flat,"v-stepper--non-linear":e.nonLinear,"v-stepper--mobile":b.value},g.value,e.class],style:e.style}),{default:()=>[k&&l(me,{key:"stepper-header"},{default:()=>[V.value.map((x,q)=>{let{raw:W,...F}=x;return $(Re,null,[!!q&&l(H,null,null),l(z,F,{default:n[`header-item.${F.value}`]??n.header,icon:n.icon,title:n.title,subtitle:n.subtitle})])})]}),I&&l(pe,{key:"stepper-window"},{default:()=>[V.value.map(x=>l(O,{value:x.value},{default:()=>n[`item.${x.value}`]?.(x)??n.item?.(x)}))]}),n.default?.({prev:s,next:d}),c&&(n.actions?.({next:d,prev:s})??l(de,{key:"stepper-actions","onClick:prev":s,"onClick:next":d},n))]})}),{prev:s,next:d}}}),Et={__name:"base",setup(e){We(async()=>{await Promise.all([B(),D()]),m.value=!0,window.addEventListener("resize",f)});const f=Ae(()=>{n.value=window.innerHeight},200);Ne(()=>{window.removeEventListener("resize",f)});const n=v(window.innerHeight);ze();const i=Oe();ue();const d=$e(),{t:s}=Le(),m=v(!1),g=v(0),b=v(0),D=async()=>{if(i.room.id!==0){const t=await j.base.get({id:i.room.id});V.value=t.data.roomData,C.value=t.data.worldData,q(t.data.roomSettingData)}},B=async()=>{const t=await j.factor.get();g.value=t.data.roomCount,b.value=t.data.worldCount},o=v(0),p=()=>Math.max(2,Math.floor(n.value-304)),L=()=>{o.value--},T=async()=>{if(o.value===0&&_.value){const t=await _.value.validate();if(t.validate){V.value=t.formData,o.value++;return}}if(o.value===1&&E.value){const t=await E.value.validate();if(t.validate){C.value=t.formData,o.value++;return}}if(o.value===2&&h.value){const t=await h.value.validate();if(t.validate){k.value=t.formData,o.value++;return}}if(o.value===3&&I.value){const t=await I.value.validate();if(t.validate){c.value=t.formData,o.value++;return}}},_=v(),V=v({}),E=v(),C=v([]),h=v(),k=v(),I=v(),c=v({}),x=()=>({roomID:0,backupEnable:c.value.backup.enable,backupSetting:JSON.stringify(c.value.backup.setting),backupCleanEnable:c.value.backupClean.enable,backupCleanSetting:c.value.backupClean.setting,restartEnable:c.value.restart.enable,restartSetting:c.value.restart.setting,keepaliveEnable:c.value.keepalive.enable,keepaliveSetting:c.value.keepalive.setting,scheduledStartStopEnable:c.value.scheduledStartStop.enable,scheduledStartStopSetting:JSON.stringify(c.value.scheduledStartStop.setting),tickRate:c.value.tickRate,bit64:c.value.bit64}),q=t=>{c.value={backup:{enable:t.backupEnable,setting:JSON.parse(t.backupSetting)},backupClean:{enable:t.backupCleanEnable,setting:t.backupCleanSetting},restart:{enable:t.restartEnable,setting:t.restartSetting},keepalive:{enable:t.keepaliveEnable,setting:t.keepaliveSetting},scheduledStartStop:{enable:t.scheduledStartStopEnable,setting:JSON.parse(t.scheduledStartStopSetting)},tickRate:t.tickRate,bit64:t.bit64}},W=v(!1),F=()=>{d.push("/rooms").then(()=>{d.back()})},ve=()=>{const t={roomData:V.value,worldData:C.value,roomSettingData:x()};if(i.room.id){for(let r=0;r<t.worldData.length;r++)k.value.modInOne?(t.roomData.modInOne=!0,t.roomData.modData=k.value.modData):t.worldData[r].modData=k.value.worlds[r].modData,t.worldData[r].roomID=i.room.id,delete t.worldData[r].name,delete t.worldData[r].id;t.roomSettingData.roomID=i.room.id,W.value=!0,j.base.put(t).then(r=>{ne(r.message),i.room={id:r.data.id,gameName:r.data.gameName},F()}).finally(()=>{W.value=!1})}else{for(let r=0;r<t.worldData.length;r++)k.value.modInOne?(t.roomData.modInOne=!0,t.roomData.modData=k.value.modData):t.worldData[r].modData=k.value.worlds[r].modData,t.worldData[r].id=0,delete t.worldData[r].name;W.value=!0,j.base.post(t).then(r=>{ne(r.message),i.room={id:r.data.id,gameName:r.data.gameName},F()}).finally(()=>{W.value=!1})}};return(t,r)=>{const A=fe;return a(i).room.name===""?(w(),S(A,{key:0,type:"error",title:a(s)("global.result.title"),"sub-title":a(s)("global.result.subTitle"),height:a(n)},null,8,["title","sub-title","height"])):(w(),S(et,{key:1,modelValue:a(o),"onUpdate:modelValue":r[1]||(r[1]=K=>le(o)?o.value=K:null)},{default:u(()=>[l(me,null,{default:u(()=>[l(z,{color:a(o)>0?"success":"",complete:a(o)>0,value:0,title:"房间设置"},{icon:u(()=>[l(N,{icon:"ri-number-1",size:"12"})]),_:1},8,["color","complete"]),l(H),l(z,{color:a(o)>1?"success":"",complete:a(o)>1,value:1,title:"世界设置"},{icon:u(()=>[l(N,{icon:"ri-number-2",size:"12"})]),_:1},8,["color","complete"]),l(H),l(z,{color:a(o)>2?"success":"",complete:a(o)>2,value:2,title:"模组设置"},{icon:u(()=>[l(N,{icon:"ri-number-3",size:"12"})]),_:1},8,["color","complete"]),l(H),l(z,{color:a(o)>3?"success":"",complete:a(o)>3,value:3,title:"系统设置"},{icon:u(()=>[l(N,{icon:"ri-number-4",size:"12"})]),_:1},8,["color","complete"]),l(H),l(z,{color:a(o)>4?"success":"",complete:a(o)>4,value:4,title:"设置完成"},{icon:u(()=>[l(N,{icon:"ri-number-5",size:"12"})]),_:1},8,["color","complete"])]),_:1}),l(pe,{modelValue:a(o),"onUpdate:modelValue":r[0]||(r[0]=K=>le(o)?o.value=K:null),class:"mt-4"},{default:u(()=>[l(O,{value:0},{default:u(()=>[a(m)?(w(),S(U,{key:0,height:p(),style:{"overflow-y":"auto"}},{default:u(()=>[l(Fe,{ref_key:"roomRef",ref:_,"room-count":a(g),"form-data":a(V)},null,8,["room-count","form-data"])]),_:1},8,["height"])):(w(),S(A,{key:1,type:"info",title:a(s)("game.base.loading"),height:p()},null,8,["title","height"]))]),_:1}),l(O,{value:1},{default:u(()=>[a(m)?(w(),S(U,{key:0,height:p(),style:{"overflow-y":"auto"}},{default:u(()=>[l(He,{ref_key:"worldRef",ref:E,"world-count":a(b),"form-data":a(C),"game-mode":a(V).gameMode,theme:a(i).theme,"tab-window-height":p()-300},null,8,["world-count","form-data","game-mode","theme","tab-window-height"])]),_:1},8,["height"])):(w(),S(A,{key:1,type:"info",title:a(s)("game.base.loading"),height:p()},null,8,["title","height"]))]),_:1}),l(O,{value:2},{default:u(()=>[a(m)?(w(),S(U,{key:0,height:p(),style:{"overflow-y":"auto"}},{default:u(()=>[l(Ge,{ref_key:"modRef",ref:h,worlds:a(C),mod:a(V).modData,"mod-in-one":a(V).modInOne,theme:a(i).theme,"tab-window-height":p()-110},null,8,["worlds","mod","mod-in-one","theme","tab-window-height"])]),_:1},8,["height"])):(w(),S(A,{key:1,type:"info",title:a(s)("game.base.loading"),height:p()},null,8,["title","height"]))]),_:1}),l(O,{value:3},{default:u(()=>[a(m)?(w(),S(U,{key:0,height:p(),style:{"overflow-y":"auto"}},{default:u(()=>[l(Je,{ref_key:"roomSettingRef",ref:I},null,512)]),_:1},8,["height"])):(w(),S(A,{key:1,type:"info",title:a(s)("game.base.loading"),height:p()},null,8,["title","height"]))]),_:1}),l(O,{value:4},{default:u(()=>[l(A,{type:"success",height:p(),title:a(s)("game.base.step5.title"),"sub-title":a(s)("game.base.step5.subTitle")},null,8,["height","title","sub-title"])]),_:1})]),_:1},8,["modelValue"]),l(de,{class:"mx-8"},{prev:u(()=>[l(G,{disabled:a(o)===0,color:"grey-lighten-3",variant:"elevated",onClick:L},{default:u(()=>[Q(X(a(s)("game.prev")),1)]),_:1},8,["disabled"])]),next:u(()=>[a(o)!==4?(w(),S(G,{key:0,color:"primary",variant:"elevated",onClick:T},{default:u(()=>[Q(X(a(s)("game.next.button")),1)]),_:1})):oe("",!0),a(o)===4?(w(),S(G,{key:1,color:"success",disabled:!1,loading:a(W),variant:"elevated",onClick:ve},{default:u(()=>[Q(X(a(s)("game.next.save")),1)]),_:1},8,["loading"])):oe("",!0)]),_:1})]),_:1},8,["modelValue"]))}}};export{Et as default};
