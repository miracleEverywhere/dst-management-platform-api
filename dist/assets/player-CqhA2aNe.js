import{u as Pe,a as Be,g as Re,G as Ke,H as Te,d as Se,I as qe,c as _e,o as Me,a2 as I,B as N,r as g,w as je,J as le,K as p,L as Ee,f as u,i as b,k as a,l as e,j as n,m,q as d,t as i,n as c,F as ae,y as ne,x as se,a9 as He,p as ye,a8 as We,a1 as Ge,D as W}from"./index-5FXYdO3K.js";const Je={class:"page-div"},Oe={class:"card-header"},Qe={key:0},Xe={key:1},Ye={class:"card-header"},Ze={key:0},et={style:{"margin-top":"20px"}},tt={class:"card-header"},lt={key:0},at={style:{"margin-top":"20px"}},nt={class:"card-header"},st={key:0},ot={style:{"margin-top":"20px"}},it={class:"card-header"},dt={class:"fcc"},ut={class:"el-upload__text"},rt={class:"el-upload__tip"},ft={style:{display:"flex","justify-content":"flex-end","padding-top":"10px"}},pt=Ge({name:"settingsPlayer"}),gt=Object.assign(pt,{setup(ct){const{t:s}=Pe(),{isMobile:he}=Be(),k=Re(),T=Ke();Te();const oe=Se(),ie=qe("refresh"),D=_e(()=>k.isDark),y=_e(()=>k.language);Me(()=>{x()});const x=(o=!1)=>{I.player.list.get({clusterName:k.selectedDstCluster}).then(t=>{var r,f,_;if(G.value=t.data.players,J.value=t.data.uidMap,F.value=[],(((r=t.data.adminList)==null?void 0:r.length)||0)>0)for(let v of t.data.adminList)v!==""&&F.value.push(v);if(A.value=[],(((f=t.data.blockList)==null?void 0:f.length)||0)>0)for(let v of t.data.blockList)v!==""&&A.value.push(v);if(P.value=[],(((_=t.data.whiteList)==null?void 0:_.length)||0)>0)for(let v of t.data.whiteList)v!==""&&P.value.push(v);if(o){let v;y.value==="zh"?v="刷新成功":v="Refresh Success",N(v)}})},U=g("players"),G=g([]),J=g({}),F=g([]),A=g([]),P=g([]),S=o=>{for(let t of F.value)if(t===o)return!0},de=o=>{for(let t of A.value)if(t===o)return!0},ue=o=>{for(let t of P.value)if(t===o)return!0},re=o=>{switch(o.type){case"admin":w(o.type,"add",o.uid);break;case"block":w(o.type,"add",o.uid);break;case"white":w(o.type,"add",o.uid);break;case"kick":be(o.uid);break}},w=(o,t,r)=>{const f={clusterName:k.selectedDstCluster,listName:o,type:t,uid:r};I.player.change.post(f).then(_=>{N(_.message),x()})},be=o=>{const t={clusterName:k.selectedDstCluster,uid:o};I.player.kick.post(t).then(r=>{N(r.message)})},O=o=>o in J.value?" ["+J.value[o]+"]":y.value==="zh"?" [暂未获取到]":" [Not yet obtained]",ke=(o,t)=>{o.paneName==="history"&&Y()},Q=g([]),X=g(!1),Y=(o=!1)=>{X.value=!0,Q.value=[];const t={clusterName:k.selectedDstCluster};I.player.history.get(t).then(r=>{for(let f of r.data)f.uid.length===11&&Q.value.push(f);if(o){let f;y.value==="zh"?f="刷新成功":f="Refresh Success",N(f)}}).finally(()=>{X.value=!1})},Z=g(),q=g(!1),L=g(!1),we=()=>{Z.value&&Z.value.clearFiles(),q.value=!0,L.value=!1},Ce=o=>/\.xls|xlsx$/i.test(o.name)?!0:(W(y.value==="zh"?"请上传Excel文件":"Please upload a Excel file"),!1),xe=o=>{L.value=!0;const t=new FormData;t.append("file",o.file),I.player.addBlockUpload.post(t).then(r=>{x(),N(r.message)}).finally(()=>{q.value=!1,L.value=!1})},Le=()=>{setTimeout(()=>{T.meta.isKeepAlive&&oe.removeKeepAliveName(T.name),ie(!1),le(()=>{T.meta.isKeepAlive&&oe.addKeepAliveName(T.name),ie(!0)})},0)},B=g(!1),M=g(),h=g(""),ee=()=>{B.value=!0,le(()=>{M.value.input.focus()})},z=o=>{h.value&&w(o,"add",h.value),B.value=!1,h.value=""},V=g(!1),$=g(""),De=async()=>{let o="";if(U.value==="adminList"&&(o="admin"),U.value==="blockList"&&(o="block"),U.value==="whiteList"&&(o="white"),o===""){W(y.value==="zh"?"非法请求":"Invalid Request");return}if($.value===""){W(y.value==="zh"?"请输入玩家UID":"Please enter the player UID");return}if(!/^KU_/.test($.value)){W(y.value==="zh"?"请输入正确的玩家UID":"Please enter the correct player UID");return}await w(o,"add",$.value),$.value="",V.value=!1},ze=()=>{const o={clusterName:k.selectedDstCluster};I.player.historyClean.post(o).then(t=>{N(t.message)}).finally(()=>{Y(!1)})};return je(()=>k.selectedDstCluster,o=>{o&&le(()=>{Le()})},{immediate:!1}),(o,t)=>{const r=p("el-button"),f=p("el-table-column"),_=p("el-tag"),v=p("arrow-down"),j=p("el-icon"),C=p("el-dropdown-item"),fe=p("el-dropdown-menu"),pe=p("el-dropdown"),ce=p("el-table"),E=p("el-result"),R=p("el-card"),K=p("el-tab-pane"),te=p("el-alert"),H=p("el-input"),Ve=p("el-tooltip"),$e=p("el-tabs"),Ie=p("el-col"),Ne=p("el-row"),Ue=p("el-upload"),me=p("el-dialog"),Fe=p("el-form-item"),Ae=p("el-form"),ge=Ee("loading");return u(),b("div",Je,[a(Ne,{gutter:10},{default:e(()=>[a(Ie,{lg:24,md:24,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:e(()=>[a($e,{modelValue:U.value,"onUpdate:modelValue":t[17]||(t[17]=l=>U.value=l),onTabClick:ke},{default:e(()=>[a(K,{label:n(s)("setting.players"),name:"players"},{default:e(()=>[a(R,{style:{height:"78vh"},shadow:"never"},{header:e(()=>[m("div",Oe,[d(i(n(s)("setting.players"))+" ",1),m("div",null,[a(r,{size:"default",onClick:t[0]||(t[0]=l=>x(!0))},{default:e(()=>[d(i(n(s)("setting.refresh")),1)]),_:1})])])]),default:e(()=>[G.value?(u(),c(ce,{key:0,data:G.value,border:"",size:"small",style:{width:"100%"}},{default:e(()=>[a(f,{label:n(s)("setting.nickName"),prop:"nickName"},null,8,["label"]),a(f,{label:n(s)("setting.role"),prop:"prefab"},{default:e(l=>[l.row.prefab===""?(u(),b("span",Qe,i(n(s)("setting.roleFail")),1)):(u(),b("span",Xe,i(l.row.prefab),1))]),_:1},8,["label"]),a(f,{label:n(s)("setting.age"),prop:"age"},{default:e(l=>[l.row.age?(u(),c(_,{key:0,type:"success"},{default:e(()=>[d(i(l.row.age),1)]),_:2},1024)):(u(),c(_,{key:1,type:"warning"},{default:e(()=>[d(i(n(s)("setting.roleFail")),1)]),_:1}))]),_:1},8,["label"]),a(f,{label:"UID",prop:"uid"}),a(f,{label:n(s)("setting.button.actions"),prop:"actions"},{default:e(l=>[a(pe,{trigger:"hover",onCommand:re},{dropdown:e(()=>[a(fe,null,{default:e(()=>[a(C,{command:{type:"admin",uid:l.row.uid},disabled:S(l.row.uid)},{default:e(()=>[d(i(n(s)("setting.addAdmin")),1)]),_:2},1032,["command","disabled"]),a(C,{command:{type:"block",uid:l.row.uid},disabled:de(l.row.uid)},{default:e(()=>[d(i(n(s)("setting.addBlock")),1)]),_:2},1032,["command","disabled"]),a(C,{command:{type:"white",uid:l.row.uid},disabled:ue(l.row.uid)},{default:e(()=>[d(i(n(s)("setting.addWhite")),1)]),_:2},1032,["command","disabled"]),a(C,{command:{type:"kick",uid:l.row.uid},disabled:S(l.row.uid),divided:""},{default:e(()=>[d(i(n(s)("setting.kick")),1)]),_:2},1032,["command","disabled"])]),_:2},1024)]),default:e(()=>[a(r,{link:"",type:"primary"},{default:e(()=>[d(i(n(s)("setting.button.actions"))+" ",1),a(j,{class:"el-icon--right"},{default:e(()=>[a(v)]),_:1})]),_:1})]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])):(u(),c(E,{key:1,title:n(s)("setting.noPlayersFound"),icon:"warning",style:{"margin-top":"10%"}},null,8,["title"]))]),_:1})]),_:1},8,["label"]),a(K,{label:n(s)("setting.adminList"),name:"adminList"},{default:e(()=>[a(R,{style:{height:"78vh"},shadow:"never"},{header:e(()=>[m("div",Ye,[d(i(n(s)("setting.adminList"))+" ",1),m("div",null,[a(r,{size:"default",type:"primary",onClick:t[1]||(t[1]=l=>V.value=!0)},{default:e(()=>[d(i(n(s)("setting.manualAdd")),1)]),_:1}),a(r,{size:"default",onClick:t[2]||(t[2]=l=>x(!0))},{default:e(()=>[d(i(n(s)("setting.refresh")),1)]),_:1})])])]),default:e(()=>[F.value.length>0?(u(),b("div",Ze,[a(te,{closable:!1,effect:D.value?"light":"dark",type:"success"},{default:e(()=>[d(i(n(s)("setting.tagCloseTip")),1)]),_:1},8,["effect"]),m("div",et,[(u(!0),b(ae,null,ne(F.value,l=>(u(),c(_,{effect:D.value?"light":"dark",closable:"",size:"large",style:{"margin-right":"5px","margin-top":"5px"},onClose:ve=>w("admin","delete",l)},{default:e(()=>[d(i(l+O(l)),1)]),_:2},1032,["effect","onClose"]))),256)),B.value?(u(),c(H,{key:0,ref_key:"InputRef",ref:M,modelValue:h.value,"onUpdate:modelValue":t[3]||(t[3]=l=>h.value=l),size:"default",class:"w-32",style:{margin:"5px 5px 0 0"},onKeyup:t[4]||(t[4]=se(l=>z("admin"),["enter"])),onBlur:t[5]||(t[5]=l=>z("admin"))},null,8,["modelValue"])):(u(),c(r,{key:1,onClick:ee,style:{margin:"5px 5px 0 0"}},{default:e(()=>[d(i(y.value==="zh"?"+ 新增":"+ New"),1)]),_:1}))])])):(u(),c(E,{key:1,title:n(s)("setting.noAdminFound"),icon:"warning",style:{"margin-top":"10%"}},null,8,["title"]))]),_:1})]),_:1},8,["label"]),a(K,{label:n(s)("setting.blockList"),name:"blockList"},{default:e(()=>[a(R,{style:{height:"78vh"},shadow:"never"},{header:e(()=>[m("div",tt,[d(i(n(s)("setting.blockList"))+" ",1),m("div",null,[a(r,{size:"default",type:"primary",onClick:t[6]||(t[6]=l=>V.value=!0)},{default:e(()=>[d(i(n(s)("setting.manualAdd")),1)]),_:1}),a(r,{type:"success",onClick:we},{default:e(()=>[d(i(n(s)("setting.blockListItems.uploadButton")),1)]),_:1}),a(r,{size:"default",onClick:t[7]||(t[7]=l=>x(!0))},{default:e(()=>[d(i(n(s)("setting.refresh")),1)]),_:1})])])]),default:e(()=>[A.value.length>0?(u(),b("div",lt,[a(te,{closable:!1,effect:D.value?"light":"dark",type:"success"},{default:e(()=>[d(i(n(s)("setting.tagCloseTip")),1)]),_:1},8,["effect"]),m("div",at,[(u(!0),b(ae,null,ne(A.value,l=>(u(),c(_,{effect:D.value?"light":"dark",closable:"",size:"large",style:{"margin-right":"5px","margin-top":"5px"},onClose:ve=>w("block","delete",l)},{default:e(()=>[d(i(l+O(l)),1)]),_:2},1032,["effect","onClose"]))),256)),B.value?(u(),c(H,{key:0,ref_key:"InputRef",ref:M,modelValue:h.value,"onUpdate:modelValue":t[8]||(t[8]=l=>h.value=l),size:"default",class:"w-32",style:{margin:"5px 5px 0 0"},onKeyup:t[9]||(t[9]=se(l=>z("block"),["enter"])),onBlur:t[10]||(t[10]=l=>z("block"))},null,8,["modelValue"])):(u(),c(r,{key:1,onClick:ee,style:{margin:"5px 5px 0 0"}},{default:e(()=>[d(i(y.value==="zh"?"+ 新增":"+ New"),1)]),_:1}))])])):(u(),c(E,{key:1,title:o.$t("setting.noBlockFound"),icon:"warning",style:{"margin-top":"10%"}},null,8,["title"]))]),_:1})]),_:1},8,["label"]),a(K,{label:n(s)("setting.whiteList"),name:"whiteList"},{default:e(()=>[a(R,{style:{height:"78vh"},shadow:"never"},{header:e(()=>[m("div",nt,[d(i(n(s)("setting.whiteList"))+" ",1),m("div",null,[a(r,{size:"default",type:"primary",onClick:t[11]||(t[11]=l=>V.value=!0)},{default:e(()=>[d(i(n(s)("setting.manualAdd")),1)]),_:1}),a(r,{size:"default",onClick:t[12]||(t[12]=l=>x(!0))},{default:e(()=>[d(i(n(s)("setting.refresh")),1)]),_:1})])])]),default:e(()=>[P.value.length>0?(u(),b("div",st,[a(te,{closable:!1,effect:D.value?"light":"dark",type:"success"},{default:e(()=>[d(i(n(s)("setting.tagCloseTip")),1)]),_:1},8,["effect"]),m("div",ot,[(u(!0),b(ae,null,ne(P.value,l=>(u(),c(_,{effect:D.value?"light":"dark",closable:"",size:"large",style:{"margin-right":"5px","margin-top":"5px"},onClose:ve=>w("white","delete",l)},{default:e(()=>[d(i(l+O(l)),1)]),_:2},1032,["effect","onClose"]))),256)),B.value?(u(),c(H,{key:0,ref_key:"InputRef",ref:M,modelValue:h.value,"onUpdate:modelValue":t[13]||(t[13]=l=>h.value=l),size:"default",class:"w-32",style:{margin:"5px 5px 0 0"},onKeyup:t[14]||(t[14]=se(l=>z("white"),["enter"])),onBlur:t[15]||(t[15]=l=>z("white"))},null,8,["modelValue"])):(u(),c(r,{key:1,onClick:ee,style:{margin:"5px 5px 0 0"}},{default:e(()=>[d(i(y.value==="zh"?"+ 新增":"+ New"),1)]),_:1}))])])):(u(),c(E,{key:1,title:o.$t("setting.noWhiteFound"),icon:"warning",style:{"margin-top":"10%"}},null,8,["title"]))]),_:1})]),_:1},8,["label"]),a(K,{label:n(s)("setting.historyPlayer"),name:"history"},{default:e(()=>[a(R,{style:{height:"78vh"},shadow:"never"},{header:e(()=>[m("div",it,[a(Ve,{content:n(s)("setting.historyPlayerTip"),effect:"light",placement:"top"},{default:e(()=>[m("div",dt,[d(i(n(s)("setting.historyPlayer"))+" ",1),a(j,null,{default:e(()=>[a(n(He))]),_:1})])]),_:1},8,["content"]),m("div",null,[a(r,{size:"default",type:"danger",onClick:ze},{default:e(()=>[d(i(n(s)("setting.historyClean")),1)]),_:1}),a(r,{size:"default",onClick:t[16]||(t[16]=l=>Y(!0))},{default:e(()=>[d(i(n(s)("setting.refresh")),1)]),_:1})])])]),default:e(()=>[ye((u(),c(ce,{ref:"tableRef",data:Q.value,"max-height":n(he)?450:550,border:""},{default:e(()=>[a(f,{label:o.$t("setting.nickName"),prop:"nickname"},null,8,["label"]),a(f,{label:o.$t("setting.role"),prop:"prefab"},{default:e(l=>[l.row.prefab?(u(),c(_,{key:0,type:"success"},{default:e(()=>[d(i(l.row.prefab),1)]),_:2},1024)):(u(),c(_,{key:1,type:"warning"},{default:e(()=>[d(i(n(s)("setting.roleFail")),1)]),_:1}))]),_:1},8,["label"]),a(f,{label:o.$t("setting.age"),prop:"age"},{default:e(l=>[l.row.age?(u(),c(_,{key:0,type:"success"},{default:e(()=>[d(i(l.row.age),1)]),_:2},1024)):(u(),c(_,{key:1,type:"warning"},{default:e(()=>[d(i(n(s)("setting.roleFail")),1)]),_:1}))]),_:1},8,["label"]),a(f,{label:"UID",prop:"uid"}),a(f,{label:o.$t("setting.button.actions"),prop:"actions"},{default:e(l=>[a(pe,{trigger:"hover",onCommand:re},{dropdown:e(()=>[a(fe,null,{default:e(()=>[a(C,{command:{type:"admin",uid:l.row.uid},disabled:S(l.row.uid)},{default:e(()=>[d(i(n(s)("setting.addAdmin")),1)]),_:2},1032,["command","disabled"]),a(C,{command:{type:"block",uid:l.row.uid},disabled:de(l.row.uid)},{default:e(()=>[d(i(n(s)("setting.addBlock")),1)]),_:2},1032,["command","disabled"]),a(C,{command:{type:"white",uid:l.row.uid},disabled:ue(l.row.uid)},{default:e(()=>[d(i(n(s)("setting.addWhite")),1)]),_:2},1032,["command","disabled"]),a(C,{command:{type:"kick",uid:l.row.uid},disabled:S(l.row.uid),divided:""},{default:e(()=>[d(i(n(s)("setting.kick")),1)]),_:2},1032,["command","disabled"])]),_:2},1024)]),default:e(()=>[a(r,{link:"",type:"primary"},{default:e(()=>[d(i(n(s)("setting.button.actions"))+" ",1),a(j,{class:"el-icon--right"},{default:e(()=>[a(v)]),_:1})]),_:1})]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data","max-height"])),[[ge,X.value]])]),_:1})]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(me,{modelValue:q.value,"onUpdate:modelValue":t[18]||(t[18]=l=>q.value=l),"close-on-click-modal":!L.value,"close-on-press-escape":!L.value,"show-close":!L.value,title:n(s)("setting.blockListItems.uploadButton"),width:"45%"},{default:e(()=>[ye((u(),c(Ue,{ref_key:"uploadRef",ref:Z,"before-upload":Ce,"http-request":xe,limit:1,drag:""},{tip:e(()=>[m("div",rt,i(n(s)("setting.blockListItems.tips")),1)]),default:e(()=>[a(j,{class:"el-icon--upload"},{default:e(()=>[a(n(We))]),_:1}),m("div",ut,[d(i(n(s)("setting.import.dialog.text1"))+" ",1),m("em",null,i(n(s)("setting.import.dialog.text2")),1)])]),_:1})),[[ge,L.value]])]),_:1},8,["modelValue","close-on-click-modal","close-on-press-escape","show-close","title"]),a(me,{modelValue:V.value,"onUpdate:modelValue":t[20]||(t[20]=l=>V.value=l),title:n(s)("setting.manualAdd"),width:"60%"},{default:e(()=>[a(Ae,{style:{margin:"30px 20px"}},{default:e(()=>[a(Fe,null,{default:e(()=>[a(H,{modelValue:$.value,"onUpdate:modelValue":t[19]||(t[19]=l=>$.value=l),placeholder:n(s)("setting.uidPlaceholder"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1}),m("div",ft,[a(r,{type:"primary",onClick:De},{default:e(()=>[d(i(n(s)("users.submit")),1)]),_:1})])]),_:1})]),_:1},8,["modelValue","title"])])}}});export{gt as default};
