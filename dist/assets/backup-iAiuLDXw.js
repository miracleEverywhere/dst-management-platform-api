import{t as w}from"./index-B90CSZKN.js";import{_ as Y,u as Z,a as ee,g as te,G as oe,H as ae,d as le,I as ne,c as L,o as se,r as p,w as ce,J as F,K as r,f as re,i as ue,k as t,l as o,m as k,q as f,t as d,j as m,A as ie,a1 as de,D as R,E as T,B as y,C as x,ao as me}from"./index-DVAqIYfs.js";const pe={class:"page-div"},fe={class:"card-header"},_e=de({name:"toolsBackup"}),he=Object.assign(_e,{setup(ge){const{t:s}=Z(),{isMobile:M}=ee(),u=te(),v=oe();ae();const z=le(),E=ne("refresh");L(()=>u.isDark);const c=L(()=>u.language);se(()=>{g()}),p(!1),p(!1);const N=p([]);p({enable:!1,time:"00:00:00"});const S=p(0),g=()=>{const e={clusterName:u.selectedDstCluster};w.backup.get(e).then(a=>{N.value=a.data.backupFiles,S.value=a.data.diskUsage})},A=e=>{T.confirm(c.value==="zh"?"将执行删除操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",c.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:c.value==="zh"?"确定":"confirm",cancelButtonText:c.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(a,l,i)=>{if(a==="confirm"){l.confirmButtonLoading=!0;const n={clusterName:u.selectedDstCluster,name:e.name};w.backup.delete(n).then(b=>{y(b.message),i()}).catch(()=>{}).finally(()=>{l.confirmButtonLoading=!1,g()})}else i()}}).then(()=>{}).catch(()=>{x(s("home.canceled"))}).finally(()=>{h.value=!1})},q=e=>{T.confirm(c.value==="zh"?"将执行恢复操作，是否继续？":"The RESTORE operation will be performed. Do you want to continue?",c.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:c.value==="zh"?"确定":"confirm",cancelButtonText:c.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(a,l,i)=>{if(a==="confirm"){l.confirmButtonLoading=!0;const n={clusterName:u.selectedDstCluster,name:e.name};w.backupRestore.post(n).then(b=>{y(b.message),i()}).catch(()=>{}).finally(()=>{l.confirmButtonLoading=!1,g()})}else i()}}).then(()=>{}).catch(()=>{x(s("home.canceled"))}).finally(()=>{h.value=!1})},I=()=>{if(B.value.length===0){R(s("tools.backup.deleteTip"));return}T.confirm(c.value==="zh"?"将执行删除操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",c.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:c.value==="zh"?"确定":"confirm",cancelButtonText:c.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(e,a,l)=>{if(e==="confirm"){a.confirmButtonLoading=!0;const i={clusterName:u.selectedDstCluster,names:[]};for(let n of B.value)i.names.push(n.name);w.multiDelete.delete(i).then(n=>{y(n.message),l()}).catch(()=>{}).finally(()=>{a.confirmButtonLoading=!1,g()})}else l()}}).then(()=>{}).catch(()=>{x(s("home.canceled"))})},K=p(),B=p([]),P=e=>{B.value=e},j=e=>{let a=`/v1/download/backup/${u.selectedDstCluster}/${e.name}?authorization=${me()}&&clusterName=${u.selectedDstCluster}&&lang=${u.language}`;window.open(a,"_blank"),h.value=!1},h=p(!1),V=e=>{let a=e.cmd,l=e.row;switch(h.value=!0,a){case"download":j(l);break;case"restore":q(l);break;case"delete":A(l);break;default:h.value=!1,R("error")}},C=p(!1),O=()=>{C.value=!0;const e={clusterName:u.selectedDstCluster};w.backup.post(e).then(a=>{y(a.message)}).finally(()=>{C.value=!1,g()})},U=()=>{setTimeout(()=>{v.meta.isKeepAlive&&z.removeKeepAliveName(v.name),E(!1),F(()=>{v.meta.isKeepAlive&&z.addKeepAliveName(v.name),E(!0)})},0)};return ce(()=>u.selectedDstCluster,e=>{e&&F(()=>{U()})},{immediate:!1}),(e,a)=>{const l=r("el-button"),i=r("el-progress"),n=r("el-table-column"),b=r("arrow-down"),G=r("el-icon"),D=r("el-dropdown-item"),H=r("el-dropdown-menu"),J=r("el-dropdown"),Q=r("el-table"),$=r("el-row"),W=r("el-card"),X=r("el-col");return re(),ue("div",pe,[t($,{gutter:10},{default:o(()=>[t(X,{lg:24,md:24,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:o(()=>[t(W,{style:{"min-height":"70vh"},shadow:"never"},{header:o(()=>[k("div",fe,[f(d(m(s)("tools.backup.title2"))+" ",1),k("div",null,[t(l,{loading:C.value,type:"primary",onClick:O},{default:o(()=>[f(d(m(s)("tools.backup.BackupImmediately")),1)]),_:1},8,["loading"]),t(l,{type:"danger",onClick:I},{default:o(()=>[f(d(m(s)("tools.backup.multiDelete")),1)]),_:1})])])]),default:o(()=>[k("div",null,[t(i,{"stroke-width":"20","text-inside":"",style:{"margin-bottom":"20px"},percentage:parseFloat(S.value.toFixed(1))},{default:o(({percentage:_})=>[k("span",null,d(m(s)("tools.backup.processBar"))+d(_)+"%",1)]),_:1},8,["percentage"])]),k("div",null,[t($,null,{default:o(()=>[t(Q,{ref_key:"tableRef",ref:K,data:N.value,"max-height":m(M)?450:550,border:"",onSelectionChange:P},{default:o(()=>[t(n,{fixed:"left",type:"selection",width:"55"}),t(n,{label:e.$t("tools.backup.tableName"),prop:"name"},null,8,["label"]),t(n,{label:e.$t("tools.backup.size"),prop:"size"},{default:o(_=>[f(d(m(ie)(_.row.size)),1)]),_:1},8,["label"]),t(n,{label:e.$t("tools.backup.tableCreateTime"),prop:"createTime"},null,8,["label"]),t(n,{label:e.$t("setting.button.actions"),prop:"actions",width:"120px"},{default:o(_=>[t(J,{trigger:"click",onCommand:V},{dropdown:o(()=>[t(H,null,{default:o(()=>[t(D,{command:{cmd:"download",row:_.row}},{default:o(()=>[f(d(m(s)("tools.backup.download")),1)]),_:2},1032,["command"]),t(D,{command:{cmd:"restore",row:_.row}},{default:o(()=>[f(d(m(s)("tools.backup.restore")),1)]),_:2},1032,["command"]),t(D,{command:{cmd:"delete",row:_.row}},{default:o(()=>[f(d(m(s)("tools.backup.delete")),1)]),_:2},1032,["command"])]),_:2},1024)]),default:o(()=>[t(l,{loading:h.value,link:"",type:"primary"},{default:o(()=>[f(d(m(s)("setting.button.actions"))+" ",1),t(G,{class:"el-icon--right"},{default:o(()=>[t(b)]),_:1})]),_:1},8,["loading"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data","max-height"])]),_:1})])]),_:1})]),_:1})]),_:1})])}}}),ke=Y(he,[["__scopeId","data-v-e5d42b64"]]);export{ke as default};
