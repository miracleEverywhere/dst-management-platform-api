import{o as ee,u as te,g as le,G as ae,H as se,d as oe,I as ue,c as B,r as m,a2 as v,w as re,J as q,K as p,L as ne,f as g,i as R,m as b,t as r,j as s,p as W,n as N,l as e,k as l,q as d,v as ce,a1 as ie,D as de,B as $,E as me,C as pe}from"./index-5FXYdO3K.js";const fe={class:"page-div"},_e={class:"tip_warning"},ve={class:"tip_success",style:{"margin-top":"20px"}},ge={class:"fcc",style:{"font-size":"20px"}},be={key:0},ye={class:"tip"},he={style:{margin:"20px"}},we={style:{display:"flex","justify-content":"flex-end","padding-top":"10px"}},Ce=ie({name:"Clusters"}),ke=Object.assign(Ce,{setup(De){ee(()=>{T(),j()});const{t:a}=te(),n=le(),h=ae();se();const E=oe(),L=ue("refresh"),F=B(()=>n.isDark),_=B(()=>n.language),k=m(!1),x=m(!1),S=B(()=>k.value||x.value),V=m([]),T=()=>{k.value=!0,v.clusters.get().then(o=>{V.value=o.data}).finally(()=>{k.value=!1})},P=m([]),A=m(0),U=m(0),j=()=>{x.value=!0,v.clustersWorldPort.get().then(o=>{P.value=o.data;let u=[];for(let c of P.value)if(c.worldPort!==null)for(let i of c.worldPort)u.push(i);A.value=u.length,U.value=new Set(u).size}).finally(()=>{x.value=!1})},O=()=>{v.clusters.get().then(o=>{n.dstClusters=o.data,n.selectedDstCluster===null&&n.dstClusters!==null&&(n.selectedDstCluster=n.dstClusters[0].clusterName)})},w=m(!1),z=m(!1),f=m({clusterName:"",clusterDisplayName:""}),G=o=>{f.value={clusterName:o.clusterName,clusterDisplayName:""},w.value=!0},H=()=>{if(f.value===""){de(_.value==="zh"?"请输入集群昵称":"cluster nickname is required");return}z.value=!0,v.cluster.put(f.value).then(o=>{v.clusters.get().then(u=>{V.value=u.data,n.dstClusters=u.data}),$(o.message),w.value=!1}).finally(()=>{z.value=!1})},J=o=>{me.confirm(_.value==="zh"?"将执行 删除集群 操作，是否继续？":"The cluster DELETE operation will be performed. Do you want to continue?",_.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:_.value==="zh"?"确定":"confirm",cancelButtonText:_.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(u,c,i)=>{if(u==="confirm"){c.confirmButtonLoading=!0;const y={clusterName:o};v.cluster.delete(y).then(async C=>{$(C.message),await T(),await j(),await O(),n.selectedDstCluster===o&&n.dstClusters!==null&&(n.selectedDstCluster=n.dstClusters[0].clusterName),i()}).catch(()=>{}).finally(()=>{c.confirmButtonLoading=!1})}else i()}}).then(()=>{}).catch(()=>{pe(a("home.canceled"))})},Q=()=>{setTimeout(()=>{h.meta.isKeepAlive&&E.removeKeepAliveName(h.name),L(!1),q(()=>{h.meta.isKeepAlive&&E.addKeepAliveName(h.name),L(!0)})},0)};return re(()=>n.selectedDstCluster,o=>{o&&q(()=>{Q()})},{immediate:!1}),(o,u)=>{const c=p("el-tag"),i=p("el-table-column"),y=p("el-button"),C=p("el-table"),X=p("el-alert"),I=p("el-input"),K=p("el-form-item"),Y=p("el-form"),Z=p("el-dialog"),M=ne("loading");return g(),R("div",fe,[b("div",_e,r(s(a)("clusters.tip1")),1),W((g(),N(C,{data:V.value,border:""},{default:e(()=>[l(i,{label:s(a)("clusters.table.name")},{default:e(t=>[l(c,{type:"primary"},{default:e(()=>[d(r(t.row.clusterName),1)]),_:2},1024)]),_:1},8,["label"]),l(i,{label:s(a)("clusters.table.displayName")},{default:e(t=>[l(c,{type:"success"},{default:e(()=>[d(r(t.row.clusterDisplayName),1)]),_:2},1024)]),_:1},8,["label"]),l(i,{label:s(a)("clusters.table.world")},{default:e(t=>[l(c,{type:"info"},{default:e(()=>{var D;return[d(r(((D=t.row.worlds)==null?void 0:D.length)||0),1)]}),_:2},1024)]),_:1},8,["label"]),l(i,{label:s(a)("clusters.table.actions")},{default:e(t=>[l(y,{size:"small",type:"warning",onClick:D=>G(t.row)},{default:e(()=>[d(r(s(a)("clusters.table.update")),1)]),_:2},1032,["onClick"]),l(y,{size:"small",type:"danger",onClick:D=>J(t.row.clusterName)},{default:e(()=>[d(r(s(a)("clusters.table.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[M,S.value]]),b("div",ve,r(s(a)("clusters.tip2")),1),U.value!==A.value?(g(),N(X,{key:0,effect:F.value?"light":"dark",type:"error",closable:!1,style:{"margin-bottom":"10px"}},{title:e(()=>[b("div",ge,r(s(a)("clusters.tip3")),1)]),_:1},8,["effect"])):ce("",!0),W((g(),N(C,{data:P.value,border:""},{default:e(()=>[l(i,{label:s(a)("clusters.table.name")},{default:e(t=>[l(c,{type:"primary"},{default:e(()=>[d(r(t.row.clusterName),1)]),_:2},1024)]),_:1},8,["label"]),l(i,{label:s(a)("clusters.table.displayName")},{default:e(t=>[l(c,{type:"success"},{default:e(()=>[d(r(t.row.clusterDisplayName),1)]),_:2},1024)]),_:1},8,["label"]),l(i,{label:s(a)("clusters.table.port")},{default:e(t=>[t.row.worldPort?(g(),R("span",be,r(t.row.worldPort.join(",")),1)):(g(),N(c,{key:1,type:"info"},{default:e(()=>[d(r(s(a)("clusters.table.none")),1)]),_:1}))]),_:1},8,["label"])]),_:1},8,["data"])),[[M,S.value]]),l(Z,{modelValue:w.value,"onUpdate:modelValue":u[2]||(u[2]=t=>w.value=t),width:"65%"},{header:e(()=>[d(r(s(a)("clusters.updateDialog.title")),1)]),default:e(()=>[b("div",ye,r(s(a)("clusters.updateDialog.tip1")),1),b("div",he,[l(Y,{model:f.value},{default:e(()=>[l(K,{label:s(a)("clusters.updateDialog.clusterName")},{default:e(()=>[l(I,{disabled:"",modelValue:f.value.clusterName,"onUpdate:modelValue":u[0]||(u[0]=t=>f.value.clusterName=t)},null,8,["modelValue"])]),_:1},8,["label"]),l(K,{label:s(a)("clusters.updateDialog.newDisplayName")},{default:e(()=>[l(I,{modelValue:f.value.clusterDisplayName,"onUpdate:modelValue":u[1]||(u[1]=t=>f.value.clusterDisplayName=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"]),b("div",we,[l(y,{type:"primary",onClick:H,loading:z.value},{default:e(()=>[d(r(_.value==="zh"?"更新":"Update"),1)]),_:1},8,["loading"])])])]),_:1},8,["modelValue"])])}}});export{ke as default};
