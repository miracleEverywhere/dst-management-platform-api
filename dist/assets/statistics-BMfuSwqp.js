import{t as Z}from"./index-CBCxpQOi.js";import{_ as tt,f as k,i as q,t as o,u as et,a as at,g as st,G as lt,H as it,d as rt,I as nt,c as E,o as ot,at as K,B as ct,r as x,w as ut,J as M,K as m,k as i,l as s,j as r,m as n,q as D,F as dt,y as ht,n as mt,a1 as pt,s as ft}from"./index-CkNyeDm0.js";import{S as _t}from"./index-C8XOarDo.js";let I=0;const L="webkit moz ms o".split(" ");let p,f;const gt=typeof window>"u";if(gt)p=function(){},f=function(){};else{p=window.requestAnimationFrame,f=window.cancelAnimationFrame;let e;for(let t=0;t<L.length&&!(p&&f);t++)e=L[t],p=p||window[e+"RequestAnimationFrame"],f=f||window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"];(!p||!f)&&(p=function(t){const a=new Date().getTime(),l=Math.max(0,16-(a-I)),u=window.setTimeout(()=>{t(a+l)},l);return I=a+l,u},f=function(t){window.clearTimeout(t)})}const yt={props:{startVal:{type:Number,required:!1,default:0},endVal:{type:Number,required:!1,default:2017},duration:{type:Number,required:!1,default:3e3},autoplay:{type:Boolean,required:!1,default:!0},decimals:{type:Number,required:!1,default:0,validator(e){return e>=0}},decimal:{type:String,required:!1,default:"."},separator:{type:String,required:!1,default:","},prefix:{type:String,required:!1,default:""},suffix:{type:String,required:!1,default:""},useEasing:{type:Boolean,required:!1,default:!0},easingFn:{type:Function,default(e,t,a,l){return a*(-Math.pow(2,-10*e/l)+1)*1024/1023+t}}},data(){return{localStartVal:this.startVal,displayValue:this.formatNumber(this.startVal),printVal:null,paused:!1,localDuration:this.duration,startTime:null,timestamp:null,remaining:null,rAF:null}},computed:{countDown(){return this.startVal>this.endVal}},watch:{startVal(){this.autoplay&&this.start()},endVal(){this.autoplay&&this.start()}},mounted(){this.autoplay&&this.start(),this.$emit("mountedCallback")},methods:{start(){this.localStartVal=this.startVal,this.startTime=null,this.localDuration=this.duration,this.paused=!1,this.rAF=p(this.count)},pauseResume(){this.paused?(this.resume(),this.paused=!1):(this.pause(),this.paused=!0)},pause(){f(this.rAF)},resume(){this.startTime=null,this.localDuration=+this.remaining,this.localStartVal=+this.printVal,p(this.count)},reset(){this.startTime=null,f(this.rAF),this.displayValue=this.formatNumber(this.startVal)},count(e){this.startTime||(this.startTime=e),this.timestamp=e;const t=e-this.startTime;this.remaining=this.localDuration-t,this.useEasing?this.countDown?this.printVal=this.localStartVal-this.easingFn(t,0,this.localStartVal-this.endVal,this.localDuration):this.printVal=this.easingFn(t,this.localStartVal,this.endVal-this.localStartVal,this.localDuration):this.countDown?this.printVal=this.localStartVal-(this.localStartVal-this.endVal)*(t/this.localDuration):this.printVal=this.localStartVal+(this.endVal-this.localStartVal)*(t/this.localDuration),this.countDown?this.printVal=this.printVal<this.endVal?this.endVal:this.printVal:this.printVal=this.printVal>this.endVal?this.endVal:this.printVal,this.displayValue=this.formatNumber(this.printVal),t<this.localDuration?this.rAF=p(this.count):this.$emit("callback")},isNumber(e){return!isNaN(parseFloat(e))},formatNumber(e){e=e.toFixed(this.decimals),e+="";const t=e.split(".");let a=t[0];const l=t.length>1?this.decimal+t[1]:"",u=/(\d+)(\d{3})/;if(this.separator&&!this.isNumber(this.separator))for(;u.test(a);)a=a.replace(u,"$1"+this.separator+"$2");return this.prefix+a+l+this.suffix}},destroyed(){f(this.rAF)}};function bt(e,t,a,l,u,F){return k(),q("span",null,o(u.displayValue),1)}const A=tt(yt,[["render",bt]]);function vt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function z(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),a.push.apply(a,l)}return a}A.unmounted=A.destroyed,Reflect.deleteProperty(A,"destroyed");var G=function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?z(Object(a),!0).forEach(function(l){vt(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):z(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}({name:"CountTo",emits:["callback","mountedCallback"]},A);const xt={class:"page-div"},Vt={class:"card-header"},wt={class:"card-header"},St={class:"flex justify-between"},Dt={class:"text-sm"},Tt={class:"text-2xl"},kt={class:"card-header"},At={class:"flex justify-between"},Ft={class:"text-sm"},Ct={class:"text-2xl"},Nt={class:"card-header"},Ot={class:"flex justify-between"},qt={class:"text-sm"},Pt={class:"text-2xl"},$t={class:"card-header"},jt={style:{display:"flex",width:"fit-content","padding-bottom":"30px"}},Rt=pt({name:"toolsStatistics"}),Mt=Object.assign(Rt,{setup(e){const{t}=et();at();const a=st(),l=lt();it();const u=rt(),F=nt("refresh"),H=E(()=>a.isDark),J=E(()=>a.language);ot(()=>{C()});const P=v=>{const d=new Date(v),c=d.getFullYear(),g=String(d.getMonth()+1).padStart(2,"0"),y=String(d.getDate()).padStart(2,"0"),b=String(d.getHours()).padStart(2,"0"),h=String(d.getMinutes()).padStart(2,"0");return`${c}-${g}-${y} ${b}:${h}`},C=(v=!1)=>{const d={clusterName:a.selectedDstCluster};Z.statistics.get(d).then(c=>{for(let h of c.data.stats)_.value.xAxis.data.push(K(h.timestamp)),_.value.series[0].data.push(h.num),h.num>V.value.num&&(V.value=h);V.value.dataVolume=c.data.stats.length;let g=c.data.stats[0].timestamp,y=c.data.stats[c.data.stats.length-1].timestamp;$.value=P(parseInt(g)-36e5),j.value=P(parseInt(y)+36e5),N.value=[];let b;J.value==="zh"?b="åˆ†":b="m";for(const h in c.data.gantt){let S=[];for(let w of c.data.gantt[h])S.push({myBeginDate:w.beginDate,myEndDate:w.endDate,ganttBarConfig:{id:w.id,label:w.label+b,immobile:!0,style:{background:"#409effaa",color:"white",borderRadius:"5px"}}});N.value.push({nickname:h,barList:S})}v&&ct(t("tools.statistics.player.refreshSuccess"))})},$=x(""),j=x(""),N=x([]),R=x("statistics"),U=async(v,d)=>{await ft(10),_.value.xAxis.data=[],_.value.series[0].data=[],await C(),O.value.redraw(_.value)},V=x({num:-1,timestamp:0,dataVolume:0}),B=()=>{_.value.xAxis.data=[],_.value.series[0].data=[],C(!0),O.value.redraw(_.value)},O=x(),_=x({tooltip:{trigger:"axis"},xAxis:{type:"category",data:[]},yAxis:{type:"value"},series:[{data:[],type:"line",smooth:!0,areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(1, 255, 255, 0.8)"},{offset:1,color:"rgba(1, 255, 255,0)"}],global:!1}}}]}),Y=()=>{setTimeout(()=>{l.meta.isKeepAlive&&u.removeKeepAliveName(l.name),F(!1),M(()=>{l.meta.isKeepAlive&&u.addKeepAliveName(l.name),F(!0)})},0)};return ut(()=>a.selectedDstCluster,v=>{v&&M(()=>{Y()})},{immediate:!1}),(v,d)=>{const c=m("el-button"),g=m("el-card"),y=m("el-col"),b=m("el-row"),h=m("el-tag"),S=m("el-tab-pane"),w=m("g-gantt-row"),Q=m("g-gantt-chart"),W=m("el-scrollbar"),X=m("el-tabs");return k(),q("div",xt,[i(X,{modelValue:R.value,"onUpdate:modelValue":d[0]||(d[0]=T=>R.value=T),onTabClick:U},{default:s(()=>[i(S,{label:r(t)("tools.statistics.player.title"),name:"statistics"},{default:s(()=>[i(b,{gutter:10},{default:s(()=>[i(y,{lg:24,md:24,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:s(()=>[i(g,{shadow:"never"},{header:s(()=>[n("div",Vt,[D(o(r(t)("tools.statistics.player.title"))+" ",1),i(c,{onClick:B},{default:s(()=>[D(o(r(t)("tools.statistics.player.refresh")),1)]),_:1})])]),default:s(()=>[i(_t,{ref_key:"playerChartRef",ref:O,option:_.value,height:"300px"},null,8,["option"])]),_:1})]),_:1})]),_:1}),i(b,{gutter:10},{default:s(()=>[i(y,{lg:8,md:8,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:s(()=>[i(g,{shadow:"never"},{header:s(()=>[n("div",wt,o(r(t)("tools.statistics.max.title")),1)]),default:s(()=>[n("div",St,[n("span",Dt,o(r(t)("tools.statistics.max.maxPlayer")),1),i(h,{type:"success"},{default:s(()=>[D(o(r(t)("tools.statistics.max.day")),1)]),_:1})]),n("div",Tt,[i(r(G),{duration:2e3,endVal:V.value.num,startVal:0},null,8,["endVal"])])]),_:1})]),_:1}),i(y,{lg:8,md:8,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:s(()=>[i(g,{shadow:"never"},{header:s(()=>[n("div",kt,o(r(t)("tools.statistics.max.maxPlayerTimestamp")),1)]),default:s(()=>[n("div",At,[n("span",Ft,o(r(t)("tools.statistics.max.time")),1)]),n("div",Ct,o(r(K)(V.value.timestamp)),1)]),_:1})]),_:1}),i(y,{lg:8,md:8,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:s(()=>[i(g,{shadow:"never"},{header:s(()=>[n("div",Nt,o(r(t)("tools.statistics.data.title")),1)]),default:s(()=>[n("div",Ot,[n("span",qt,o(r(t)("tools.statistics.data.dataNum")),1)]),n("div",Pt,[i(r(G),{duration:2e3,endVal:V.value.dataVolume,startVal:0},null,8,["endVal"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["label"]),i(S,{label:r(t)("tools.statistics.player.title2"),name:"gantt"},{default:s(()=>[i(g,{shadow:"never",style:{"margin-top":"10px"}},{header:s(()=>[n("div",$t,[D(o(r(t)("tools.statistics.player.title2"))+" ",1),i(c,{onClick:B},{default:s(()=>[D(o(r(t)("tools.statistics.player.refresh")),1)]),_:1})])]),default:s(()=>[i(W,null,{default:s(()=>[n("div",jt,[i(Q,{"chart-end":j.value,"chart-start":$.value,"bar-end":"myEndDate","bar-start":"myBeginDate","color-scheme":H.value?"dark":"sky",precision:"hour",width:"2600px"},{default:s(()=>[(k(!0),q(dt,null,ht(N.value,T=>(k(),mt(w,{bars:T.barList,label:T.nickname,"highlight-on-hover":""},null,8,["bars","label"]))),256))]),_:1},8,["chart-end","chart-start","color-scheme"])])]),_:1})]),_:1})]),_:1},8,["label"])]),_:1},8,["modelValue"])])}}});export{Mt as default};
