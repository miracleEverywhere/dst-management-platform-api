import{u as Pe,a as Be,g as Re,G as Te,H as Ke,d as Se,I as qe,c as ye,o as Me,a2 as I,B as N,r as g,w as je,J as ae,K as p,L as Ee,f as u,i as k,k as a,l as e,j as s,m,q as d,t as i,n as c,F as ne,y as se,x as oe,a9 as He,p as he,a8 as We,a1 as Ge,D as W}from"./index-CkNyeDm0.js";const Je={class:"page-div"},Oe={class:"card-header"},Qe={key:0},Xe={key:1},Ye={class:"card-header"},Ze={key:0},et={style:{"margin-top":"20px"}},tt={class:"card-header"},lt={key:0},at={style:{"margin-top":"20px"}},nt={class:"card-header"},st={key:0},ot={style:{"margin-top":"20px"}},it={class:"card-header"},dt={class:"fcc"},ut={class:"el-upload__text"},rt={class:"el-upload__tip"},ft={style:{display:"flex","justify-content":"flex-end","padding-top":"10px"}},pt=Ge({name:"settingsPlayer"}),gt=Object.assign(pt,{setup(ct){const{t:o}=Pe(),{isMobile:be}=Be(),w=Re(),K=Te();Ke();const ie=Se(),de=qe("refresh"),D=ye(()=>w.isDark),y=ye(()=>w.language);Me(()=>{x()});const x=(n=!1)=>{I.player.list.get({clusterName:w.selectedDstCluster}).then(t=>{var r,f,_;if(G.value=t.data.players,J.value=t.data.uidMap,A.value=[],(((r=t.data.adminList)==null?void 0:r.length)||0)>0)for(let v of t.data.adminList)v!==""&&A.value.push(v);if(F.value=[],(((f=t.data.blockList)==null?void 0:f.length)||0)>0)for(let v of t.data.blockList)v!==""&&F.value.push(v);if(P.value=[],(((_=t.data.whiteList)==null?void 0:_.length)||0)>0)for(let v of t.data.whiteList)v!==""&&P.value.push(v);if(n){let v;y.value==="zh"?v="刷新成功":v="Refresh Success",N(v)}})},U=g("players"),G=g([]),J=g({}),A=g([]),F=g([]),P=g([]),O=n=>{for(let t of A.value)if(t===n)return!0},ue=n=>{for(let t of F.value)if(t===n)return!0},re=n=>{for(let t of P.value)if(t===n)return!0},fe=n=>{switch(n.type){case"admin":C(n.type,"add",n.uid);break;case"block":C(n.type,"add",n.uid);break;case"white":C(n.type,"add",n.uid);break;case"kick":S(n.type,n.uid);break;case"kill":S(n.type,n.uid);break;case"respawn":S(n.type,n.uid);break;case"despawn":S(n.type,n.uid);break}},C=(n,t,r)=>{const f={clusterName:w.selectedDstCluster,listName:n,type:t,uid:r};I.player.change.post(f).then(_=>{N(_.message),x()})},S=(n,t)=>{const r={clusterName:w.selectedDstCluster,uid:t,type:n};I.player.action.post(r).then(f=>{N(f.message)})},Q=n=>n in J.value?" ["+J.value[n]+"]":y.value==="zh"?" [暂未获取到]":" [Not yet obtained]",ke=(n,t)=>{n.paneName==="history"&&Z()},X=g([]),Y=g(!1),Z=(n=!1)=>{Y.value=!0,X.value=[];const t={clusterName:w.selectedDstCluster};I.player.history.get(t).then(r=>{for(let f of r.data)f.uid.length===11&&X.value.push(f);if(n){let f;y.value==="zh"?f="刷新成功":f="Refresh Success",N(f)}}).finally(()=>{Y.value=!1})},ee=g(),q=g(!1),L=g(!1),we=()=>{ee.value&&ee.value.clearFiles(),q.value=!0,L.value=!1},Ce=n=>/\.xls|xlsx$/i.test(n.name)?!0:(W(y.value==="zh"?"请上传Excel文件":"Please upload a Excel file"),!1),xe=n=>{L.value=!0;const t=new FormData;t.append("file",n.file),I.player.addBlockUpload.post(t).then(r=>{x(),N(r.message)}).finally(()=>{q.value=!1,L.value=!1})},Le=()=>{setTimeout(()=>{K.meta.isKeepAlive&&ie.removeKeepAliveName(K.name),de(!1),ae(()=>{K.meta.isKeepAlive&&ie.addKeepAliveName(K.name),de(!0)})},0)},B=g(!1),M=g(),h=g(""),te=()=>{B.value=!0,ae(()=>{M.value.input.focus()})},z=n=>{h.value&&C(n,"add",h.value),B.value=!1,h.value=""},V=g(!1),$=g(""),De=async()=>{let n="";if(U.value==="adminList"&&(n="admin"),U.value==="blockList"&&(n="block"),U.value==="whiteList"&&(n="white"),n===""){W(y.value==="zh"?"非法请求":"Invalid Request");return}if($.value===""){W(y.value==="zh"?"请输入玩家UID":"Please enter the player UID");return}if(!/^KU_/.test($.value)){W(y.value==="zh"?"请输入正确的玩家UID":"Please enter the correct player UID");return}await C(n,"add",$.value),$.value="",V.value=!1},ze=()=>{const n={clusterName:w.selectedDstCluster};I.player.historyClean.post(n).then(t=>{N(t.message)}).finally(()=>{Z(!1)})};return je(()=>w.selectedDstCluster,n=>{n&&ae(()=>{Le()})},{immediate:!1}),(n,t)=>{const r=p("el-button"),f=p("el-table-column"),_=p("el-tag"),v=p("arrow-down"),j=p("el-icon"),b=p("el-dropdown-item"),pe=p("el-dropdown-menu"),ce=p("el-dropdown"),me=p("el-table"),E=p("el-result"),R=p("el-card"),T=p("el-tab-pane"),le=p("el-alert"),H=p("el-input"),Ve=p("el-tooltip"),$e=p("el-tabs"),Ie=p("el-col"),Ne=p("el-row"),Ue=p("el-upload"),ge=p("el-dialog"),Ae=p("el-form-item"),Fe=p("el-form"),ve=Ee("loading");return u(),k("div",Je,[a(Ne,{gutter:10},{default:e(()=>[a(Ie,{lg:24,md:24,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:e(()=>[a($e,{modelValue:U.value,"onUpdate:modelValue":t[17]||(t[17]=l=>U.value=l),onTabClick:ke},{default:e(()=>[a(T,{label:s(o)("setting.players"),name:"players"},{default:e(()=>[a(R,{style:{height:"78vh"},shadow:"never"},{header:e(()=>[m("div",Oe,[d(i(s(o)("setting.players"))+" ",1),m("div",null,[a(r,{size:"default",onClick:t[0]||(t[0]=l=>x(!0))},{default:e(()=>[d(i(s(o)("setting.refresh")),1)]),_:1})])])]),default:e(()=>[G.value?(u(),c(me,{key:0,data:G.value,border:"",size:"small",style:{width:"100%"}},{default:e(()=>[a(f,{label:s(o)("setting.nickName"),prop:"nickName"},null,8,["label"]),a(f,{label:s(o)("setting.role"),prop:"prefab"},{default:e(l=>[l.row.prefab===""?(u(),k("span",Qe,i(s(o)("setting.roleFail")),1)):(u(),k("span",Xe,i(l.row.prefab),1))]),_:1},8,["label"]),a(f,{label:s(o)("setting.age"),prop:"age"},{default:e(l=>[l.row.age?(u(),c(_,{key:0,type:"success"},{default:e(()=>[d(i(l.row.age),1)]),_:2},1024)):(u(),c(_,{key:1,type:"warning"},{default:e(()=>[d(i(s(o)("setting.roleFail")),1)]),_:1}))]),_:1},8,["label"]),a(f,{label:"UID",prop:"uid"}),a(f,{label:s(o)("setting.button.actions"),prop:"actions"},{default:e(l=>[a(ce,{trigger:"hover",onCommand:fe},{dropdown:e(()=>[a(pe,null,{default:e(()=>[a(b,{command:{type:"admin",uid:l.row.uid},disabled:O(l.row.uid)},{default:e(()=>[d(i(s(o)("setting.addAdmin")),1)]),_:2},1032,["command","disabled"]),a(b,{command:{type:"block",uid:l.row.uid},disabled:ue(l.row.uid)},{default:e(()=>[d(i(s(o)("setting.addBlock")),1)]),_:2},1032,["command","disabled"]),a(b,{command:{type:"white",uid:l.row.uid},disabled:re(l.row.uid)},{default:e(()=>[d(i(s(o)("setting.addWhite")),1)]),_:2},1032,["command","disabled"]),a(b,{command:{type:"kick",uid:l.row.uid},disabled:O(l.row.uid),divided:""},{default:e(()=>[d(i(s(o)("setting.kick")),1)]),_:2},1032,["command","disabled"]),a(b,{command:{type:"kill",uid:l.row.uid}},{default:e(()=>[d(i(s(o)("setting.kill")),1)]),_:2},1032,["command"]),a(b,{command:{type:"respawn",uid:l.row.uid}},{default:e(()=>[d(i(s(o)("setting.respawn")),1)]),_:2},1032,["command"])]),_:2},1024)]),default:e(()=>[a(r,{link:"",type:"primary"},{default:e(()=>[d(i(s(o)("setting.button.actions"))+" ",1),a(j,{class:"el-icon--right"},{default:e(()=>[a(v)]),_:1})]),_:1})]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])):(u(),c(E,{key:1,title:s(o)("setting.noPlayersFound"),icon:"warning",style:{"margin-top":"10%"}},null,8,["title"]))]),_:1})]),_:1},8,["label"]),a(T,{label:s(o)("setting.adminList"),name:"adminList"},{default:e(()=>[a(R,{style:{height:"78vh"},shadow:"never"},{header:e(()=>[m("div",Ye,[d(i(s(o)("setting.adminList"))+" ",1),m("div",null,[a(r,{size:"default",type:"primary",onClick:t[1]||(t[1]=l=>V.value=!0)},{default:e(()=>[d(i(s(o)("setting.manualAdd")),1)]),_:1}),a(r,{size:"default",onClick:t[2]||(t[2]=l=>x(!0))},{default:e(()=>[d(i(s(o)("setting.refresh")),1)]),_:1})])])]),default:e(()=>[A.value.length>0?(u(),k("div",Ze,[a(le,{closable:!1,effect:D.value?"light":"dark",type:"success"},{default:e(()=>[d(i(s(o)("setting.tagCloseTip")),1)]),_:1},8,["effect"]),m("div",et,[(u(!0),k(ne,null,se(A.value,l=>(u(),c(_,{effect:D.value?"light":"dark",closable:"",size:"large",style:{"margin-right":"5px","margin-top":"5px"},onClose:_e=>C("admin","delete",l)},{default:e(()=>[d(i(l+Q(l)),1)]),_:2},1032,["effect","onClose"]))),256)),B.value?(u(),c(H,{key:0,ref_key:"InputRef",ref:M,modelValue:h.value,"onUpdate:modelValue":t[3]||(t[3]=l=>h.value=l),size:"default",class:"w-32",style:{margin:"5px 5px 0 0"},onKeyup:t[4]||(t[4]=oe(l=>z("admin"),["enter"])),onBlur:t[5]||(t[5]=l=>z("admin"))},null,8,["modelValue"])):(u(),c(r,{key:1,onClick:te,style:{margin:"5px 5px 0 0"}},{default:e(()=>[d(i(y.value==="zh"?"+ 新增":"+ New"),1)]),_:1}))])])):(u(),c(E,{key:1,title:s(o)("setting.noAdminFound"),icon:"warning",style:{"margin-top":"10%"}},null,8,["title"]))]),_:1})]),_:1},8,["label"]),a(T,{label:s(o)("setting.blockList"),name:"blockList"},{default:e(()=>[a(R,{style:{height:"78vh"},shadow:"never"},{header:e(()=>[m("div",tt,[d(i(s(o)("setting.blockList"))+" ",1),m("div",null,[a(r,{size:"default",type:"primary",onClick:t[6]||(t[6]=l=>V.value=!0)},{default:e(()=>[d(i(s(o)("setting.manualAdd")),1)]),_:1}),a(r,{type:"success",onClick:we},{default:e(()=>[d(i(s(o)("setting.blockListItems.uploadButton")),1)]),_:1}),a(r,{size:"default",onClick:t[7]||(t[7]=l=>x(!0))},{default:e(()=>[d(i(s(o)("setting.refresh")),1)]),_:1})])])]),default:e(()=>[F.value.length>0?(u(),k("div",lt,[a(le,{closable:!1,effect:D.value?"light":"dark",type:"success"},{default:e(()=>[d(i(s(o)("setting.tagCloseTip")),1)]),_:1},8,["effect"]),m("div",at,[(u(!0),k(ne,null,se(F.value,l=>(u(),c(_,{effect:D.value?"light":"dark",closable:"",size:"large",style:{"margin-right":"5px","margin-top":"5px"},onClose:_e=>C("block","delete",l)},{default:e(()=>[d(i(l+Q(l)),1)]),_:2},1032,["effect","onClose"]))),256)),B.value?(u(),c(H,{key:0,ref_key:"InputRef",ref:M,modelValue:h.value,"onUpdate:modelValue":t[8]||(t[8]=l=>h.value=l),size:"default",class:"w-32",style:{margin:"5px 5px 0 0"},onKeyup:t[9]||(t[9]=oe(l=>z("block"),["enter"])),onBlur:t[10]||(t[10]=l=>z("block"))},null,8,["modelValue"])):(u(),c(r,{key:1,onClick:te,style:{margin:"5px 5px 0 0"}},{default:e(()=>[d(i(y.value==="zh"?"+ 新增":"+ New"),1)]),_:1}))])])):(u(),c(E,{key:1,title:n.$t("setting.noBlockFound"),icon:"warning",style:{"margin-top":"10%"}},null,8,["title"]))]),_:1})]),_:1},8,["label"]),a(T,{label:s(o)("setting.whiteList"),name:"whiteList"},{default:e(()=>[a(R,{style:{height:"78vh"},shadow:"never"},{header:e(()=>[m("div",nt,[d(i(s(o)("setting.whiteList"))+" ",1),m("div",null,[a(r,{size:"default",type:"primary",onClick:t[11]||(t[11]=l=>V.value=!0)},{default:e(()=>[d(i(s(o)("setting.manualAdd")),1)]),_:1}),a(r,{size:"default",onClick:t[12]||(t[12]=l=>x(!0))},{default:e(()=>[d(i(s(o)("setting.refresh")),1)]),_:1})])])]),default:e(()=>[P.value.length>0?(u(),k("div",st,[a(le,{closable:!1,effect:D.value?"light":"dark",type:"success"},{default:e(()=>[d(i(s(o)("setting.tagCloseTip")),1)]),_:1},8,["effect"]),m("div",ot,[(u(!0),k(ne,null,se(P.value,l=>(u(),c(_,{effect:D.value?"light":"dark",closable:"",size:"large",style:{"margin-right":"5px","margin-top":"5px"},onClose:_e=>C("white","delete",l)},{default:e(()=>[d(i(l+Q(l)),1)]),_:2},1032,["effect","onClose"]))),256)),B.value?(u(),c(H,{key:0,ref_key:"InputRef",ref:M,modelValue:h.value,"onUpdate:modelValue":t[13]||(t[13]=l=>h.value=l),size:"default",class:"w-32",style:{margin:"5px 5px 0 0"},onKeyup:t[14]||(t[14]=oe(l=>z("white"),["enter"])),onBlur:t[15]||(t[15]=l=>z("white"))},null,8,["modelValue"])):(u(),c(r,{key:1,onClick:te,style:{margin:"5px 5px 0 0"}},{default:e(()=>[d(i(y.value==="zh"?"+ 新增":"+ New"),1)]),_:1}))])])):(u(),c(E,{key:1,title:n.$t("setting.noWhiteFound"),icon:"warning",style:{"margin-top":"10%"}},null,8,["title"]))]),_:1})]),_:1},8,["label"]),a(T,{label:s(o)("setting.historyPlayer"),name:"history"},{default:e(()=>[a(R,{style:{height:"78vh"},shadow:"never"},{header:e(()=>[m("div",it,[a(Ve,{content:s(o)("setting.historyPlayerTip"),effect:"light",placement:"top"},{default:e(()=>[m("div",dt,[d(i(s(o)("setting.historyPlayer"))+" ",1),a(j,null,{default:e(()=>[a(s(He))]),_:1})])]),_:1},8,["content"]),m("div",null,[a(r,{size:"default",type:"danger",onClick:ze},{default:e(()=>[d(i(s(o)("setting.historyClean")),1)]),_:1}),a(r,{size:"default",onClick:t[16]||(t[16]=l=>Z(!0))},{default:e(()=>[d(i(s(o)("setting.refresh")),1)]),_:1})])])]),default:e(()=>[he((u(),c(me,{ref:"tableRef",data:X.value,"max-height":s(be)?450:550,border:""},{default:e(()=>[a(f,{label:n.$t("setting.nickName"),prop:"nickname"},null,8,["label"]),a(f,{label:n.$t("setting.role"),prop:"prefab"},{default:e(l=>[l.row.prefab?(u(),c(_,{key:0,type:"success"},{default:e(()=>[d(i(l.row.prefab),1)]),_:2},1024)):(u(),c(_,{key:1,type:"warning"},{default:e(()=>[d(i(s(o)("setting.roleFail")),1)]),_:1}))]),_:1},8,["label"]),a(f,{label:n.$t("setting.age"),prop:"age"},{default:e(l=>[l.row.age?(u(),c(_,{key:0,type:"success"},{default:e(()=>[d(i(l.row.age),1)]),_:2},1024)):(u(),c(_,{key:1,type:"warning"},{default:e(()=>[d(i(s(o)("setting.roleFail")),1)]),_:1}))]),_:1},8,["label"]),a(f,{label:"UID",prop:"uid"}),a(f,{label:n.$t("setting.button.actions"),prop:"actions"},{default:e(l=>[a(ce,{trigger:"hover",onCommand:fe},{dropdown:e(()=>[a(pe,null,{default:e(()=>[a(b,{command:{type:"admin",uid:l.row.uid},disabled:O(l.row.uid)},{default:e(()=>[d(i(s(o)("setting.addAdmin")),1)]),_:2},1032,["command","disabled"]),a(b,{command:{type:"block",uid:l.row.uid},disabled:ue(l.row.uid)},{default:e(()=>[d(i(s(o)("setting.addBlock")),1)]),_:2},1032,["command","disabled"]),a(b,{command:{type:"white",uid:l.row.uid},disabled:re(l.row.uid)},{default:e(()=>[d(i(s(o)("setting.addWhite")),1)]),_:2},1032,["command","disabled"])]),_:2},1024)]),default:e(()=>[a(r,{link:"",type:"primary"},{default:e(()=>[d(i(s(o)("setting.button.actions"))+" ",1),a(j,{class:"el-icon--right"},{default:e(()=>[a(v)]),_:1})]),_:1})]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data","max-height"])),[[ve,Y.value]])]),_:1})]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(ge,{modelValue:q.value,"onUpdate:modelValue":t[18]||(t[18]=l=>q.value=l),"close-on-click-modal":!L.value,"close-on-press-escape":!L.value,"show-close":!L.value,title:s(o)("setting.blockListItems.uploadButton"),width:"45%"},{default:e(()=>[he((u(),c(Ue,{ref_key:"uploadRef",ref:ee,"before-upload":Ce,"http-request":xe,limit:1,drag:""},{tip:e(()=>[m("div",rt,i(s(o)("setting.blockListItems.tips")),1)]),default:e(()=>[a(j,{class:"el-icon--upload"},{default:e(()=>[a(s(We))]),_:1}),m("div",ut,[d(i(s(o)("setting.import.dialog.text1"))+" ",1),m("em",null,i(s(o)("setting.import.dialog.text2")),1)])]),_:1})),[[ve,L.value]])]),_:1},8,["modelValue","close-on-click-modal","close-on-press-escape","show-close","title"]),a(ge,{modelValue:V.value,"onUpdate:modelValue":t[20]||(t[20]=l=>V.value=l),title:s(o)("setting.manualAdd"),width:"60%"},{default:e(()=>[a(Fe,{style:{margin:"30px 20px"}},{default:e(()=>[a(Ae,null,{default:e(()=>[a(H,{modelValue:$.value,"onUpdate:modelValue":t[19]||(t[19]=l=>$.value=l),placeholder:s(o)("setting.uidPlaceholder"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1}),m("div",ft,[a(r,{type:"primary",onClick:De},{default:e(()=>[d(i(s(o)("users.submit")),1)]),_:1})])]),_:1})]),_:1},8,["modelValue","title"])])}}});export{gt as default};
