import{t as g}from"./index-Bc_Rni_F.js";import{_ as Y,u as Z,a as ee,g as te,G as oe,H as ae,d as le,I as ne,c as L,o as se,r as p,w as ce,J as R,K as r,f as re,i as ue,k as t,l as o,m as w,q as f,t as i,j as d,A as ie,a1 as de,D as M,E as x,B as y,C as T,a3 as me}from"./index-5FXYdO3K.js";const pe={class:"page-div"},fe={class:"card-header"},_e=de({name:"toolsBackup"}),he=Object.assign(_e,{setup(ge){const{t:s}=Z(),{isMobile:q}=ee(),m=te(),k=oe();ae();const z=le(),E=ne("refresh");L(()=>m.isDark);const c=L(()=>m.language);se(()=>{b()}),p(!1),p(!1);const N=p([]);p({enable:!1,time:"00:00:00"});const S=p(0),b=()=>{const e={clusterName:m.selectedDstCluster};g.backup.get(e).then(l=>{N.value=l.data.backupFiles,S.value=l.data.diskUsage})},A=e=>{x.confirm(c.value==="zh"?"将执行删除操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",c.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:c.value==="zh"?"确定":"confirm",cancelButtonText:c.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(l,a,u)=>{if(l==="confirm"){a.confirmButtonLoading=!0;const n={clusterName:m.selectedDstCluster,name:e.name};g.backup.delete(n).then(v=>{y(v.message),u()}).catch(()=>{}).finally(()=>{a.confirmButtonLoading=!1,b()})}else u()}}).then(()=>{}).catch(()=>{T(s("home.canceled"))}).finally(()=>{h.value=!1})},I=e=>{x.confirm(c.value==="zh"?"将执行恢复操作，是否继续？":"The RESTORE operation will be performed. Do you want to continue?",c.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:c.value==="zh"?"确定":"confirm",cancelButtonText:c.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(l,a,u)=>{if(l==="confirm"){a.confirmButtonLoading=!0;const n={clusterName:m.selectedDstCluster,name:e.name};g.backupRestore.post(n).then(v=>{y(v.message),u()}).catch(()=>{}).finally(()=>{a.confirmButtonLoading=!1,b()})}else u()}}).then(()=>{}).catch(()=>{T(s("home.canceled"))}).finally(()=>{h.value=!1})},K=()=>{if(B.value.length===0){M(s("tools.backup.deleteTip"));return}x.confirm(c.value==="zh"?"将执行删除操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",c.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:c.value==="zh"?"确定":"confirm",cancelButtonText:c.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(e,l,a)=>{if(e==="confirm"){l.confirmButtonLoading=!0;const u={clusterName:m.selectedDstCluster,names:[]};for(let n of B.value)u.names.push(n.name);g.multiDelete.delete(u).then(n=>{y(n.message),a()}).catch(()=>{}).finally(()=>{l.confirmButtonLoading=!1,b()})}else a()}}).then(()=>{}).catch(()=>{T(s("home.canceled"))})},$=p(),B=p([]),P=e=>{B.value=e},j=e=>{const l={clusterName:m.selectedDstCluster,filename:e.name};g.backupDownload.post(l).then(async a=>{await me(a.data,e.name)}).finally(()=>{h.value=!1})},h=p(!1),V=e=>{let l=e.cmd,a=e.row;switch(h.value=!0,l){case"download":j(a);break;case"restore":I(a);break;case"delete":A(a);break;default:h.value=!1,M("error")}},C=p(!1),O=()=>{C.value=!0;const e={clusterName:m.selectedDstCluster};g.backup.post(e).then(l=>{y(l.message)}).finally(()=>{C.value=!1,b()})},U=()=>{setTimeout(()=>{k.meta.isKeepAlive&&z.removeKeepAliveName(k.name),E(!1),R(()=>{k.meta.isKeepAlive&&z.addKeepAliveName(k.name),E(!0)})},0)};return ce(()=>m.selectedDstCluster,e=>{e&&R(()=>{U()})},{immediate:!1}),(e,l)=>{const a=r("el-button"),u=r("el-progress"),n=r("el-table-column"),v=r("arrow-down"),G=r("el-icon"),D=r("el-dropdown-item"),H=r("el-dropdown-menu"),J=r("el-dropdown"),Q=r("el-table"),F=r("el-row"),W=r("el-card"),X=r("el-col");return re(),ue("div",pe,[t(F,{gutter:10},{default:o(()=>[t(X,{lg:24,md:24,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:o(()=>[t(W,{style:{"min-height":"70vh"},shadow:"never"},{header:o(()=>[w("div",fe,[f(i(d(s)("tools.backup.title2"))+" ",1),w("div",null,[t(a,{loading:C.value,type:"primary",onClick:O},{default:o(()=>[f(i(d(s)("tools.backup.BackupImmediately")),1)]),_:1},8,["loading"]),t(a,{type:"danger",onClick:K},{default:o(()=>[f(i(d(s)("tools.backup.multiDelete")),1)]),_:1})])])]),default:o(()=>[w("div",null,[t(u,{"stroke-width":"20","text-inside":"",style:{"margin-bottom":"20px"},percentage:parseFloat(S.value.toFixed(1))},{default:o(({percentage:_})=>[w("span",null,i(d(s)("tools.backup.processBar"))+i(_)+"%",1)]),_:1},8,["percentage"])]),w("div",null,[t(F,null,{default:o(()=>[t(Q,{ref_key:"tableRef",ref:$,data:N.value,"max-height":d(q)?450:550,border:"",onSelectionChange:P},{default:o(()=>[t(n,{fixed:"left",type:"selection",width:"55"}),t(n,{label:e.$t("tools.backup.tableName"),prop:"name"},null,8,["label"]),t(n,{label:e.$t("tools.backup.size"),prop:"size"},{default:o(_=>[f(i(d(ie)(_.row.size)),1)]),_:1},8,["label"]),t(n,{label:e.$t("tools.backup.tableCreateTime"),prop:"createTime"},null,8,["label"]),t(n,{label:e.$t("setting.button.actions"),prop:"actions",width:"120px"},{default:o(_=>[t(J,{trigger:"click",onCommand:V},{dropdown:o(()=>[t(H,null,{default:o(()=>[t(D,{command:{cmd:"download",row:_.row}},{default:o(()=>[f(i(d(s)("tools.backup.download")),1)]),_:2},1032,["command"]),t(D,{command:{cmd:"restore",row:_.row}},{default:o(()=>[f(i(d(s)("tools.backup.restore")),1)]),_:2},1032,["command"]),t(D,{command:{cmd:"delete",row:_.row}},{default:o(()=>[f(i(d(s)("tools.backup.delete")),1)]),_:2},1032,["command"])]),_:2},1024)]),default:o(()=>[t(a,{loading:h.value,link:"",type:"primary"},{default:o(()=>[f(i(d(s)("setting.button.actions"))+" ",1),t(G,{class:"el-icon--right"},{default:o(()=>[t(v)]),_:1})]),_:1},8,["loading"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data","max-height"])]),_:1})])]),_:1})]),_:1})]),_:1})])}}}),we=Y(he,[["__scopeId","data-v-04a04efd"]]);export{we as default};
