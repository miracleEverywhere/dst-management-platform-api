import{o as de,g as me,c as ce,b as pe,u as _e,a as fe,r as V,R as D,K as r,f as m,i as R,k as l,l as e,m as p,t as u,j as s,q as c,n as f,v as g,F as ve,y as be,a1 as ge,al as j,X as B,B as M,E as he,C as we}from"./index-4XnH3GwD.js";import{S as ye}from"./index-C2znuxH1.js";const xe={class:"page-div"},Ce={class:"card-header"},Ve={class:"tip"},Pe={style:{"margin-top":"5px"}},ke={style:{"margin-top":"5px"}},Ue={class:"tip"},ze={style:{display:"flex","align-items":"center"}},De={class:"el-form-item-msg"},We={style:{display:"flex","justify-content":"flex-end","padding-top":"10px"}},Fe=ge({name:"Users"}),Me=Object.assign(Fe,{setup(Se){de(()=>{k()});const q=me(),d=ce(()=>q.language),O=pe(),{t:o}=_e(),{isMobile:P}=fe(),W=O.userInfo,E=V([]),k=()=>{D.userList.get().then(i=>{E.value=i.data})},Y=i=>{if(i.type==="update"){G(j(i.data));return}i.type==="delete"&&K(j(i.data))},h=V(),a=V({username:"",nickname:"",password:"",disabled:!1,role:"Non-admin",clusterPermission:null,clusterCreationProhibited:!1,maxWorldsPerCluster:2}),A={username:[{required:!0,message:o("users.formValidateMsg.username")}],nickname:[{required:!0,message:o("users.formValidateMsg.nickname")}],password:[{required:!0,message:o("users.formValidateMsg.password")}],disabled:[{required:!0,message:o("users.formValidateMsg.disabled")}],maxWorldsPerCluster:[{required:!0,message:o("users.formValidateMsg.maxWorldsPerCluster")}]},y=V(!1),x=V(!1),C=V(!1),Q=()=>{h.value&&h.value.clearValidate(),C.value=!0,y.value=!0},$=()=>{h.value.validate(i=>{if(i){x.value=!0;const n={username:a.value.username,nickname:a.value.nickname,password:B(a.value.password),disabled:a.value.disabled,role:a.value.role,clusterPermission:a.value.clusterPermission,clusterCreationProhibited:a.value.clusterCreationProhibited,maxWorldsPerCluster:a.value.maxWorldsPerCluster};D.user.post(n).then(_=>{y.value=!1,M(_.message),k()}).finally(()=>{x.value=!1})}})},G=i=>{a.value=i,C.value=!1,y.value=!0},H=()=>{h.value.validate(i=>{if(i){x.value=!0;const n={username:a.value.username,nickname:a.value.nickname,password:B("nicai"),disabled:a.value.disabled,role:a.value.role,clusterPermission:a.value.clusterPermission,clusterCreationProhibited:a.value.clusterCreationProhibited,maxWorldsPerCluster:a.value.maxWorldsPerCluster};D.user.put(n).then(_=>{y.value=!1,h.value&&h.value.resetFields(),M(_.message),k()}).finally(()=>{x.value=!1})}})},K=i=>{he.confirm(d.value==="zh"?"将执行 删除 操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",d.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:d.value==="zh"?"确定":"confirm",cancelButtonText:d.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(n,_,U)=>{if(n==="confirm"){_.confirmButtonLoading=!0;const F={username:i.username,nickname:i.nickname,password:B("nicai"),disabled:i.disabled};D.user.delete(F).then(v=>{M(v.message),k(),U()}).finally(()=>{_.confirmButtonLoading=!1})}else U()}}).then(()=>{}).catch(()=>{we(o("home.canceled"))})},X=()=>{a.value={username:"",nickname:"",password:"",disabled:!1,role:"Non-admin",clusterPermission:null,clusterCreationProhibited:!1}};return(i,n)=>{const _=r("el-button"),U=r("el-collapse-item"),F=r("el-collapse"),v=r("el-table-column"),w=r("el-tag"),J=r("QuestionFilled"),L=r("el-icon"),Z=r("el-tooltip"),ee=r("arrow-down"),T=r("el-dropdown-item"),le=r("el-dropdown-menu"),ae=r("el-dropdown"),te=r("el-table"),se=r("el-card"),z=r("el-col"),I=r("el-row"),S=r("el-input"),b=r("el-form-item"),oe=r("el-option"),ne=r("el-select"),re=r("el-slider"),N=r("el-switch"),ue=r("el-form"),ie=r("el-dialog");return m(),R("div",xe,[l(I,{gutter:10},{default:e(()=>[l(z,{lg:24,md:24,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:e(()=>[l(se,{shadow:"never",style:{"min-height":"70vh"}},{header:e(()=>[p("div",Ce,[p("span",null,u(s(o)("users.accountTitle")),1),l(_,{disabled:s(W).role!=="admin",type:"success",onClick:Q},{default:e(()=>[c(u(s(o)("users.actions.create")),1)]),_:1},8,["disabled"])])]),default:e(()=>[l(F,null,{default:e(()=>[l(U,{title:"Tips"},{default:e(()=>[p("div",Ve,[p("div",null,u(s(o)("users.tip_1")),1),p("div",Pe,u(s(o)("users.tip_2")),1),p("div",ke,u(s(o)("users.tip_3")),1)]),p("div",Ue,[p("div",null,u(s(o)("users.tip_4")),1)])]),_:1})]),_:1}),l(te,{data:E.value,border:"",style:{"margin-top":"10px"}},{default:e(()=>[l(v,{label:s(o)("users.username"),prop:"username"},null,8,["label"]),l(v,{label:s(o)("users.nickname"),prop:"nickname"},null,8,["label"]),l(v,{label:s(o)("users.role"),prop:"role"},{default:e(t=>[l(w,{type:t.row.role==="admin"?"primary":"info"},{default:e(()=>[c(u(t.row.role),1)]),_:2},1032,["type"])]),_:1},8,["label"]),l(v,{label:s(o)("users.disabled")},{default:e(t=>[t.row.disabled?g("",!0):(m(),f(w,{key:0,type:"success"},{default:e(()=>[c(u(d.value==="zh"?"启用":"Enabled"),1)]),_:1})),t.row.disabled?(m(),f(w,{key:1,type:"danger"},{default:e(()=>[c(u(d.value==="zh"?"禁用":"Disabled"),1)]),_:1})):g("",!0)]),_:1},8,["label"]),l(v,{label:s(o)("users.clusterCreationProhibited")},{default:e(t=>[t.row.clusterCreationProhibited?g("",!0):(m(),f(w,{key:0,type:"success"},{default:e(()=>[c(u(d.value==="zh"?"可创建":"Y"),1)]),_:1})),t.row.clusterCreationProhibited?(m(),f(w,{key:1,type:"danger"},{default:e(()=>[c(u(d.value==="zh"?"不可创建":"N"),1)]),_:1})):g("",!0)]),_:1},8,["label"]),l(v,null,{header:e(()=>[p("div",ze,[p("span",null,u(s(o)("users.maxWorldsPerCluster")),1),l(Z,{content:s(o)("users.maxWorldsPerClusterTip"),effect:"light",placement:"top"},{default:e(()=>[l(L,{size:"14",style:{"margin-left":"2px"}},{default:e(()=>[l(J)]),_:1})]),_:1},8,["content"])])]),default:e(t=>[t.row.role==="admin"?(m(),f(w,{key:0,type:"primary"},{default:e(()=>[c(u(d.value==="zh"?"不限制":"No Limits"),1)]),_:1})):(m(),f(w,{key:1,type:"primary"},{default:e(()=>[c(u(t.row.maxWorldsPerCluster),1)]),_:2},1024))]),_:1}),l(v,{label:s(o)("setting.button.actions"),prop:"actions"},{default:e(t=>[l(ae,{disabled:s(W).role!=="admin",trigger:"hover",onCommand:Y},{dropdown:e(()=>[l(le,null,{default:e(()=>[l(T,{command:{type:"update",data:t.row}},{default:e(()=>[c(u(s(o)("users.actions.update")),1)]),_:2},1032,["command"]),l(T,{command:{type:"delete",data:t.row},disabled:t.row.role==="admin"},{default:e(()=>[c(u(s(o)("users.actions.delete")),1)]),_:2},1032,["command","disabled"])]),_:2},1024)]),default:e(()=>[l(_,{disabled:s(W).role!=="admin",link:"",type:"primary"},{default:e(()=>[c(u(s(o)("setting.button.actions"))+" ",1),l(L,{class:"el-icon--right"},{default:e(()=>[l(ee)]),_:1})]),_:1},8,["disabled"])]),_:2},1032,["disabled"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),l(ie,{modelValue:y.value,"onUpdate:modelValue":n[9]||(n[9]=t=>y.value=t),width:"60%",onClosed:X},{default:e(()=>[l(ue,{ref_key:"userDialogFormRef",ref:h,model:a.value,rules:A,"validate-on-rule-change":!1,"label-width":"150","label-position":s(P)?"top":"left",style:{margin:"20px 50px 0 0"}},{default:e(()=>[C.value?(m(),f(b,{key:0,label:s(o)("users.username"),prop:"username"},{default:e(()=>[l(S,{modelValue:a.value.username,"onUpdate:modelValue":n[0]||(n[0]=t=>a.value.username=t)},null,8,["modelValue"])]),_:1},8,["label"])):g("",!0),l(b,{label:s(o)("users.nickname"),prop:"nickname"},{default:e(()=>[l(S,{modelValue:a.value.nickname,"onUpdate:modelValue":n[1]||(n[1]=t=>a.value.nickname=t)},null,8,["modelValue"])]),_:1},8,["label"]),C.value?(m(),f(b,{key:1,label:s(o)("users.password"),prop:"password"},{default:e(()=>[l(S,{modelValue:a.value.password,"onUpdate:modelValue":n[2]||(n[2]=t=>a.value.password=t),autocomplete:"new-password","show-password":""},null,8,["modelValue"]),l(ye,{modelValue:a.value.password,"onUpdate:modelValue":n[3]||(n[3]=t=>a.value.password=t)},null,8,["modelValue"]),p("div",De,u(s(o)("users.suggestedPassword")),1)]),_:1},8,["label"])):g("",!0),l(b,{label:s(o)("users.clusterPermission"),prop:"clusterPermission"},{default:e(()=>[l(ne,{modelValue:a.value.clusterPermission,"onUpdate:modelValue":n[4]||(n[4]=t=>a.value.clusterPermission=t),multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,disabled:a.value.role==="admin"},{default:e(()=>[(m(!0),R(ve,null,be(s(q).dstClusters,t=>(m(),f(oe,{label:t.clusterDisplayName,value:t.clusterName},null,8,["label","value"]))),256))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"]),l(b,{label:s(o)("users.maxWorldsPerCluster"),prop:"maxWorldsPerCluster"},{default:e(()=>[l(re,{modelValue:a.value.maxWorldsPerCluster,"onUpdate:modelValue":n[5]||(n[5]=t=>a.value.maxWorldsPerCluster=t),max:64,min:0,"show-input":!s(P),size:"small"},null,8,["modelValue","show-input"])]),_:1},8,["label"]),l(I,null,{default:e(()=>[l(z,{span:s(P)?24:8},{default:e(()=>[l(b,{label:s(o)("users.disabled"),prop:"disabled"},{default:e(()=>[l(N,{modelValue:a.value.disabled,"onUpdate:modelValue":n[6]||(n[6]=t=>a.value.disabled=t),"active-text":d.value==="zh"?"启用":"Enable","active-value":!1,"inactive-text":d.value==="zh"?"禁用":"Disable","inactive-value":!0,"inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"])]),_:1},8,["span"]),l(z,{span:s(P)?24:8},{default:e(()=>[l(b,{label:s(o)("users.admin"),prop:"role"},{default:e(()=>[l(N,{modelValue:a.value.role,"onUpdate:modelValue":n[7]||(n[7]=t=>a.value.role=t),"active-text":d.value==="zh"?"是":"Enable","inactive-text":d.value==="zh"?"否":"Disable","active-value":"admin","inactive-value":"Non-admin","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"])]),_:1},8,["span"]),l(z,{span:s(P)?24:8},{default:e(()=>[l(b,{label:s(o)("users.clusterCreationProhibited"),prop:"role"},{default:e(()=>[l(N,{modelValue:a.value.clusterCreationProhibited,"onUpdate:modelValue":n[8]||(n[8]=t=>a.value.clusterCreationProhibited=t),"active-text":d.value==="zh"?"可创建":"Y","active-value":!1,"inactive-text":d.value==="zh"?"不可创建":"Y","inactive-value":!0,"inline-prompt":"",disabled:a.value.role==="admin",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","active-text","inactive-text","disabled"])]),_:1},8,["label"])]),_:1},8,["span"])]),_:1}),p("div",We,[C.value?(m(),f(_,{key:0,loading:x.value,type:"primary",onClick:$},{default:e(()=>[c(u(s(o)("users.submit")),1)]),_:1},8,["loading"])):g("",!0),C.value?g("",!0):(m(),f(_,{key:1,loading:x.value,type:"primary",onClick:H},{default:e(()=>[c(u(s(o)("users.submit")),1)]),_:1},8,["loading"]))])]),_:1},8,["model","label-position"])]),_:1},8,["modelValue"])])}}});export{Me as default};
