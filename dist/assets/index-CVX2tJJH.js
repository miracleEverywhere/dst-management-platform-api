import{o as ue,u as re,g as ce,G as ie,H as de,d as me,I as pe,c as T,r as f,a2 as g,w as fe,J as O,K as d,L as _e,f as b,i as R,k as t,l as e,j as s,m as h,t as u,p as H,n as N,q as m,v as ve,a1 as ge,D as be,B as P,E as G,C as J}from"./index-DRaBk72F.js";const he={class:"page-div"},ye={class:"tip_warning"},we={class:"tip_success",style:{"margin-top":"20px"}},Ce={class:"fcc",style:{"font-size":"20px"}},De={key:0},Ne={class:"tip"},ke={style:{margin:"20px"}},xe={style:{display:"flex","justify-content":"flex-end","padding-top":"10px"}},Ve=ge({name:"Clusters"}),Te=Object.assign(Ve,{setup(ze){ue(()=>{A(),I()});const{t:a}=re(),i=ce(),C=ie();de();const L=me(),S=pe("refresh"),Q=T(()=>i.isDark),p=T(()=>i.language),U="info",k=f(!1),x=f(!1),E=T(()=>k.value||x.value),V=f([]),A=()=>{k.value=!0,g.clusters.get().then(n=>{V.value=n.data}).finally(()=>{k.value=!1})},z=f([]),j=f(0),q=f(0),I=()=>{x.value=!0,g.clustersWorldPort.get().then(n=>{z.value=n.data;let o=[];for(let r of z.value)if(r.worldPort!==null)for(let c of r.worldPort)o.push(c);j.value=o.length,q.value=new Set(o).size}).finally(()=>{x.value=!1})},X=()=>{g.clusters.get().then(n=>{i.dstClusters=n.data,i.selectedDstCluster===null&&i.dstClusters!==null&&(i.selectedDstCluster=i.dstClusters[0].clusterName)})},D=f(!1),B=f(!1),_=f({clusterName:"",clusterDisplayName:""}),Y=n=>{_.value={clusterName:n.clusterName,clusterDisplayName:""},D.value=!0},Z=()=>{if(_.value===""){be(p.value==="zh"?"请输入集群昵称":"cluster nickname is required");return}B.value=!0,g.cluster.put(_.value).then(n=>{g.clusters.get().then(o=>{V.value=o.data,i.dstClusters=o.data}),P(n.message),D.value=!1}).finally(()=>{B.value=!1})},ee=n=>{G.confirm(p.value==="zh"?"将执行 删除集群 操作，是否继续？":"The cluster DELETE operation will be performed. Do you want to continue?",p.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:p.value==="zh"?"确定":"confirm",cancelButtonText:p.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(o,r,c)=>{if(o==="confirm"){r.confirmButtonLoading=!0;const v={clusterName:n};g.cluster.delete(v).then(async y=>{P(y.message),await A(),await I(),await X(),i.selectedDstCluster===n&&i.dstClusters!==null&&(i.selectedDstCluster=i.dstClusters[0].clusterName),c()}).catch(()=>{}).finally(()=>{r.confirmButtonLoading=!1})}else c()}}).then(()=>{}).catch(()=>{J(a("home.canceled"))})},te=n=>{G.confirm(p.value==="zh"?"将执行 关闭集群 操作，是否继续？":"The cluster SHUTDOWN operation will be performed. Do you want to continue?",p.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:p.value==="zh"?"确定":"confirm",cancelButtonText:p.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(o,r,c)=>{if(o==="confirm"){r.confirmButtonLoading=!0;const v={clusterName:n};g.cluster.shutdown.post(v).then(async y=>{P(y.message),c()}).catch(()=>{}).finally(()=>{r.confirmButtonLoading=!1})}else c()}}).then(()=>{}).catch(()=>{J(a("home.canceled"))})},le=()=>{setTimeout(()=>{C.meta.isKeepAlive&&L.removeKeepAliveName(C.name),S(!1),O(()=>{C.meta.isKeepAlive&&L.addKeepAliveName(C.name),S(!0)})},0)};return fe(()=>i.selectedDstCluster,n=>{n&&O(()=>{le()})},{immediate:!1}),(n,o)=>{const r=d("el-tag"),c=d("el-table-column"),v=d("el-button"),y=d("el-tooltip"),K=d("el-table"),M=d("el-tab-pane"),ae=d("el-alert"),se=d("el-tabs"),W=d("el-input"),$=d("el-form-item"),oe=d("el-form"),ne=d("el-dialog"),F=_e("loading");return b(),R("div",he,[t(se,{modelValue:U,"onUpdate:modelValue":o[0]||(o[0]=l=>U=l)},{default:e(()=>[t(M,{label:s(a)("clusters.tab.pane1"),name:"info"},{default:e(()=>[h("div",ye,u(s(a)("clusters.tip1")),1),H((b(),N(K,{data:V.value,border:""},{default:e(()=>[t(c,{label:s(a)("clusters.table.name")},{default:e(l=>[t(r,{type:"primary"},{default:e(()=>[m(u(l.row.clusterName),1)]),_:2},1024)]),_:1},8,["label"]),t(c,{label:s(a)("clusters.table.displayName")},{default:e(l=>[t(r,{type:"success"},{default:e(()=>[m(u(l.row.clusterDisplayName),1)]),_:2},1024)]),_:1},8,["label"]),t(c,{label:s(a)("clusters.table.world")},{default:e(l=>[t(r,{type:"info"},{default:e(()=>{var w;return[m(u(((w=l.row.worlds)==null?void 0:w.length)||0),1)]}),_:2},1024)]),_:1},8,["label"]),t(c,{label:s(a)("clusters.table.actions")},{default:e(l=>[t(y,{content:s(a)("clusters.table.shutdownTip"),effect:"light",placement:"top"},{default:e(()=>[t(v,{size:"small",type:"primary",onClick:w=>te(l.row.clusterName)},{default:e(()=>[m(u(s(a)("clusters.table.shutdown")),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"]),t(v,{size:"small",type:"warning",onClick:w=>Y(l.row)},{default:e(()=>[m(u(s(a)("clusters.table.update")),1)]),_:2},1032,["onClick"]),t(v,{size:"small",type:"danger",onClick:w=>ee(l.row.clusterName)},{default:e(()=>[m(u(s(a)("clusters.table.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[F,E.value]])]),_:1},8,["label"]),t(M,{label:s(a)("clusters.tab.pane2"),name:"port"},{default:e(()=>[h("div",we,u(s(a)("clusters.tip2")),1),q.value!==j.value?(b(),N(ae,{key:0,effect:Q.value?"light":"dark",type:"error",closable:!1,style:{"margin-bottom":"10px"}},{title:e(()=>[h("div",Ce,u(s(a)("clusters.tip3")),1)]),_:1},8,["effect"])):ve("",!0),H((b(),N(K,{data:z.value,border:""},{default:e(()=>[t(c,{label:s(a)("clusters.table.name")},{default:e(l=>[t(r,{type:"primary"},{default:e(()=>[m(u(l.row.clusterName),1)]),_:2},1024)]),_:1},8,["label"]),t(c,{label:s(a)("clusters.table.displayName")},{default:e(l=>[t(r,{type:"success"},{default:e(()=>[m(u(l.row.clusterDisplayName),1)]),_:2},1024)]),_:1},8,["label"]),t(c,{label:s(a)("clusters.table.port")},{default:e(l=>[l.row.worldPort?(b(),R("span",De,u(l.row.worldPort.join(",")),1)):(b(),N(r,{key:1,type:"info"},{default:e(()=>[m(u(s(a)("clusters.table.none")),1)]),_:1}))]),_:1},8,["label"])]),_:1},8,["data"])),[[F,E.value]])]),_:1},8,["label"])]),_:1}),t(ne,{modelValue:D.value,"onUpdate:modelValue":o[3]||(o[3]=l=>D.value=l),width:"65%"},{header:e(()=>[m(u(s(a)("clusters.updateDialog.title")),1)]),default:e(()=>[h("div",Ne,u(s(a)("clusters.updateDialog.tip1")),1),h("div",ke,[t(oe,{model:_.value},{default:e(()=>[t($,{label:s(a)("clusters.updateDialog.clusterName")},{default:e(()=>[t(W,{disabled:"",modelValue:_.value.clusterName,"onUpdate:modelValue":o[1]||(o[1]=l=>_.value.clusterName=l)},null,8,["modelValue"])]),_:1},8,["label"]),t($,{label:s(a)("clusters.updateDialog.newDisplayName")},{default:e(()=>[t(W,{modelValue:_.value.clusterDisplayName,"onUpdate:modelValue":o[2]||(o[2]=l=>_.value.clusterDisplayName=l)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"]),h("div",xe,[t(v,{type:"primary",onClick:Z,loading:B.value},{default:e(()=>[m(u(p.value==="zh"?"更新":"Update"),1)]),_:1},8,["loading"])])])]),_:1},8,["modelValue"])])}}});export{Te as default};
