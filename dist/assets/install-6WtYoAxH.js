import{o as L,u as H,g as J,c as M,a as Q,r as m,az as W,e as X,K as c,f as u,i as V,k as t,l as e,z as $,j as a,m as _,t as s,q as i,n as f,v as B,a1 as Y,B as Z}from"./index-BQEj5pez.js";import{t as k}from"./index-BTfoBlJa.js";import{e as ee}from"./index-DJuj0PZV.js";const te={class:"page-div"},le={class:"card-header"},se={class:"card-header"},ae={style:{"margin-top":"5px"}},oe={class:"card-header"},ne={style:{"margin-top":"10px"}},ie={key:0},ce={key:1},re=Y({name:"toolsInstall"}),me=Object.assign(re,{setup(ue){L(()=>{q(),O(),j()});const{t:o}=H(),N=J(),x=M(()=>N.language),{isMobile:w}=Q(),T=M(()=>N.isDark),d=m(!1),p=m(0),g=m({zh:"",en:""}),n=m({}),q=()=>{k.osInfo.get().then(l=>{n.value=l.data,n.value.Uptime=W(l.data.Uptime,x.value)})},P=()=>{k.install.post().then(l=>{Z(l.message),d.value=!0,U()})},A=()=>{k.installStatus.get().then(l=>{const y=l.data;p.value=y.process,g.value.zh=y.zh,g.value.en=y.en,(p.value==="100"||p.value===0)&&h()})},C=m({server:-1,local:-1}),O=()=>{ee.dstVersion.get().then(l=>{l.data&&(C.value=l.data)})},j=()=>{k.isInstalling.get().then(l=>{l.data&&(d.value=!0,U())})};let v=null;const U=()=>{v=setInterval(()=>{A()},1e3)},h=()=>{d.value=!1,v&&(clearInterval(v),v=null)};return X(()=>{h(),window.removeEventListener("beforeunload",h)}),(l,y)=>{const r=c("el-descriptions-item"),E=c("el-descriptions"),I=c("el-card"),b=c("el-col"),S=c("el-button"),D=c("el-result"),G=c("el-text"),z=c("el-row"),R=c("el-alert"),F=c("el-tag"),K=c("el-progress");return u(),V("div",te,[t(z,{gutter:20},{default:e(()=>[t(b,{lg:12,md:12,sm:24,span:12,xs:24},{default:e(()=>[t(I,{style:$(a(w)?"min-height: 300px":"min-height: 500px"),shadow:"never"},{header:e(()=>[_("span",le,s(a(o)("tools.install.systemInfo")),1)]),default:e(()=>[t(E,{column:1,border:""},{default:e(()=>[t(r,{label:l.$t("tools.install.architecture")},{default:e(()=>[i(s(n.value.Architecture),1)]),_:1},8,["label"]),t(r,{label:l.$t("tools.install.osType")},{default:e(()=>[i(s(n.value.OS),1)]),_:1},8,["label"]),t(r,{label:l.$t("tools.install.osName")},{default:e(()=>[i(s(n.value.Platform),1)]),_:1},8,["label"]),t(r,{label:l.$t("tools.install.osVersion")},{default:e(()=>[i(s(n.value.PlatformVersion),1)]),_:1},8,["label"]),t(r,{label:"CPU"},{default:e(()=>[i(s(n.value.CPUModel),1)]),_:1}),t(r,{label:a(o)("tools.install.cpuCore")},{default:e(()=>[i(s(n.value.CPUCores),1)]),_:1},8,["label"]),t(r,{label:l.$t("tools.install.memory")},{default:e(()=>[i(s((n.value.MemorySize/1024**3).toFixed(2))+" GB ",1)]),_:1},8,["label"]),t(r,{label:l.$t("tools.install.uptime")},{default:e(()=>[i(s(n.value.Uptime),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["style"])]),_:1}),t(b,{lg:12,md:12,sm:24,span:12,style:$(a(w)?"margin-top: 20px":"margin-top: 0px"),xs:24},{default:e(()=>[t(I,{style:$(a(w)?"min-height: 300px":"min-height: 500px"),shadow:"never"},{header:e(()=>[_("span",se,s(l.$t("tools.install.installCheck")),1)]),default:e(()=>[n.value.Platform==="ubuntu"||n.value.Platform==="centos"||n.value.Platform==="rocky"?(u(),f(D,{key:0,"sub-title":C.value.local>-1?a(o)("tools.install.checkPassDesc1"):a(o)("tools.install.checkPassDesc"),title:a(o)("tools.install.checkPass"),icon:"success"},{extra:e(()=>[C.value.local>-1?(u(),f(S,{key:0,loading:d.value,type:"warning",onClick:P},{default:e(()=>[i(s(a(o)("tools.install.reinstall")),1)]),_:1},8,["loading"])):(u(),f(S,{key:1,loading:d.value,type:"primary",onClick:P},{default:e(()=>[i(s(a(o)("tools.install.install")),1)]),_:1},8,["loading"]))]),_:1},8,["sub-title","title"])):(u(),f(D,{key:1,"sub-title":a(o)("tools.install.checkNotPassDesc"),title:a(o)("tools.install.checkNotPass"),icon:"warning"},{extra:e(()=>[_("div",null,[t(S,{disabled:n.value.Platform==="darwin",loading:d.value,type:"warning",onClick:P},{default:e(()=>[i(s(a(o)("tools.install.install")),1)]),_:1},8,["disabled","loading"])]),_("div",ae,[t(G,{type:"info"},{default:e(()=>[i(s(a(o)("tools.install.macosTip")),1)]),_:1})])]),_:1},8,["sub-title","title"]))]),_:1},8,["style"])]),_:1},8,["style"])]),_:1}),t(z,{gutter:20},{default:e(()=>[t(b,{lg:24,md:24,sm:24,span:24,xs:24,style:{"margin-top":"20px"}},{default:e(()=>[t(R,{closable:!1,effect:T.value?"light":"dark",type:"success"},{default:e(()=>[i(s(a(o)("tools.install.installTip")),1)]),_:1},8,["effect"])]),_:1})]),_:1}),d.value?(u(),f(z,{key:0,gutter:20},{default:e(()=>[t(b,{lg:24,md:24,sm:24,span:24,xs:24,style:{"margin-top":"20px"}},{default:e(()=>[t(I,{shadow:"never",style:{"min-height":"250px"}},{header:e(()=>[_("div",oe,[_("span",null,s(a(o)("tools.install.installProgress")),1),t(F,{style:{"font-weight":"lighter"},type:"warning"},{default:e(()=>[i(s(a(o)("tools.install.noClose")),1)]),_:1})])]),default:e(()=>[t(K,{percentage:p.value,status:p.value===100?"success":"","stroke-width":15,striped:"","striped-flow":""},null,8,["percentage","status"]),_("div",ne,[x.value==="zh"?(u(),V("span",ie,s(g.value.zh),1)):B("",!0),x.value==="en"?(u(),V("span",ce,s(g.value.en),1)):B("",!0)])]),_:1})]),_:1})]),_:1})):B("",!0)])}}});export{me as default};
