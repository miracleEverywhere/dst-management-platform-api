import{t as w}from"./index-C6Uy4rQt.js";import{_ as Z,u as ee,a as te,g as oe,G as ae,H as le,d as ne,I as se,c as F,o as ce,r as f,w as re,J as R,K as r,f as ue,i as ie,k as e,l as t,m as k,q as _,t as d,j as s,A as de,a1 as me,D as M,E as D,B as y,C as T,ap as pe}from"./index-DubB-sHn.js";const fe={class:"page-div"},_e={class:"card-header"},he=me({name:"toolsBackup"}),ge=Object.assign(he,{setup(be){const{t:a}=ee(),{isMobile:A}=te(),i=oe(),v=ae();le();const z=ne(),E=se("refresh");F(()=>i.isDark);const u=F(()=>i.language);ce(()=>{g()}),f(!1),f(!1);const S=f([]);f({enable:!1,time:"00:00:00"});const N=f(0),g=()=>{const o={clusterName:i.selectedDstCluster};w.backup.get(o).then(l=>{S.value=l.data.backupFiles,N.value=l.data.diskUsage})},$=o=>{D.confirm(u.value==="zh"?"将执行删除操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",u.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:u.value==="zh"?"确定":"confirm",cancelButtonText:u.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(l,n,m)=>{if(l==="confirm"){n.confirmButtonLoading=!0;const c={clusterName:i.selectedDstCluster,name:o.name};w.backup.delete(c).then(b=>{y(b.message),m()}).catch(()=>{}).finally(()=>{n.confirmButtonLoading=!1,g()})}else m()}}).then(()=>{}).catch(()=>{T(a("home.canceled"))}).finally(()=>{h.value=!1})},q=o=>{D.confirm(u.value==="zh"?"将执行恢复操作，是否继续？":"The RESTORE operation will be performed. Do you want to continue?",u.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:u.value==="zh"?"确定":"confirm",cancelButtonText:u.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(l,n,m)=>{if(l==="confirm"){n.confirmButtonLoading=!0;const c={clusterName:i.selectedDstCluster,name:o.name};w.backupRestore.post(c).then(b=>{y(b.message),m()}).catch(()=>{}).finally(()=>{n.confirmButtonLoading=!1,g()})}else m()}}).then(()=>{}).catch(()=>{T(a("home.canceled"))}).finally(()=>{h.value=!1})},I=()=>{if(B.value.length===0){M(a("tools.backup.deleteTip"));return}D.confirm(u.value==="zh"?"将执行删除操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",u.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:u.value==="zh"?"确定":"confirm",cancelButtonText:u.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(o,l,n)=>{if(o==="confirm"){l.confirmButtonLoading=!0;const m={clusterName:i.selectedDstCluster,names:[]};for(let c of B.value)m.names.push(c.name);w.multiDelete.delete(m).then(c=>{y(c.message),n()}).catch(()=>{}).finally(()=>{l.confirmButtonLoading=!1,g()})}else n()}}).then(()=>{}).catch(()=>{T(a("home.canceled"))})},K=f(),B=f([]),P=o=>{B.value=o},j=o=>{let l=`/v1/download/backup/${i.selectedDstCluster}/${o.name}?authorization=${pe()}&&clusterName=${i.selectedDstCluster}&&lang=${i.language}`;window.open(l,"_blank"),h.value=!1},h=f(!1),V=o=>{let l=o.cmd,n=o.row;switch(h.value=!0,l){case"download":j(n);break;case"restore":q(n);break;case"delete":$(n);break;default:h.value=!1,M("error")}},C=f(!1),O=()=>{C.value=!0;const o={clusterName:i.selectedDstCluster};w.backup.post(o).then(l=>{y(l.message)}).finally(()=>{C.value=!1,g()})},U=()=>{setTimeout(()=>{v.meta.isKeepAlive&&z.removeKeepAliveName(v.name),E(!1),R(()=>{v.meta.isKeepAlive&&z.addKeepAliveName(v.name),E(!0)})},0)};return re(()=>i.selectedDstCluster,o=>{o&&R(()=>{U()})},{immediate:!1}),(o,l)=>{const n=r("el-button"),m=r("el-progress"),c=r("el-table-column"),b=r("el-tag"),G=r("arrow-down"),H=r("el-icon"),x=r("el-dropdown-item"),J=r("el-dropdown-menu"),Q=r("el-dropdown"),W=r("el-table"),L=r("el-row"),X=r("el-card"),Y=r("el-col");return ue(),ie("div",fe,[e(L,{gutter:10},{default:t(()=>[e(Y,{lg:24,md:24,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:t(()=>[e(X,{style:{"min-height":"70vh"},shadow:"never"},{header:t(()=>[k("div",_e,[_(d(s(a)("tools.backup.title2"))+" ",1),k("div",null,[e(n,{loading:C.value,type:"primary",onClick:O},{default:t(()=>[_(d(s(a)("tools.backup.BackupImmediately")),1)]),_:1},8,["loading"]),e(n,{type:"danger",onClick:I},{default:t(()=>[_(d(s(a)("tools.backup.multiDelete")),1)]),_:1})])])]),default:t(()=>[k("div",null,[e(m,{"stroke-width":"20","text-inside":"",style:{"margin-bottom":"20px"},percentage:parseFloat(N.value.toFixed(1))},{default:t(({percentage:p})=>[k("span",null,d(s(a)("tools.backup.processBar"))+d(p)+"%",1)]),_:1},8,["percentage"])]),k("div",null,[e(L,null,{default:t(()=>[e(W,{ref_key:"tableRef",ref:K,data:S.value,"max-height":s(A)?450:550,border:"",onSelectionChange:P},{default:t(()=>[e(c,{fixed:"left",type:"selection",width:"55"}),e(c,{label:s(a)("tools.backup.tableCreateTime"),prop:"createTime"},null,8,["label"]),e(c,{label:s(a)("tools.backup.cycles"),prop:"cycles"},{default:t(p=>[e(b,{type:"info"},{default:t(()=>[_(d(p.row.cycles),1)]),_:2},1024)]),_:1},8,["label"]),e(c,{label:s(a)("tools.backup.size"),prop:"size"},{default:t(p=>[_(d(s(de)(p.row.size)),1)]),_:1},8,["label"]),e(c,{label:s(a)("setting.button.actions"),prop:"actions",width:"120px"},{default:t(p=>[e(Q,{trigger:"click",onCommand:V},{dropdown:t(()=>[e(J,null,{default:t(()=>[e(x,{command:{cmd:"download",row:p.row}},{default:t(()=>[_(d(s(a)("tools.backup.download")),1)]),_:2},1032,["command"]),e(x,{command:{cmd:"restore",row:p.row}},{default:t(()=>[_(d(s(a)("tools.backup.restore")),1)]),_:2},1032,["command"]),e(x,{command:{cmd:"delete",row:p.row}},{default:t(()=>[_(d(s(a)("tools.backup.delete")),1)]),_:2},1032,["command"])]),_:2},1024)]),default:t(()=>[e(n,{loading:h.value,link:"",type:"primary"},{default:t(()=>[_(d(s(a)("setting.button.actions"))+" ",1),e(H,{class:"el-icon--right"},{default:t(()=>[e(G)]),_:1})]),_:1},8,["loading"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data","max-height"])]),_:1})])]),_:1})]),_:1})]),_:1})])}}}),ve=Z(ge,[["__scopeId","data-v-ac4096d9"]]);export{ve as default};
