import{_ as dt,o as st,u as it,a as rt,g as ut,b as ct,c as ve,r as c,a0 as w,X as mt,B as gt,J as u,K as ft,f as s,i as p,l as t,m as e,j as l,s as X,q as g,n as f,y as pt,z as I,p as r,t as i,F as N,x as Y,aa as vt,v as k,ab as _t,A as x,C as Te}from"./index-D1LqIXa4.js";import{e as Ee}from"./index-ERnfud0Y.js";import{t as ht}from"./index-D-69yoTU.js";import bt from"./modInfo-AW6Pvy3u.js";import{f as yt}from"./tools-DGywyC8M.js";const wt={class:"page-div"},kt={class:"item-container"},Ct={class:"card-footer",style:{"margin-top":"20px"}},xt={class:"card-header"},Dt={class:"fcc"},Mt={key:0},St={key:1},zt={class:"tip"},Ft={style:{"font-size":"14px"}},Ut={key:0,style:{display:"flex"}},Vt={style:{display:"flex","margin-left":"5px","flex-direction":"column","justify-content":"center"}},Lt={key:1,style:{display:"flex"}},It={style:{display:"flex","margin-left":"5px","flex-direction":"column","justify-content":"center"}},Nt={class:"card-header"},Tt={key:1},Et={key:0,class:"tip custom-block"},Rt={key:1,class:"tip custom-block"},qt={__name:"mod",setup(Bt){st(async()=>{_e.value=window.innerHeight,window.addEventListener("resize",()=>{_e.value=window.innerHeight}),await q(),await A(),Qe()});const{t:d}=it(),{isMobile:b}=rt(),C=ut(),Re=ct(),qe=ve(()=>C.isDark),Z=ve(()=>C.language),_e=c(0),he=Re.userInfo,be=c("Download"),Be=(a,n)=>{a.paneName==="Add"&&z(),a.paneName==="Setting"&&A()},y=c([]),ee=c(!1),T=c(!1),A=()=>{ee.value=!0,_.value=0,E.value="";const a={clusterName:C.selectedDstCluster};w.mod.settingFormat.get(a).then(n=>{n.data===5e3&&(T.value=!0,mt(n.message)),y.value=n.data;for(let v of y.value)v.id===1&&($.value=!0)}).finally(()=>{ee.value=!1})},_=c(0),E=c(""),P=(a,n)=>{_.value=a,E.value=n,$e()},R=c(!1),G=c({id:"",configOptions:[]}),$e=()=>{R.value=!0;const a={clusterName:C.selectedDstCluster,id:_.value};w.mod.configOptions.get(a).then(n=>{G.value=n.data}).finally(()=>{R.value=!1})},Oe=()=>{R.value=!0;const a={clusterName:C.selectedDstCluster,modFormattedData:y.value};w.mod.configChange.post(a).then(n=>{x(n.message)}).finally(()=>{R.value=!1})},te=c(!1),j=c({total:0,rows:[]}),Ae=c(),h=c({page:1,pageSize:30,searchText:"",searchType:"text"}),q=(a=!0)=>{a&&(h.value.page=1),te.value=!0,Ee.modSearch.get(h.value).then(n=>{j.value.rows=n.data.rows,j.value.total=n.data.total,h.value.searchType==="id"&&gt(Z.value==="zh"?"ID搜索不显示评分":"Search by ID will not display the vote data")}).finally(()=>{te.value=!1})},Pe=a=>{q(!1)},Ge=a=>{q(!1)},le=c([]),ae=c(!1),z=()=>{ae.value=!0,Ee.modInfoDownloaded.get().then(a=>{le.value=a.data}).finally(()=>{ae.value=!1})},S=c([]),je=a=>{S.value=a},oe=c(!1),ye=()=>{oe.value=!0;const a={clusterName:C.selectedDstCluster};w.mod.sync.post(a).then(n=>{x(n.message),z()}).finally(()=>{oe.value=!1})},F=c(!1),we=a=>{let n=a.cmd,v=a.row;switch(F.value=!0,n){case"enable":ke(v);break;case"delete":Ce(v);break;case"update":He(v),F.value=!1;break;case"refresh":z();break;case"sync":ye();break;case"multiDelete":De();break;case"multiEnable":Se();break;case"addClientDisabled":Me();break;default:F.value=!1,Te("error")}},ke=async(a,n=!1)=>{const v=a.file_url==="",U={clusterName:C.selectedDstCluster,isUgc:v,id:a.id};try{const m=await w.mod.enable.post(U);m.code===200&&(n||x(m.message))}catch(m){Te(m)}F.value=!1},Ce=(a,n=!1)=>{const U={isUgc:a.file_url==="",id:a.id};w.mod.delete.post(U).then(m=>{n||(z(),x(m.message))}).finally(()=>{F.value=!1})},He=a=>{const n={id:a.id,file_url:a.file_url};w.mod.download.post(n).then(v=>{x(v.message)})},xe=c(!1),De=async()=>{xe.value=!0;for(let a of S.value)await Ce(a,!0);xe.value=!1,z()},B=c(!1),Ke=()=>{if(_.value===1){B.value=!0;const a={clusterName:C.selectedDstCluster};w.mod.deleteClintModsDisabled.post(a).then(n=>{x(n.message),A(),$.value=!1}).finally(()=>{B.value=!1})}else{B.value=!0;const a=E.value==="",n={clusterName:C.selectedDstCluster,isUgc:a,id:_.value};w.mod.disable.post(n).then(v=>{x(v.message),A()}).finally(()=>{B.value=!1})}},ne=c(""),Qe=()=>{ht.osInfo.get().then(a=>{ne.value=a.data.Platform})},de=c(!1),Je=()=>{de.value=!0,w.mod.macosExport.post().then(a=>{x(a.message)}).finally(()=>{de.value=!1})},se=c(!1),We=()=>{se.value=!0;const a={clusterName:C.selectedDstCluster,isUgc:E.value==="",id:_.value,fileURL:E.value};w.mod.update.post(a).then(n=>{x(n.message)}).finally(()=>{se.value=!1})},Xe=new URL("data:image/svg+xml,%3csvg%20t='1740385485405'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='25932'%20width='200'%20height='200'%3e%3cpath%20d='M512%20938.666667C276.352%20938.666667%2085.333333%20747.648%2085.333333%20512S276.352%2085.333333%20512%2085.333333s426.666667%20191.018667%20426.666667%20426.666667-191.018667%20426.666667-426.666667%20426.666667z%20m208.682667-575.018667a257.706667%20257.706667%200%200%200-60.330667-60.330667l-357.034667%20357.034667a257.706667%20257.706667%200%200%200%2060.330667%2060.330667l357.034667-357.034667z'%20p-id='25933'%3e%3c/path%3e%3c/svg%3e",import.meta.url).href;c(!1);const $=c(!1),ie=c(!1),Me=()=>{ie.value=!0;const a={clusterName:C.selectedDstCluster};w.mod.addClintModsDisabled.post(a).then(n=>{x(n.message)}).finally(()=>{ie.value=!1,$.value=!0})},H=c(""),Ye=ve(()=>H.value?le.value.filter(a=>a.name.toLowerCase().includes(H.value.toLowerCase())):le.value),re=c(!1),Se=async()=>{re.value=!0;for(let a of S.value)await ke(a,!0);re.value=!1,x(Z.value==="zh"?"启用成功":"Enable success")};return(a,n)=>{const v=u("el-option"),U=u("el-select"),m=u("el-button"),ze=u("el-input"),K=u("el-form-item"),Fe=u("el-form"),ue=u("el-scrollbar"),Ze=u("el-pagination"),Q=u("el-card"),ce=u("el-tab-pane"),et=u("QuestionFilled"),J=u("el-icon"),me=u("el-tooltip"),Ue=u("arrow-down"),D=u("el-dropdown-item"),Ve=u("el-dropdown-menu"),Le=u("el-dropdown"),tt=u("el-alert"),lt=u("el-link"),V=u("el-table-column"),ge=u("el-text"),at=u("el-table"),fe=u("el-col"),Ie=u("el-row"),Ne=u("el-image"),L=u("el-tag"),ot=u("el-divider"),pe=u("el-result"),nt=u("el-tabs"),W=ft("loading");return s(),p("div",wt,[t(nt,{modelValue:be.value,"onUpdate:modelValue":n[7]||(n[7]=o=>be.value=o),onTabClick:Be},{default:e(()=>[t(ce,{label:l(d)("setting.mod.tab.download"),name:"Download"},{default:e(()=>[X((s(),g(Q,{shadow:"never",style:{height:"78vh"}},{default:e(()=>[f("div",null,[t(Fe,{ref_key:"modSearchFormRef",ref:Ae,inline:!0,model:h.value,onKeyup:pt(q,["enter"])},{default:e(()=>[t(K,null,{default:e(()=>[t(ze,{modelValue:h.value.searchText,"onUpdate:modelValue":n[1]||(n[1]=o=>h.value.searchText=o),style:I(l(b)?"width: 75vw;":"width: 50vw;")},{prepend:e(()=>[t(U,{modelValue:h.value.searchType,"onUpdate:modelValue":n[0]||(n[0]=o=>h.value.searchType=o),style:{width:"85px"}},{default:e(()=>[t(v,{label:a.$t("setting.mod.download.searchTypeText"),value:"text"},null,8,["label"]),t(v,{label:a.$t("setting.mod.download.searchTypeId"),value:"id"},null,8,["label"])]),_:1},8,["modelValue"])]),append:e(()=>[t(m,{type:"primary",onClick:q},{default:e(()=>[r(i(l(d)("setting.mod.download.search")),1)]),_:1})]),_:1},8,["modelValue","style"])]),_:1})]),_:1},8,["model"])]),f("div",null,[t(ue,{"max-height":"60vh"},{default:e(()=>[f("div",kt,[(s(!0),p(N,null,Y(j.value.rows,o=>(s(),g(bt,{mod:o},null,8,["mod"]))),256))])]),_:1})]),f("div",Ct,[t(Ze,{"current-page":h.value.page,"onUpdate:currentPage":n[2]||(n[2]=o=>h.value.page=o),"page-size":h.value.pageSize,"onUpdate:pageSize":n[3]||(n[3]=o=>h.value.pageSize=o),"page-sizes":[10,20,30,40,50,100],total:j.value.total,layout:"total, sizes, prev, pager, next",onSizeChange:n[4]||(n[4]=o=>Pe(h.value.pageSize)),onCurrentChange:n[5]||(n[5]=o=>Ge(h.value.page))},null,8,["current-page","page-size","total"])])]),_:1})),[[W,te.value]])]),_:1},8,["label"]),t(ce,{label:l(d)("setting.mod.tab.add"),name:"Add"},{default:e(()=>[t(Ie,{gutter:10},{default:e(()=>[t(fe,{span:24},{default:e(()=>[X((s(),g(Q,{shadow:"never",style:{height:"78vh"}},{header:e(()=>[f("div",xt,[f("div",Dt,[r(i(l(d)("setting.mod.add.header.title"))+" ",1),t(me,{content:l(d)("setting.mod.add.header.tip"),effect:"light",placement:"top"},{default:e(()=>[t(J,{size:"14",style:{"margin-left":"2px"}},{default:e(()=>[t(et)]),_:1})]),_:1},8,["content"])]),l(b)?(s(),p("div",St,[t(Le,{trigger:"click",onCommand:we},{dropdown:e(()=>[t(Ve,null,{default:e(()=>[t(D,{command:{cmd:"refresh",row:""}},{default:e(()=>[r(i(l(d)("setting.mod.add.header.refresh")),1)]),_:1}),t(D,{command:{cmd:"sync",row:""}},{default:e(()=>[r(i(l(d)("setting.mod.add.header.sync")),1)]),_:1}),t(D,{disabled:l(he).role!=="admin"||S.value.length===0,command:{cmd:"multiDelete",row:""}},{default:e(()=>[r(i(l(d)("setting.mod.add.header.multiDelete")),1)]),_:1},8,["disabled"]),t(D,{disabled:S.value.length===0,command:{cmd:"multiEnable",row:""}},{default:e(()=>[r(i(l(d)("setting.mod.add.header.multiEnable")),1)]),_:1},8,["disabled"]),t(D,{disabled:$.value,command:{cmd:"addClientDisabled",row:""}},{default:e(()=>[r(i(l(d)("setting.mod.add.header.addClientDisabled")),1)]),_:1},8,["disabled"])]),_:1})]),default:e(()=>[t(m,{type:"primary"},{default:e(()=>[r(i(l(d)("setting.mod.add.table.action"))+" ",1),t(J,{class:"el-icon--right"},{default:e(()=>[t(Ue)]),_:1})]),_:1})]),_:1})])):(s(),p("div",Mt,[t(m,{onClick:z},{default:e(()=>[r(i(l(d)("setting.mod.add.header.refresh")),1)]),_:1}),t(me,{content:l(d)("setting.mod.add.header.syncTooltip"),"show-after":500,effect:"light",placement:"top"},{default:e(()=>[t(m,{loading:oe.value,type:"primary",onClick:ye},{default:e(()=>[r(i(l(d)("setting.mod.add.header.sync")),1)]),_:1},8,["loading"])]),_:1},8,["content"]),t(m,{disabled:l(he).role!=="admin"||S.value.length===0,onClick:De,type:"danger"},{default:e(()=>[r(i(l(d)("setting.mod.add.header.multiDelete")),1)]),_:1},8,["disabled"]),t(m,{disabled:S.value.length===0,loading:re.value,type:"success",onClick:Se},{default:e(()=>[r(i(l(d)("setting.mod.add.header.multiEnable")),1)]),_:1},8,["disabled","loading"]),t(m,{loading:ie.value,type:"warning",icon:l(vt),disabled:$.value,onClick:Me},{default:e(()=>[r(i(l(d)("setting.mod.add.header.addClientDisabled")),1)]),_:1},8,["loading","icon","disabled"]),ne.value==="darwin"?(s(),g(m,{key:0,loading:de.value,type:"success",onClick:Je},{default:e(()=>[r(i(l(d)("setting.mod.add.header.export")),1)]),_:1},8,["loading"])):k("",!0)]))])]),default:e(()=>[t(tt,{closable:!1,effect:qe.value?"light":"dark",type:"warning"},{default:e(()=>[r(i(l(d)("setting.mod.add.alert")),1)]),_:1},8,["effect"]),f("div",zt,[f("span",Ft,i(l(d)("setting.mod.add.alert2")),1),t(lt,{type:"primary",underline:"never",href:"https://miraclesses.top",target:"_blank"},{default:e(()=>[r(i(l(d)("setting.mod.add.alert2_1"))+" ",1),t(J,null,{default:e(()=>[t(l(_t))]),_:1})]),_:1})]),f("div",null,[t(ze,{modelValue:H.value,"onUpdate:modelValue":n[6]||(n[6]=o=>H.value=o),clearable:"",placeholder:l(d)("setting.mod.add.searchPlaceholder")},null,8,["modelValue","placeholder"])]),t(at,{data:Ye.value,border:"",onSelectionChange:je,style:{height:"51vh","margin-top":"10px"}},{default:e(()=>[t(V,{type:"selection",width:"55px"}),t(V,{label:l(d)("setting.mod.add.table.name"),sortable:"",prop:"name"},null,8,["label"]),t(V,{label:"ID",prop:"id",sortable:""}),t(V,{label:l(d)("setting.mod.add.table.size")},{default:e(o=>[r(i(l(yt)(o.row.size)),1)]),_:1},8,["label"]),t(V,{label:l(d)("setting.mod.add.table.downloadedReady.title"),sortable:""},{default:e(o=>[o.row.downloadedReady?(s(),g(ge,{key:0,size:"small",type:"success"},{default:e(()=>[r(i(l(d)("setting.mod.add.table.downloadedReady.ready")),1)]),_:1})):k("",!0),o.row.downloadedReady?k("",!0):(s(),p(N,{key:1},[o.row.file_url!==""?(s(),g(ge,{key:0,size:"small",type:"info"},{default:e(()=>[r(i(l(d)("setting.mod.add.table.downloadedReady.notUGC")),1)]),_:1})):(s(),g(ge,{key:1,size:"small",type:"warning"},{default:e(()=>[r(i(l(d)("setting.mod.add.table.downloadedReady.notReady")),1)]),_:1}))],64))]),_:1},8,["label"]),t(V,{label:l(d)("setting.mod.add.table.action")},{default:e(o=>[t(Le,{trigger:"click",onCommand:we},{dropdown:e(()=>[t(Ve,null,{default:e(()=>[t(D,{disabled:T.value,command:{cmd:"enable",row:o.row}},{default:e(()=>[r(i(l(d)("setting.mod.add.table.enable")),1)]),_:2},1032,["disabled","command"]),t(D,{disabled:T.value,command:{cmd:"update",row:o.row}},{default:e(()=>[r(i(l(d)("setting.mod.add.table.update")),1)]),_:2},1032,["disabled","command"]),t(D,{disabled:T.value,command:{cmd:"delete",row:o.row}},{default:e(()=>[r(i(l(d)("setting.mod.add.table.delete")),1)]),_:2},1032,["disabled","command"])]),_:2},1024)]),default:e(()=>[t(m,{disabled:T.value,loading:F.value,link:"",type:"primary"},{default:e(()=>[r(i(l(d)("setting.mod.add.table.action"))+" ",1),t(J,{class:"el-icon--right"},{default:e(()=>[t(Ue)]),_:1})]),_:1},8,["disabled","loading"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})),[[W,ae.value]])]),_:1})]),_:1})]),_:1},8,["label"]),ne.value!=="darwin"?(s(),g(ce,{key:0,label:l(d)("setting.mod.tab.setting"),name:"Setting"},{default:e(()=>[t(Ie,{gutter:10},{default:e(()=>[t(fe,{lg:8,md:8,sm:24,span:8,xs:24},{default:e(()=>[X((s(),g(Q,{style:I(l(b)?"height: 50vh":"height: 70vh"),shadow:"never"},{default:e(()=>[t(ue,{"max-height":l(b)?"45vh":"65vh"},{default:e(()=>[y.value?(s(!0),p(N,{key:0},Y(y.value,(o,M)=>(s(),p(N,null,[o.id===1?(s(),p("div",Ut,[f("div",null,[t(Ne,{src:l(Xe),fit:"fill",style:{width:"75px",height:"75px"},onClick:O=>P(o.id,o.file_url)},null,8,["src","onClick"])]),f("div",Vt,[t(m,{link:"",type:"primary",onClick:O=>P(o.id,o.file_url)},{default:e(()=>[r(i(l(d)("setting.mod.setting.right.clientModsDisabled")),1)]),_:2},1032,["onClick"]),f("div",null,[o.enable?(s(),g(L,{key:0,type:"success"},{default:e(()=>[r(i(l(d)("setting.mod.setting.left.enable")),1)]),_:1})):k("",!0),o.enable?k("",!0):(s(),g(L,{key:1,type:"info"},{default:e(()=>[r(i(l(d)("setting.mod.setting.left.disable")),1)]),_:1}))])])])):(s(),p("div",Lt,[f("div",null,[t(Ne,{src:o.preview_url,fit:"fill",style:{width:"75px",height:"75px"},onClick:O=>P(o.id,o.file_url)},null,8,["src","onClick"])]),f("div",It,[t(m,{link:"",type:"primary",onClick:O=>P(o.id,o.file_url)},{default:e(()=>[r(i(o.name),1)]),_:2},1032,["onClick"]),f("div",null,[o.enable?(s(),g(L,{key:0,type:"success"},{default:e(()=>[r(i(l(d)("setting.mod.setting.left.enable")),1)]),_:1})):k("",!0),o.enable?k("",!0):(s(),g(L,{key:1,type:"info"},{default:e(()=>[r(i(l(d)("setting.mod.setting.left.disable")),1)]),_:1}))])])])),M!==y.value.length-1?(s(),g(ot,{key:2})):k("",!0)],64))),256)):(s(),p("div",{key:1,style:I(l(b)?"height: 50vh":"height: 70vh"),class:"fcc"},[t(pe,{title:l(d)("setting.mod.setting.left.result"),icon:"warning"},null,8,["title"])],4))]),_:1},8,["max-height"])]),_:1},8,["style"])),[[W,ee.value]])]),_:1}),t(fe,{lg:16,md:16,sm:24,span:16,xs:24},{default:e(()=>[X((s(),g(Q,{style:I(l(b)?"height: 50vh; margin: 10px 0 30px 0":"height: 70vh"),shadow:"never"},{header:e(()=>[f("div",Nt,[f("span",null,i(l(d)("setting.mod.setting.right.header.title")),1),f("div",null,[t(m,{disabled:_.value<2,loading:se.value,type:"primary",onClick:We},{default:e(()=>[r(i(l(d)("setting.mod.setting.right.header.update")),1)]),_:1},8,["disabled","loading"]),t(m,{disabled:_.value===0,loading:B.value,type:"danger",onClick:Ke},{default:e(()=>[r(i(l(d)("setting.mod.setting.right.header.disable")),1)]),_:1},8,["disabled","loading"])])])]),default:e(()=>[_.value>1?(s(),g(ue,{key:0,"max-height":l(b)?"37vh":"57vh"},{default:e(()=>[G.value.configOptions?(s(),g(Fe,{key:0,ref:"modSettingFormRef","label-position":l(b)?"top":"left","label-width":l(b)?"70":"auto",size:l(b)?"small":"large"},{default:e(()=>[t(K,{label:"ID"},{default:e(()=>[t(L,null,{default:e(()=>[r(i(G.value.id),1)]),_:1})]),_:1}),t(K,{label:l(d)("setting.mod.setting.right.name")},{default:e(()=>[t(L,{type:"info"},{default:e(()=>[r(i(y.value[y.value.findIndex(o=>o.id===_.value)].name),1)]),_:1})]),_:1},8,["label"]),(s(!0),p(N,null,Y(G.value.configOptions,o=>(s(),g(me,{content:o.hover,"show-after":500,effect:"light",placement:"top"},{default:e(()=>[t(K,{label:o.label},{default:e(()=>[t(U,{modelValue:y.value[y.value.findIndex(M=>M.id===_.value)].configurationOptions[o.name],"onUpdate:modelValue":M=>y.value[y.value.findIndex(O=>O.id===_.value)].configurationOptions[o.name]=M,onChange:Oe},{default:e(()=>[(s(!0),p(N,null,Y(o.options,M=>(s(),g(v,{label:M.description,value:M.data},null,8,["label","value"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1032,["content"]))),256))]),_:1},8,["label-position","label-width","size"])):(s(),p("div",{key:1,style:I(l(b)?"height: 40vh; margin-top: 10px":"height: 60vh"),class:"fcc"},[t(pe,{title:l(d)("setting.mod.setting.right.result"),icon:"info"},null,8,["title"])],4))]),_:1},8,["max-height"])):k("",!0),_.value===1?(s(),p("div",Tt,[Z.value==="zh"?(s(),p("div",Et,"如果启用此配置，则会禁用玩家的本地模组")):(s(),p("div",Rt,"If enable this configuration option, the game server will Disable player's client mods"))])):k("",!0),_.value===0?(s(),p("div",{key:2,style:I(l(b)?"height: 40vh; margin-top: 10px":"height: 60vh"),class:"fcc"},[t(pe,{title:l(d)("setting.mod.setting.right.result2"),icon:"info"},null,8,["title"])],4)):k("",!0)]),_:1},8,["style"])),[[W,R.value]])]),_:1})]),_:1})]),_:1},8,["label"])):k("",!0)]),_:1},8,["modelValue"])])}}},jt=dt(qt,[["__scopeId","data-v-f25eb711"]]);export{jt as default};
