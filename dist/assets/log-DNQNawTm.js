import{u as te,a as oe,g as ae,c as z,o as se,r as u,d as ne,w as ue,J as d,K as re,e as s,m as v,a3 as ie,k as i,l as C,j as m,i as r,p as R,t as p,f as c,q as g,F as S,v as U,n as de}from"./index-BBdhuqe3.js";import{s as ce}from"./index-CGfJzJB2.js";import{l as B}from"./index-DE219Zqh.js";const ve={class:"card-header"},me={key:0,class:"fcc"},pe={key:0,style:{"font-weight":"lighter","font-size":"smaller"}},ge={style:{"font-weight":"lighter","font-size":"smaller"}},he={key:1,class:"fcc"},fe={key:0,style:{"font-weight":"lighter","font-size":"smaller"}},we={style:{"font-weight":"lighter","font-size":"smaller"}},ye={class:"card-footer"},Ne={__name:"log",props:{type:String,historical:Boolean},setup(T,{expose:A}){var H,W,$;const t=T,{t:w}=te(),{isMobile:P}=oe(),o=ae(),G=z(()=>o.isDark),N=z(()=>o.language);se(()=>{t.historical?j():(J(),I()),y.value=window.innerHeight,window.addEventListener("resize",()=>{y.value=window.innerHeight})});const J=()=>{var a,l;!o.dstClusters||!o.selectedDstCluster||(n.value.worldName=((l=(a=o.dstClusters.find(f=>f.clusterName===o.selectedDstCluster))==null?void 0:a.worlds)==null?void 0:l[0])??null)},y=u(0),b=u(!1),q=z(()=>b.value?n.value.line:P.value?Math.floor(y.value*.55/21)-1:Math.floor(y.value*.67/21)-1),k=u(1),n=u({line:q.value,type:t.type,clusterName:o.selectedDstCluster,worldName:null}),h=u(""),E=()=>{!n.value.worldName&&n.value.type!=="runtime"&&n.value.type!=="access"||B.logValue.get(n.value).then(a=>{a.data!==null&&(h.value=a.data.join(`
`))})};let _=null;const I=()=>{_=setInterval(()=>{k.value===1&&E()},2e3)},D=()=>{_&&(clearInterval(_),_=null)},M=u([]),V=u(""),F=u({clusterName:o.selectedDstCluster,worldName:(($=(W=(H=o.dstClusters)==null?void 0:H.find(a=>a.clusterName===o.selectedDstCluster))==null?void 0:W.worlds)==null?void 0:$[0])??null,type:t.type}),j=()=>{B.historical.logFile.get(F.value).then(a=>{M.value=a.data})},L=u(!1),K=()=>{j(),V.value=""},O=()=>{L.value=!0;const a={file:V.value};B.historical.log.get(a).then(l=>{h.value=l.data}).finally(()=>{L.value=!1})};return ne(()=>{D(),window.removeEventListener("beforeunload",D)}),A({cancelRequests:D,startRequests:I}),ue([q,b],([a,l])=>{l||(n.value.line=a)},{immediate:!0}),(a,l)=>{const f=d("el-option"),x=d("el-select"),Q=d("el-switch"),X=d("el-input-number"),Y=d("el-button"),Z=d("el-tooltip"),ee=d("el-card"),le=re("loading");return s(),v(ee,{shadow:"never"},ie({header:i(()=>[C("div",ve,[R(p(r(w)("logs.logs"))+" ",1),t.historical?(s(),c("div",me,[t.type==="world"||t.type==="chat"?(s(),c("span",pe,p(N.value==="zh"?"世界选择":"World")+"：",1)):g("",!0),t.type==="world"||t.type==="chat"?(s(),v(x,{key:1,modelValue:F.value.worldName,"onUpdate:modelValue":l[0]||(l[0]=e=>F.value.worldName=e),onChange:K,style:{width:"10vw","margin-right":"10px","font-weight":"lighter"}},{default:i(()=>[(s(!0),c(S,null,U(r(o).dstClusters.find(e=>e.clusterName===r(o).selectedDstCluster).worlds,e=>(s(),v(f,{label:e,value:e},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])):g("",!0),C("span",ge,p(N.value==="zh"?"日志文件":"File")+"：",1),m(x,{modelValue:V.value,"onUpdate:modelValue":l[1]||(l[1]=e=>V.value=e),size:"default",style:{width:"15vw","font-weight":"lighter"},onChange:O},{default:i(()=>[(s(!0),c(S,null,U(M.value,e=>(s(),v(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):g("",!0),t.historical?g("",!0):(s(),c("div",he,[t.type==="world"||t.type==="chat"?(s(),c("span",fe,p(N.value==="zh"?"世界选择":"World")+"：",1)):g("",!0),t.type==="world"||t.type==="chat"?(s(),v(x,{key:1,modelValue:n.value.worldName,"onUpdate:modelValue":l[2]||(l[2]=e=>n.value.worldName=e),onChange:l[3]||(l[3]=e=>h.value=""),style:{width:"10vw","margin-right":"10px","font-weight":"lighter"}},{default:i(()=>[(s(!0),c(S,null,U(r(o).dstClusters.find(e=>e.clusterName===r(o).selectedDstCluster).worlds,e=>(s(),v(f,{label:e,value:e},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])):g("",!0),C("span",we,p(r(w)("logs.autoPull")),1),m(Q,{modelValue:k.value,"onUpdate:modelValue":l[4]||(l[4]=e=>k.value=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])]))])]),default:i(()=>[de(m(ce,{ref:"editor",modelValue:h.value,"onUpdate:modelValue":l[5]||(l[5]=e=>h.value=e),height:r(P)?"55vh":"67vh",theme:G.value?"darcula":"idea",mode:"javascript",style:{width:"100%"}},null,8,["modelValue","height","theme"]),[[le,L.value]])]),_:2},[t.historical?void 0:{name:"footer",fn:i(()=>[C("div",ye,[m(X,{modelValue:n.value.line,"onUpdate:modelValue":l[6]||(l[6]=e=>n.value.line=e),"controls-position":"right",onFocus:l[7]||(l[7]=e=>b.value=!0),style:{width:"100px"}},null,8,["modelValue"]),m(Z,{content:r(w)("logs.manualPullTips"),effect:"light",placement:"top"},{default:i(()=>[m(Y,{style:{"margin-left":"10px"},type:"primary",onClick:E},{default:i(()=>[R(p(r(w)("logs.manualPull")),1)]),_:1})]),_:1},8,["content"])])]),key:"0"}]),1024)}}};export{Ne as default};
