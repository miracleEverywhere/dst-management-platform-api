import{o as pe,u as fe,g as _e,G as ve,H as be,d as ge,I as we,c as I,r as _,a2 as g,w as he,J as Q,K as d,L as ye,f as w,i as X,k as t,l as e,j as s,m as y,t as r,p as Y,n as N,q as m,v as Ne,a1 as Ce,D as De,B,E as S,C as U}from"./index-DbQcEWlc.js";const ke={class:"page-div"},xe={class:"tip_warning"},ze={class:"tip_success",style:{"margin-top":"20px"}},Be={class:"fcc",style:{"font-size":"20px"}},Te={key:0},Ve={class:"tip"},Pe={style:{margin:"20px"}},Ae={style:{display:"flex","justify-content":"flex-end","padding-top":"10px"}},Le=Ce({name:"Clusters"}),Se=Object.assign(Le,{setup(Ee){pe(()=>{D(),k()});const{t:l}=fe(),p=_e(),C=ve();be();const q=ge(),j=we("refresh"),Z=I(()=>p.isDark),i=I(()=>p.language),K="info",T=_(!1),V=_(!1),M=I(()=>T.value||V.value),P=_([]),D=()=>{T.value=!0,g.clusters.get().then(o=>{P.value=o.data}).finally(()=>{T.value=!1})},A=_([]),F=_(0),R=_(0),k=()=>{V.value=!0,g.clustersWorldPort.get().then(o=>{A.value=o.data;let n=[];for(let c of A.value)if(c.worldPort!==null)for(let u of c.worldPort)n.push(u);F.value=n.length,R.value=new Set(n).size}).finally(()=>{V.value=!1})},L=()=>{g.clusters.get().then(o=>{p.dstClusters=o.data,p.selectedDstCluster===null&&p.dstClusters!==null&&(p.selectedDstCluster=p.dstClusters[0].clusterName)})},x=_(!1),E=_(!1),v=_({clusterName:"",clusterDisplayName:""}),ee=o=>{v.value={clusterName:o.clusterName,clusterDisplayName:""},x.value=!0},te=()=>{if(v.value===""){De(i.value==="zh"?"请输入集群昵称":"cluster nickname is required");return}E.value=!0,g.cluster.put(v.value).then(o=>{g.clusters.get().then(n=>{P.value=n.data,p.dstClusters=n.data}),B(o.message),x.value=!1}).finally(()=>{E.value=!1})},ae=o=>{const n=o.clusterName;S.confirm(i.value==="zh"?"将执行 删除集群 操作，是否继续？":"The cluster DELETE operation will be performed. Do you want to continue?",i.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:i.value==="zh"?"确定":"confirm",cancelButtonText:i.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(c,u,f)=>{if(c==="confirm"){u.confirmButtonLoading=!0;const h={clusterName:n};g.cluster.delete(h).then(async b=>{B(b.message),await D(),await k(),await L(),p.selectedDstCluster===n&&p.dstClusters!==null&&(p.selectedDstCluster=p.dstClusters[0].clusterName),f()}).catch(()=>{}).finally(()=>{u.confirmButtonLoading=!1})}else f()}}).then(()=>{}).catch(()=>{U(l("home.canceled"))})},le=o=>{const n=o.clusterName;S.confirm(i.value==="zh"?"将执行 激活集群 操作，是否继续？":"The cluster ACTIVATE operation will be performed. Do you want to continue?",i.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:i.value==="zh"?"确定":"confirm",cancelButtonText:i.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(c,u,f)=>{if(c==="confirm"){u.confirmButtonLoading=!0;const h={clusterName:n,status:!0};g.cluster.status.put(h).then(async b=>{B(b.message),await D(),await k(),await L(),f()}).catch(()=>{}).finally(()=>{u.confirmButtonLoading=!1})}else f()}}).then(()=>{}).catch(()=>{U(l("home.canceled"))})},oe=o=>{const n=o.clusterName;S.confirm(i.value==="zh"?"将执行 关闭集群 操作，是否继续？":"The cluster DEACTIVATE operation will be performed. Do you want to continue?",i.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:i.value==="zh"?"确定":"confirm",cancelButtonText:i.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(c,u,f)=>{if(c==="confirm"){u.confirmButtonLoading=!0;const h={clusterName:n,status:!1};g.cluster.status.put(h).then(async b=>{B(b.message),await D(),await k(),await L(),f()}).catch(()=>{}).finally(()=>{u.confirmButtonLoading=!1})}else f()}}).then(()=>{}).catch(()=>{U(l("home.canceled"))})},se=o=>{switch(o.type){case"activate":le(o.row);break;case"deactivate":oe(o.row);break;case"update":ee(o.row);break;case"delete":ae(o.row);break}},ne=()=>{setTimeout(()=>{C.meta.isKeepAlive&&q.removeKeepAliveName(C.name),j(!1),Q(()=>{C.meta.isKeepAlive&&q.addKeepAliveName(C.name),j(!0)})},0)};return he(()=>p.selectedDstCluster,o=>{o&&Q(()=>{ne()})},{immediate:!1}),(o,n)=>{const c=d("el-tag"),u=d("el-table-column"),f=d("arrow-down"),h=d("el-icon"),b=d("el-button"),z=d("el-dropdown-item"),re=d("el-dropdown-menu"),ue=d("el-dropdown"),W=d("el-table"),O=d("el-tab-pane"),ce=d("el-alert"),ie=d("el-tabs"),G=d("el-input"),H=d("el-form-item"),de=d("el-form"),me=d("el-dialog"),J=ye("loading");return w(),X("div",ke,[t(ie,{modelValue:K,"onUpdate:modelValue":n[0]||(n[0]=a=>K=a)},{default:e(()=>[t(O,{label:s(l)("clusters.tab.pane1"),name:"info"},{default:e(()=>[y("div",xe,r(s(l)("clusters.tip1")),1),Y((w(),N(W,{data:P.value,border:""},{default:e(()=>[t(u,{label:s(l)("clusters.table.name")},{default:e(a=>[t(c,{type:"primary"},{default:e(()=>[m(r(a.row.clusterName),1)]),_:2},1024)]),_:1},8,["label"]),t(u,{label:s(l)("clusters.table.displayName")},{default:e(a=>[t(c,{type:"success"},{default:e(()=>[m(r(a.row.clusterDisplayName),1)]),_:2},1024)]),_:1},8,["label"]),t(u,{label:s(l)("clusters.table.status")},{default:e(a=>[a.row.status?(w(),N(c,{key:0,type:"success"},{default:e(()=>[m(r(i.value==="zh"?"激活":"Activated"),1)]),_:1})):(w(),N(c,{key:1,type:"info"},{default:e(()=>[m(r(i.value==="zh"?"关闭":"Deactivated"),1)]),_:1}))]),_:1},8,["label"]),t(u,{label:s(l)("clusters.table.world")},{default:e(a=>[t(c,{type:"info"},{default:e(()=>{var $;return[m(r((($=a.row.worlds)==null?void 0:$.length)||0),1)]}),_:2},1024)]),_:1},8,["label"]),t(u,{label:s(l)("clusters.table.actions")},{default:e(a=>[t(ue,{trigger:"hover",onCommand:se},{dropdown:e(()=>[t(re,null,{default:e(()=>[t(z,{command:{type:"activate",row:a.row}},{default:e(()=>[m(r(s(l)("clusters.table.action.activate")),1)]),_:2},1032,["command"]),t(z,{command:{type:"deactivate",row:a.row}},{default:e(()=>[m(r(s(l)("clusters.table.action.deactivate")),1)]),_:2},1032,["command"]),t(z,{command:{type:"update",row:a.row},divided:""},{default:e(()=>[m(r(s(l)("clusters.table.action.update")),1)]),_:2},1032,["command"]),t(z,{command:{type:"delete",row:a.row}},{default:e(()=>[m(r(s(l)("clusters.table.action.delete")),1)]),_:2},1032,["command"])]),_:2},1024)]),default:e(()=>[t(b,{link:"",type:"primary"},{default:e(()=>[m(r(s(l)("clusters.table.actions"))+" ",1),t(h,{class:"el-icon--right"},{default:e(()=>[t(f)]),_:1})]),_:1})]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])),[[J,M.value]])]),_:1},8,["label"]),t(O,{label:s(l)("clusters.tab.pane2"),name:"port"},{default:e(()=>[y("div",ze,r(s(l)("clusters.tip2")),1),R.value!==F.value?(w(),N(ce,{key:0,effect:Z.value?"light":"dark",type:"error",closable:!1,style:{"margin-bottom":"10px"}},{title:e(()=>[y("div",Be,r(s(l)("clusters.tip3")),1)]),_:1},8,["effect"])):Ne("",!0),Y((w(),N(W,{data:A.value,border:""},{default:e(()=>[t(u,{label:s(l)("clusters.table.name")},{default:e(a=>[t(c,{type:"primary"},{default:e(()=>[m(r(a.row.clusterName),1)]),_:2},1024)]),_:1},8,["label"]),t(u,{label:s(l)("clusters.table.displayName")},{default:e(a=>[t(c,{type:"success"},{default:e(()=>[m(r(a.row.clusterDisplayName),1)]),_:2},1024)]),_:1},8,["label"]),t(u,{label:s(l)("clusters.table.port")},{default:e(a=>[a.row.worldPort?(w(),X("span",Te,r(a.row.worldPort.join(",")),1)):(w(),N(c,{key:1,type:"info"},{default:e(()=>[m(r(s(l)("clusters.table.none")),1)]),_:1}))]),_:1},8,["label"])]),_:1},8,["data"])),[[J,M.value]])]),_:1},8,["label"])]),_:1}),t(me,{modelValue:x.value,"onUpdate:modelValue":n[3]||(n[3]=a=>x.value=a),width:"65%"},{header:e(()=>[m(r(s(l)("clusters.updateDialog.title")),1)]),default:e(()=>[y("div",Ve,r(s(l)("clusters.updateDialog.tip1")),1),y("div",Pe,[t(de,{model:v.value},{default:e(()=>[t(H,{label:s(l)("clusters.updateDialog.clusterName")},{default:e(()=>[t(G,{disabled:"",modelValue:v.value.clusterName,"onUpdate:modelValue":n[1]||(n[1]=a=>v.value.clusterName=a)},null,8,["modelValue"])]),_:1},8,["label"]),t(H,{label:s(l)("clusters.updateDialog.newDisplayName")},{default:e(()=>[t(G,{modelValue:v.value.clusterDisplayName,"onUpdate:modelValue":n[2]||(n[2]=a=>v.value.clusterDisplayName=a)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"]),y("div",Ae,[t(b,{type:"primary",onClick:te,loading:E.value},{default:e(()=>[m(r(i.value==="zh"?"更新":"Update"),1)]),_:1},8,["loading"])])])]),_:1},8,["modelValue"])])}}});export{Se as default};
